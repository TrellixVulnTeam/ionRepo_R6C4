(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"I/3d":function(t,e,n){"use strict";n.d(e,"a",(function(){return Kp}));var r=n("fXoL"),i=n("D0XW"),o=n("HDdC"),s=n("Cfvw"),u=n("LRne"),a=n("JX91"),c=n("7o/Q");function h(){return t=>t.lift(new f)}class f{call(t,e){return e.subscribe(new l(t))}}class l extends c.a{constructor(t){super(t),this.hasPrev=!1}_next(t){let e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}var p=n("lJxs"),d=n("Kqap"),v=n("/uUt"),y=n("pLZG"),g=n("pxpQ"),b=n("spgP"),m=n("ofXK"),w=n("Jgta"),_=n("O1h7"),I=n("zIRd"),E=n("q/0M"),O=n("qOnz"),T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function A(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var j,N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},D=D||{},S=N||self;function x(){}function P(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function k(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var C="closure_uid_"+(1e9*Math.random()>>>0),R=0;function L(t,e,n){return t.call.apply(t.bind,arguments)}function U(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function M(t,e,n){return(M=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?L:U).apply(null,arguments)}function V(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function q(){return Date.now()}function F(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function B(){this.j=this.j,this.i=this.i}B.prototype.j=!1,B.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&function(t){Object.prototype.hasOwnProperty.call(t,C)&&t[C]||(t[C]=++R)}(this)},B.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var z=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},G=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function K(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Q(t){return/^[\s\xa0]*$/.test(t)}var J,X=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function $(t,e){return-1!=t.indexOf(e)}function Y(t,e){return t<e?-1:t>e?1:0}t:{var H=S.navigator;if(H){var Z=H.userAgent;if(Z){J=Z;break t}}J=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e={};for(var n in t)e[n]=t[n];return e}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=x;var ot,st,ut=$(J,"Opera"),at=$(J,"Trident")||$(J,"MSIE"),ct=$(J,"Edge"),ht=ct||at,ft=$(J,"Gecko")&&!($(J.toLowerCase(),"webkit")&&!$(J,"Edge"))&&!($(J,"Trident")||$(J,"MSIE"))&&!$(J,"Edge"),lt=$(J.toLowerCase(),"webkit")&&!$(J,"Edge");function pt(){var t=S.document;return t?t.documentMode:void 0}t:{var dt="",vt=(st=J,ft?/rv:([^\);]+)(\)|;)/.exec(st):ct?/Edge\/([\d\.]+)/.exec(st):at?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):lt?/WebKit\/(\S+)/.exec(st):ut?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(vt&&(dt=vt?vt[1]:""),at){var yt=pt();if(null!=yt&&yt>parseFloat(dt)){ot=String(yt);break t}}ot=dt}var gt={};function bt(t){return function(t,e){var n=gt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,(function(){for(var e=0,n=X(String(ot)).split("."),r=X(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",u=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],u=/(\d*)(\D*)(.*)/.exec(u)||["","","",""],0==s[0].length&&0==u[0].length)break;e=Y(0==s[1].length?0:parseInt(s[1],10),0==u[1].length?0:parseInt(u[1],10))||Y(0==s[2].length,0==u[2].length)||Y(s[2],u[2]),s=s[3],u=u[3]}while(0==e)}return 0<=e}))}var mt=S.document&&at&&(pt()||parseInt(ot,10))||void 0,wt=!at||9<=Number(mt),_t=at&&!bt("9"),It=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",x,e),S.removeEventListener("test",x,e)}catch(n){}return t}();function Et(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Ot(t,e){if(Et.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{it(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Tt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}Et.prototype.b=function(){this.defaultPrevented=!0},F(Ot,Et);var Tt={2:"touch",3:"pen",4:"mouse"};Ot.prototype.b=function(){Ot.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,_t)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var At="closure_listenable_"+(1e6*Math.random()|0),jt=0;function Nt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++jt,this.Y=this.Z=!1}function Dt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function St(t){this.src=t,this.a={},this.b=0}function xt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=z(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Dt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Pt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}St.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Pt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Nt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var kt="closure_lm_"+(1e6*Math.random()|0),Ct={};function Rt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=zt(r),e&&e[At]?e.wa(n,r,k(i)?!!i.capture:!!i,o):Lt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Rt(t,e[o],n,r,i);return null}return n=zt(n),t&&t[At]?t.va(e,n,k(r)?!!r.capture:!!r,i):Lt(t,e,n,!1,r,i)}function Lt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=k(i)?!!i.capture:!!i;if(s&&!wt)return null;var u=Ft(t);if(u||(t[kt]=u=new St(t)),(n=u.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=qt,e=wt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)It||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Mt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ut(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[At])xt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Mt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(xt(n,t),0==n.b&&(n.src=null,e[kt]=null)):Dt(t)}}}function Mt(t){return t in Ct?Ct[t]:Ct[t]="on"+t}function Vt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Ut(t),n.call(r,e)}function qt(t,e){if(t.Y)return!0;if(!wt){if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Vt(t,e=new Ot(e,this))}return Vt(t,new Ot(e,this))}function Ft(t){return(t=t[kt])instanceof St?t:null}var Bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function zt(t){return"function"==typeof t?t:(t[Bt]||(t[Bt]=function(e){return t.handleEvent(e)}),t[Bt])}function Gt(){B.call(this),this.c=new St(this),this.J=this,this.C=null}function Kt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new Et(e,t);else if(e instanceof Et)e.target=e.target||t;else{var i=e;rt(e=new Et(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=Wt(s,r,!0,e)&&i}if(i=Wt(s=e.a=t,r,!0,e)&&i,i=Wt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Wt(s=e.a=n[o],r,!1,e)&&i}function Wt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var u=s.listener,a=s.ca||s.src;s.Z&&xt(t.c,s),i=!1!==u.call(a,r)&&i}}return i&&!r.defaultPrevented}F(Gt,B),Gt.prototype[At]=!0,(j=Gt.prototype).addEventListener=function(t,e,n,r){Rt(this,t,e,n,r)},j.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=k(i)?!!i.capture:!!i,r=zt(r),e&&e[At]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Pt(s=e.a[n],r,i,o))&&(Dt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):e&&(e=Ft(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Pt(n,r,i,o)),(r=-1<e?n[e]:null)&&Ut(r))}(this,t,e,n,r)},j.G=function(){if(Gt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Dt(n[r]);delete e.a[t],e.b--}}this.C=null},j.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},j.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Qt=S.JSON.stringify;function Jt(){this.b=this.a=null}var Xt,$t=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,this.a=(t=this.a).next,t.next=null):t=this.c(),t},t}())((function(){return new Ht}),(function(t){t.reset()}));function Yt(){var t=ne,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Ht(){this.next=this.b=this.a=null}function Zt(t){S.setTimeout((function(){throw t}),0)}function te(t,e){Xt||function(){var t=S.Promise.resolve(void 0);Xt=function(){t.then(re)}}(),ee||(Xt(),ee=!0),ne.add(t,e)}Jt.prototype.add=function(t,e){var n=$t.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Ht.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Ht.prototype.reset=function(){this.next=this.b=this.a=null};var ee=!1,ne=new Jt;function re(){for(var t;t=Yt();){try{t.a.call(t.b)}catch(n){Zt(n)}var e=$t;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}ee=!1}function ie(t,e){Gt.call(this),this.b=t||1,this.a=e||S,this.f=M(this.Za,this),this.g=q()}function oe(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function se(t,e,n){if("function"==typeof t)n&&(t=M(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=M(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}function ue(t){t.a=se((function(){t.a=null,t.c&&(t.c=!1,ue(t))}),t.h);var e=t.b;t.b=null,t.g.apply(null,e)}F(ie,Gt),(j=ie.prototype).aa=!1,j.M=null,j.Za=function(){if(this.aa){var t=q()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Kt(this,"tick"),this.aa&&(oe(this),this.start()))}},j.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},j.G=function(){ie.X.G.call(this),oe(this),delete this.a};var ae=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:ue(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(S.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(B);function ce(t){B.call(this),this.b=t,this.a={}}F(ce,B);var he=[];function fe(t,e,n,r){Array.isArray(n)||(n&&(he[0]=n.toString()),n=he);for(var i=0;i<n.length;i++){var o=Rt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function le(t){tt(t.a,(function(t,e){this.a.hasOwnProperty(e)&&Ut(t)}),t),t.a={}}function pe(){this.a=!0}function de(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Qt(n)}catch(u){return e}}(t,n)+(r?" "+r:"")}))}ce.prototype.G=function(){ce.X.G.call(this),le(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},pe.prototype.info=function(){};var ve={},ye=null;function ge(){return ye=ye||new Gt}function be(t){Et.call(this,ve.Fa,t)}function me(t){var e=ge();Kt(e,new be(e,t))}function we(t,e){Et.call(this,ve.STAT_EVENT,t),this.stat=e}function _e(t){var e=ge();Kt(e,new we(e,t))}function Ie(t){Et.call(this,ve.Ga,t)}function Ee(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return S.setTimeout((function(){t()}),e)}ve.Fa="serverreachability",F(be,Et),ve.STAT_EVENT="statevent",F(we,Et),ve.Ga="timingevent",F(Ie,Et);var Oe={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Te={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function Ae(){}function je(){}Ae.prototype.a=null;var Ne,De={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Se(){Et.call(this,"d")}function xe(){Et.call(this,"c")}function Pe(){}function ke(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new ce(this),this.P=Ce,this.R=new ie(t=ht?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}F(Se,Et),F(xe,Et),F(Pe,Ae),Ne=new Pe;var Ce=45e3,Re={},Le={};function Ue(t,e,n){t.H=1,t.i=sn(Ze(e)),t.j=n,t.I=!0,Me(t,null)}function Me(t,e){t.u=q(),Fe(t),t.l=Ze(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),mn(n.b,"t",r),t.D=0,t.a=pr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ae(M(t.Ca,t,t.a),t.O)),fe(t.J,t.a,"readystatechange",t.Xa),e=t.B?et(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),me(1),function(t,e,n,r,i,o){t.info((function(){if(t.a)if(o)for(var s="",u=o.split("&"),a=0;a<u.length;a++){var c=u[a].split("=");if(1<c.length){var h=c[0];c=c[1];var f=h.split("_");s=2<=f.length&&"type"==f[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.c,t.m,t.l,t.f,t.S,t.j)}function Ve(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=qe(t,n);if(i==Le){4==e&&(t.h=4,_e(14),r=!1),de(t.c,t.f,null,"[Incomplete Response]");break}if(i==Re){t.h=4,_e(15),de(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}de(t.c,t.f,i,null),We(t,i)}4==e&&0==n.length&&(t.h=1,_e(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),or(e),e.F=!0,_e(11))):(de(t.c,t.f,n,"[Invalid Chunked Response]"),Ke(t),Ge(t))}function qe(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Le:(n=Number(e.substring(n,r)),isNaN(n)?Re:(r+=1)+n>e.length?Le:(e=e.substr(r,n),t.D=r+n,e))}function Fe(t){t.T=q()+t.P,Be(t,t.P)}function Be(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Ee(M(t.Va,t),e)}function ze(t){t.o&&(S.clearTimeout(t.o),t.o=null)}function Ge(t){0==t.g.v||t.A||ar(t.g,t)}function Ke(t){ze(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,oe(t.R),le(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function We(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||An(n.b,t)))if(n.I=t.N,!t.C&&An(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(tp){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;ur(n),$n(n)}ir(n),_e(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=Ee(M(n.Sa,n),6e3));if(1>=Tn(n.b)&&n.ea){try{n.ea()}catch(tp){}n.ea=void 0}}else hr(n,11)}else if((t.C||n.a==t)&&ur(n),!Q(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(n.P=(i=e[r])[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var u=i[5];if(null!=u&&"number"==typeof u&&0<u){var a=1.5*u;n.D=a,n.c.info("backChannelRequestTimeoutMs_="+a)}a=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var f=a.b;!f.a&&($(h,"spdy")||$(h,"quic")||$(h,"h2"))&&(f.f=f.g,f.a=new Set,f.b&&(jn(f,f.b),f.b=null))}if(a.A){var l=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;l&&(a.na=l,on(a.B,a.A,l))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=q()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var p=t;if((a=n).la=lr(a,a.C?a.ga:null,a.fa),p.C){Nn(a.b,p);var d=p,v=a.D;v&&d.setTimeout(v),d.o&&(ze(d),Fe(d)),a.a=p}else rr(a);0<n.g.length&&Zn(n)}else"stop"!=i[0]&&"close"!=i[0]||hr(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?hr(n,7):Xn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);me(4)}catch(tp){}}function Qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(P(t)||"string"==typeof t)G(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(P(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(P(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Je(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Je)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Xe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];$e(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)$e(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function $e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(j=ke.prototype).setTimeout=function(t){this.P=t},j.Xa=function(t){t=t.target;var e=this.F;e&&3==Kn(t)?e.f():this.Ca(t)},j.Ca=function(t){try{if(t==this.a)t:{var e=Kn(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!ht&&!this.a.$())){this.A||4!=e||7==n||me(8==n||0>=r?3:2),ze(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Q(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.h=3,_e(12),Ke(this),Ge(this);break t}de(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,We(this,a)}this.I?(Ve(this,e,o),ht&&this.b&&3==e&&(fe(this.J,this.R,"tick",this.Wa),this.R.start())):(de(this.c,this.f,o,null),We(this,o)),4==e&&Ke(this),this.b&&!this.A&&(4==e?ar(this.g,this):(this.b=!1,Fe(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,_e(12)):(this.h=0,_e(13)),Ke(this),Ge(this)}}}catch(c){}},j.Wa=function(){if(this.a){var t=Kn(this.a),e=this.a.$();this.D<e.length&&(ze(this),Ve(this,t,e),this.b&&4!=t&&Fe(this))}},j.cancel=function(){this.A=!0,Ke(this)},j.Va=function(){this.o=null;var t=q();0<=t-this.T?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.c,this.l),2!=this.H&&(me(3),_e(17)),Ke(this),this.h=2,Ge(this)):Be(this,this.T-t)},(j=Je.prototype).K=function(){Xe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},j.L=function(){return Xe(this),this.a.concat()},j.get=function(t,e){return $e(this.b,t)?this.b[t]:e},j.set=function(t,e){$e(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},j.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ye=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function He(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof He){this.a=void 0!==e?e:t.a,tn(this,t.f),this.j=t.j,en(this,t.c),nn(this,t.h),this.g=t.g,e=t.b;var n=new vn;n.c=e.c,e.a&&(n.a=new Je(e.a),n.b=e.b),rn(this,n),this.i=t.i}else t&&(n=String(t).match(Ye))?(this.a=!!e,tn(this,n[1]||"",!0),this.j=un(n[2]||""),en(this,n[3]||"",!0),nn(this,n[4]),this.g=un(n[5]||"",!0),rn(this,n[6]||"",!0),this.i=un(n[7]||"")):(this.a=!!e,this.b=new vn(null,this.a))}function Ze(t){return new He(t)}function tn(t,e,n){t.f=n?un(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function en(t,e,n){t.c=n?un(e,!0):e}function nn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function rn(t,e,n){e instanceof vn?(t.b=e,function(t,e){e&&!t.f&&(yn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(gn(this,e),mn(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=an(e,pn)),t.b=new vn(e,t.a))}function on(t,e,n){t.b.set(e,n)}function sn(t){return on(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),t}function un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function an(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,cn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function cn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}He.prototype.toString=function(){var t=[],e=this.f;e&&t.push(an(e,hn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(an(e,hn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(an(n,"/"==n.charAt(0)?ln:fn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",an(n,dn)),t.join("")};var hn=/[#\/\?@]/g,fn=/[#\?:]/g,ln=/[#\?]/g,pn=/[#\?@]/g,dn=/#/g;function vn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function yn(t){t.a||(t.a=new Je,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function gn(t,e){yn(t),e=wn(t,e),$e(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,$e((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Xe(t)))}function bn(t,e){return yn(t),e=wn(t,e),$e(t.a.b,e)}function mn(t,e,n){gn(t,e),0<n.length&&(t.c=null,t.a.set(wn(t,e),W(n)),t.b+=n.length)}function wn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(j=vn.prototype).add=function(t,e){yn(this),this.c=null,t=wn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},j.forEach=function(t,e){yn(this),this.a.forEach((function(n,r){G(n,(function(n){t.call(e,n,r,this)}),this)}),this)},j.L=function(){yn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},j.K=function(t){yn(this);var e=[];if("string"==typeof t)bn(this,t)&&(e=K(e,this.a.get(wn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=K(e,t[n])}return e},j.set=function(t,e){return yn(this),this.c=null,bn(this,t=wn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},j.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},j.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var _n=function(){return function(t,e){this.b=t,this.a=e}}();function In(t){this.g=t||En,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ia&&S.ia.ya&&S.ia.ya()&&S.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var En=10;function On(t){return!!t.b||!!t.a&&t.a.size>=t.f}function Tn(t){return t.b?1:t.a?t.a.size:0}function An(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function jn(t,e){t.a?t.a.add(e):t.b=e}function Nn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Dn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=A(t.a.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.s)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return W(t.c)}function Sn(){}function xn(){this.a=new Sn}function Pn(t,e,n){var r=n||"";try{Qe(t,(function(t,n){var i=t;k(t)&&(i=Qt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function kn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}In.prototype.cancel=function(){var t,e;if(this.c=Dn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=A(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Sn.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},Sn.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var Cn=S.JSON.parse;function Rn(t){Gt.call(this),this.headers=new Je,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Ln,this.D=this.F=!1}F(Rn,Gt);var Ln="",Un=/^https?$/i,Mn=["POST","PUT"];function Vn(t){return"content-type"==t.toLowerCase()}function qn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Fn(t),zn(t)}function Fn(t){t.u||(t.u=!0,Kt(t,"complete"),Kt(t,"error"))}function Bn(t){if(t.b&&void 0!==D&&(!t.s[1]||4!=Kn(t)||2!=t.W()))if(t.l&&4==Kn(t))se(t.za,0,t);else if(Kt(t,"readystatechange"),4==Kn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(Ye)[1]||null;if(!o&&S.self&&S.self.location){var s=S.self.location.protocol;o=s.substr(0,s.length-1)}i=!Un.test(o?o.toLowerCase():"")}e=i}if(e)Kt(t,"complete"),Kt(t,"success");else{t.h=6;try{var u=2<Kn(t)?t.a.statusText:""}catch(n){u=""}t.f=u+" ["+t.W()+"]",Fn(t)}}finally{zn(t)}}}function zn(t,e){if(t.a){Gn(t);var n=t.a,r=t.s[0]?x:null;t.a=null,t.s=null,e||Kt(t,"ready");try{n.onreadystatechange=r}catch(i){}}}function Gn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(S.clearTimeout(t.m),t.m=null)}function Kn(t){return t.a?t.a.readyState:0}function Wn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return tt(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):on(t,e,n))}function Qn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Jn(t){this.pa=0,this.g=[],this.c=new pe,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Qn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Qn("baseRetryDelayMs",5e3,t),this.Ra=Qn("retryDelaySeedMs",1e4,t),this.Ma=Qn("forwardChannelMaxRetries",2,t),this.ma=Qn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new In(t&&t.concurrentRequestLimit),this.ka=new xn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Xn(t){if(Yn(t),3==t.v){var e=t.R++,n=Ze(t.B);on(n,"SID",t.J),on(n,"RID",e),on(n,"TYPE","terminate"),er(t,n),(e=new ke(t,t.c,e,void 0)).H=2,e.i=sn(Ze(n)),n=!1,S.navigator&&S.navigator.sendBeacon&&(n=S.navigator.sendBeacon(e.i.toString(),"")),!n&&S.Image&&((new Image).src=e.i,n=!0),n||(e.a=pr(e.g,null),e.a.ba(e.i)),e.u=q(),Fe(e)}fr(t)}function $n(t){t.a&&(or(t),t.a.cancel(),t.a=null)}function Yn(t){$n(t),t.j&&(S.clearTimeout(t.j),t.j=null),ur(t),t.b.cancel(),t.h&&("number"==typeof t.h&&S.clearTimeout(t.h),t.h=null)}function Hn(t,e){t.g.push(new _n(t.Oa++,e)),3==t.v&&Zn(t)}function Zn(t){On(t.b)||t.h||(t.h=!0,te(t.Ba,t),t.u=0)}function tr(t,e){var n;n=e?e.f:t.R++;var r=Ze(t.B);on(r,"SID",t.J),on(r,"RID",n),on(r,"AID",t.P),er(t,r),t.i&&t.l&&Wn(r,t.i,t.l),n=new ke(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=nr(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),jn(t.b,n),Ue(n,r,e)}function er(t,e){t.f&&Qe({},(function(t,n){on(e,n,t)}))}function nr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?M(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].b)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if(0>(c-=o))o=Math.max(0,i[a].b-100),u=!1;else try{Pn(h,s,"req"+c+"_")}catch(Kr){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function rr(t){t.a||t.j||(t.T=1,te(t.Aa,t),t.o=0)}function ir(t){return!(t.a||t.j||3<=t.o||(t.T++,t.j=Ee(M(t.Aa,t),cr(t,t.o)),t.o++,0))}function or(t){null!=t.s&&(S.clearTimeout(t.s),t.s=null)}function sr(t){t.a=new ke(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ze(t.la);on(e,"RID","rpc"),on(e,"SID",t.J),on(e,"CI",t.H?"0":"1"),on(e,"AID",t.P),er(t,e),on(e,"TYPE","xmlhttp"),t.i&&t.l&&Wn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=sn(Ze(e)),n.j=null,n.I=!0,Me(n,t)}function ur(t){null!=t.m&&(S.clearTimeout(t.m),t.m=null)}function ar(t,e){var n=null;if(t.a==e){ur(t),or(t),t.a=null;var r=2}else{if(!An(t.b,e))return;n=e.s,Nn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=q()-e.u;var i=t.u;Kt(r=ge(),new Ie(r,n,e,i)),Zn(t)}else rr(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Tn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=Ee(M(t.Ba,t,e),cr(t,t.u)),t.u++,0)))}(t,e)||2==r&&ir(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:hr(t,5);break;case 4:hr(t,10);break;case 3:hr(t,6);break;default:hr(t,2)}}function cr(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function hr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=M(t.Ya,t);n||(n=new He("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||tn(n,"https"),sn(n)),function(t,e){var n=new pe;if(S.Image){var r=new Image;r.onload=V(kn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=V(kn,n,r,"TestLoadImage: error",!1,e),r.onabort=V(kn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=V(kn,n,r,"TestLoadImage: timeout",!1,e),S.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else _e(2);t.v=0,t.f&&t.f.ra(e),fr(t),Yn(t)}function fr(t){t.v=0,t.I=-1,t.f&&(0==Dn(t.b).length&&0==t.g.length||(t.b.c.length=0,W(t.g),t.g.length=0),t.f.qa())}function lr(t,e,n){var r=function(t){return t instanceof He?Ze(t):new He(t,void 0)}(n);if(""!=r.c)e&&en(r,e+"."+r.c),nn(r,r.h);else{var i=S.location;r=function(t,e,n,r){var i=new He(null,void 0);return t&&tn(i,t),e&&en(i,e),n&&nn(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&tt(t.V,(function(t,e){on(r,e,t)})),n=t.na,(e=t.A)&&n&&on(r,e,n),on(r,"VER",t.ha),er(t,r),r}function pr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Rn(t.Na)).F=t.C,e}function dr(){}function vr(){if(at&&!(10<=Number(mt)))throw Error("Environmental error: no available transport.")}function yr(t,e){Gt.call(this),this.a=new Jn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!Q(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Q(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new mr(this)}function gr(t){Se.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function br(){xe.call(this),this.status=1}function mr(t){this.a=t}(j=Rn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=function(t){var e;return(e=t.a)||(e=t.a={}),e}(this.H?this.H:Ne),this.a.onreadystatechange=M(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void qn(this,o)}t=n||"";var i=new Je(this.headers);r&&Qe(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=Vn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=S.FormData&&t instanceof S.FormData,!(0<=z(Mn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Gn(this),0<this.o&&((this.D=function(t){return at&&bt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=M(this.xa,this)):this.m=se(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){qn(this,o)}},j.xa=function(){void 0!==D&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Kt(this,"timeout"),this.abort(8))},j.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Kt(this,"complete"),Kt(this,"abort"),zn(this))},j.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),zn(this,!0)),Rn.X.G.call(this)},j.za=function(){this.j||(this.A||this.l||this.g?Bn(this):this.Ua())},j.Ua=function(){Bn(this)},j.W=function(){try{return 2<Kn(this)?this.a.status:-1}catch(st){return-1}},j.$=function(){try{return this.a?this.a.responseText:""}catch(st){return""}},j.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Cn(e)}},j.ua=function(){return this.h},j.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(j=Jn.prototype).ha=8,j.v=1,j.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new ke(this,this.c,t,void 0),r=this.l;if(this.O&&(r?rt(r=et(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=nr(this,n,e),on(i=Ze(this.B),"RID",t),on(i,"CVER",22),this.A&&on(i,"X-HTTP-Session-Id",this.A),er(this,i),this.i&&r&&Wn(i,this.i,r),jn(this.b,n),this.Ia&&on(i,"TYPE","init"),this.da?(on(i,"$req",e),on(i,"SID","null"),n.U=!0,Ue(n,i,null)):Ue(n,i,e),this.v=2}}else 3==this.v&&(t?tr(this,t):0==this.g.length||On(this.b)||tr(this))},j.Aa=function(){if(this.j=null,sr(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=Ee(M(this.Ta,this),t)}},j.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,_e(10),$n(this),sr(this))},j.Sa=function(){null!=this.m&&(this.m=null,$n(this),ir(this),_e(19))},j.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),_e(2)):(this.c.info("Failed to ping google.com"),_e(1))},(j=dr.prototype).ta=function(){},j.sa=function(){},j.ra=function(){},j.qa=function(){},j.Ja=function(){},vr.prototype.a=function(t,e){return new yr(t,e)},F(yr,Gt),yr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;_e(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=lr(t,null,t.fa),Zn(t)},yr.prototype.close=function(){Xn(this.a)},yr.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Hn(this.a,e)}else this.l?((e={}).__data__=Qt(t),Hn(this.a,e)):Hn(this.a,t)},yr.prototype.G=function(){this.a.f=null,delete this.f,Xn(this.a),delete this.a,yr.X.G.call(this)},F(gr,Se),F(br,xe),F(mr,dr),mr.prototype.ta=function(){Kt(this.a,"a")},mr.prototype.sa=function(t){Kt(this.a,new gr(t))},mr.prototype.ra=function(t){Kt(this.a,new br(t))},mr.prototype.qa=function(){Kt(this.a,"b")},vr.prototype.createWebChannel=vr.prototype.a,yr.prototype.send=yr.prototype.h,yr.prototype.open=yr.prototype.g,yr.prototype.close=yr.prototype.close,Oe.NO_ERROR=0,Oe.TIMEOUT=8,Oe.HTTP_ERROR=6,Te.COMPLETE="complete",je.EventType=De,De.OPEN="a",De.CLOSE="b",De.ERROR="c",De.MESSAGE="d",Gt.prototype.listen=Gt.prototype.va,Rn.prototype.listenOnce=Rn.prototype.wa,Rn.prototype.getLastError=Rn.prototype.Qa,Rn.prototype.getLastErrorCode=Rn.prototype.ua,Rn.prototype.getStatus=Rn.prototype.W,Rn.prototype.getResponseJson=Rn.prototype.Pa,Rn.prototype.getResponseText=Rn.prototype.$,Rn.prototype.send=Rn.prototype.ba;var wr=Oe,_r=Te,Ir=ve,Er=je,Or=Rn,Tr=n("/6Yf"),Ar=function(t,e,n,r,i,o){this.t=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.i=o},jr=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"o",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Nr=function(){function t(t){this.uid=t}return t.prototype.u=function(){return null!=this.uid},t.prototype.h=function(){return this.u()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();Nr.UNAUTHENTICATED=new Nr(null),Nr.l=new Nr("google-credentials-uid"),Nr._=new Nr("first-party-uid");var Dr=new E.b("@firebase/firestore");function Sr(){return Dr.logLevel}function xr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Dr.logLevel<=E.a.DEBUG){var r=e.map(Cr);Dr.debug.apply(Dr,Object(_.h)(["Firestore (8.1.2): "+t],r))}}function Pr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Dr.logLevel<=E.a.ERROR){var r=e.map(Cr);Dr.error.apply(Dr,Object(_.h)(["Firestore (8.1.2): "+t],r))}}function kr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Dr.logLevel<=E.a.WARN){var r=e.map(Cr);Dr.warn.apply(Dr,Object(_.h)(["Firestore (8.1.2): "+t],r))}}function Cr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Rr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.1.2) INTERNAL ASSERTION FAILED: "+t;throw Pr(e),new Error(e)}function Lr(t,e){t||Rr()}function Ur(t,e){return t}var Mr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Vr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(_.d)(e,t),e}(Error),qr=function(t,e){this.user=e,this.type="OAuth",this.T={},this.T.Authorization="Bearer "+t},Fr=function(){function t(){this.I=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.m=function(){},t.prototype.A=function(t){this.I=t,t(Nr.UNAUTHENTICATED)},t.prototype.R=function(){this.I=null},t}(),Br=function(){function t(t){var e=this;this.P=null,this.currentUser=Nr.UNAUTHENTICATED,this.g=!1,this.V=0,this.I=null,this.forceRefresh=!1,this.P=function(){e.V++,e.currentUser=e.p(),e.g=!0,e.I&&e.I(e.currentUser)},this.V=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.P):(this.P(null),t.get().then((function(t){e.auth=t,e.P&&e.auth.addAuthTokenListener(e.P)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.V,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.V!==e?(xr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Lr("string"==typeof n.accessToken),new qr(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.m=function(){this.forceRefresh=!0},t.prototype.A=function(t){this.I=t,this.g&&t(this.currentUser)},t.prototype.R=function(){this.auth&&this.auth.removeAuthTokenListener(this.P),this.P=null,this.I=null},t.prototype.p=function(){var t=this.auth&&this.auth.getUid();return Lr(null===t||"string"==typeof t),new Nr(t)},t}(),zr=function(){function t(t,e){this.v=t,this.S=e,this.type="FirstParty",this.user=Nr._}return Object.defineProperty(t.prototype,"T",{get:function(){var t={"X-Goog-AuthUser":this.S},e=this.v.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),Gr=function(){function t(t,e){this.v=t,this.S=e}return t.prototype.getToken=function(){return Promise.resolve(new zr(this.v,this.S))},t.prototype.A=function(t){t(Nr._)},t.prototype.R=function(){},t.prototype.m=function(){},t}();function Kr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Wr=function(){function t(){}return t.D=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Kr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Qr(t,e){return t<e?-1:t>e?1:0}function Jr(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Xr(t){return t+"\0"}var $r=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Vr(Mr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Vr(Mr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Vr(Mr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Vr(Mr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.C=function(t){return this.seconds===t.seconds?Qr(this.nanoseconds,t.nanoseconds):Qr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Yr=function(){function t(t){this.timestamp=t}return t.N=function(e){return new t(e)},t.min=function(){return new t(new $r(0,0))},t.prototype.F=function(t){return this.timestamp.C(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.O=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.M=function(){return this.timestamp},t}(),Hr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Rr(),void 0===n?n=t.length-e:n>t.length-e&&Rr(),this.segments=t,this.offset=e,this.k=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.k},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.$(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.L(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.B=function(t){return this.L(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.q=function(){return this.L(this.segments,this.offset,this.length-1)},t.prototype.U=function(){return this.segments[this.offset]},t.prototype.K=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.W=function(){return 0===this.length},t.prototype.j=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.G=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.H=function(){return this.segments.slice(this.offset,this.limit())},t.$=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Zr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.d)(e,t),e.prototype.L=function(t,n,r){return new e(t,n,r)},e.prototype.J=function(){return this.H().join("/")},e.prototype.toString=function(){return this.J()},e.Y=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.X=function(){return new e([])},e}(Hr),ti=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ei=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.d)(e,t),e.prototype.L=function(t,n,r){return new e(t,n,r)},e.Z=function(t){return ti.test(t)},e.prototype.J=function(){return this.H().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.Z(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.J()},e.prototype.tt=function(){return 1===this.length&&"__name__"===this.get(0)},e.et=function(){return new e(["__name__"])},e.nt=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new Vr(Mr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Vr(Mr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===u?(s=!s,i++):"."!==u||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new Vr(Mr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.X=function(){return new e([])},e}(Hr),ni=function(){function t(t){this.path=t}return t.st=function(e){return new t(Zr.Y(e))},t.it=function(e){return new t(Zr.Y(e).B(5))},t.prototype.rt=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Zr.$(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.$=function(t,e){return Zr.$(t.path,e.path)},t.ot=function(t){return t.length%2==0},t.ct=function(e){return new t(new Zr(e.slice()))},t}();function ri(t){return null==t}function ii(t){return 0===t&&1/t==-1/0}function oi(t){return"number"==typeof t&&Number.isInteger(t)&&!ii(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var si=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.ut=null};function ui(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new si(t,e,n,r,i,o,s)}function ai(t){var e=Ur(t);if(null===e.ut){var n=e.path.J();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.J()+t.op.toString()+no(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.J()+t.dir}(t)})).join(","),ri(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=ru(e.startAt)),e.endAt&&(n+="|ub:",n+=ru(e.endAt)),e.ut=n}return e.ut}function ci(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!au(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!Hi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ou(t.startAt,e.startAt)&&ou(t.endAt,e.endAt)}function hi(t){return ni.ot(t.path)&&null===t.collectionGroup&&0===t.filters.length}var fi=function(){function t(t){this.at=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.at)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.at)},t.prototype.ht=function(){return 2*this.at.length},t.prototype.F=function(t){return Qr(this.at,t.at)},t.prototype.isEqual=function(t){return this.at===t.at},t}();fi.lt=new fi("");var li,pi,di=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Yr.min()),void 0===o&&(o=Yr.min()),void 0===s&&(s=fi.lt),this.target=t,this.targetId=e,this._t=n,this.sequenceNumber=r,this.ft=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.dt=function(e){return new t(this.target,this.targetId,this._t,e,this.ft,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.wt=function(e,n){return new t(this.target,this.targetId,this._t,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.Et=function(e){return new t(this.target,this.targetId,this._t,this.sequenceNumber,this.ft,e,this.resumeToken)},t}(),vi=function(t){this.count=t};function yi(t){switch(t){case Mr.OK:return Rr();case Mr.CANCELLED:case Mr.UNKNOWN:case Mr.DEADLINE_EXCEEDED:case Mr.RESOURCE_EXHAUSTED:case Mr.INTERNAL:case Mr.UNAVAILABLE:case Mr.UNAUTHENTICATED:return!1;case Mr.INVALID_ARGUMENT:case Mr.NOT_FOUND:case Mr.ALREADY_EXISTS:case Mr.PERMISSION_DENIED:case Mr.FAILED_PRECONDITION:case Mr.ABORTED:case Mr.OUT_OF_RANGE:case Mr.UNIMPLEMENTED:case Mr.DATA_LOSS:return!0;default:return Rr()}}function gi(t){if(void 0===t)return Pr("GRPC error has no .code"),Mr.UNKNOWN;switch(t){case li.OK:return Mr.OK;case li.CANCELLED:return Mr.CANCELLED;case li.UNKNOWN:return Mr.UNKNOWN;case li.DEADLINE_EXCEEDED:return Mr.DEADLINE_EXCEEDED;case li.RESOURCE_EXHAUSTED:return Mr.RESOURCE_EXHAUSTED;case li.INTERNAL:return Mr.INTERNAL;case li.UNAVAILABLE:return Mr.UNAVAILABLE;case li.UNAUTHENTICATED:return Mr.UNAUTHENTICATED;case li.INVALID_ARGUMENT:return Mr.INVALID_ARGUMENT;case li.NOT_FOUND:return Mr.NOT_FOUND;case li.ALREADY_EXISTS:return Mr.ALREADY_EXISTS;case li.PERMISSION_DENIED:return Mr.PERMISSION_DENIED;case li.FAILED_PRECONDITION:return Mr.FAILED_PRECONDITION;case li.ABORTED:return Mr.ABORTED;case li.OUT_OF_RANGE:return Mr.OUT_OF_RANGE;case li.UNIMPLEMENTED:return Mr.UNIMPLEMENTED;case li.DATA_LOSS:return Mr.DATA_LOSS;default:return Rr()}}(pi=li||(li={}))[pi.OK=0]="OK",pi[pi.CANCELLED=1]="CANCELLED",pi[pi.UNKNOWN=2]="UNKNOWN",pi[pi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",pi[pi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",pi[pi.NOT_FOUND=5]="NOT_FOUND",pi[pi.ALREADY_EXISTS=6]="ALREADY_EXISTS",pi[pi.PERMISSION_DENIED=7]="PERMISSION_DENIED",pi[pi.UNAUTHENTICATED=16]="UNAUTHENTICATED",pi[pi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",pi[pi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",pi[pi.ABORTED=10]="ABORTED",pi[pi.OUT_OF_RANGE=11]="OUT_OF_RANGE",pi[pi.UNIMPLEMENTED=12]="UNIMPLEMENTED",pi[pi.INTERNAL=13]="INTERNAL",pi[pi.UNAVAILABLE=14]="UNAVAILABLE",pi[pi.DATA_LOSS=15]="DATA_LOSS";var bi=function(){function t(t,e){this.$=t,this.root=e||wi.EMPTY}return t.prototype.Tt=function(e,n){return new t(this.$,this.root.Tt(e,n,this.$).copy(null,null,wi.It,null,null))},t.prototype.remove=function(e){return new t(this.$,this.root.remove(e,this.$).copy(null,null,wi.It,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.W();){var n=this.$(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.W();){var r=this.$(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.W=function(){return this.root.W()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.At=function(){return this.root.At()},t.prototype.Rt=function(){return this.root.Rt()},t.prototype.Pt=function(t){return this.root.Pt(t)},t.prototype.forEach=function(t){this.Pt((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.Pt((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.gt=function(t){return this.root.gt(t)},t.prototype.yt=function(){return new mi(this.root,null,this.$,!1)},t.prototype.Vt=function(t){return new mi(this.root,t,this.$,!1)},t.prototype.vt=function(){return new mi(this.root,null,this.$,!0)},t.prototype.bt=function(t){return new mi(this.root,t,this.$,!0)},t}(),mi=function(){function t(t,e,n,r){this.St=r,this.Dt=[];for(var i=1;!t.W();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.St?t.left:t.right;else{if(0===i){this.Dt.push(t);break}this.Dt.push(t),t=this.St?t.right:t.left}}return t.prototype.Ct=function(){var t=this.Dt.pop(),e={key:t.key,value:t.value};if(this.St)for(t=t.left;!t.W();)this.Dt.push(t),t=t.right;else for(t=t.right;!t.W();)this.Dt.push(t),t=t.left;return e},t.prototype.Nt=function(){return this.Dt.length>0},t.prototype.xt=function(){if(0===this.Dt.length)return null;var t=this.Dt[this.Dt.length-1];return{key:t.key,value:t.value}},t}(),wi=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.W=function(){return!1},t.prototype.Pt=function(t){return this.left.Pt(t)||t(this.key,this.value)||this.right.Pt(t)},t.prototype.gt=function(t){return this.right.gt(t)||t(this.key,this.value)||this.left.gt(t)},t.prototype.min=function(){return this.left.W()?this:this.left.min()},t.prototype.At=function(){return this.min().key},t.prototype.Rt=function(){return this.right.W()?this.key:this.right.Rt()},t.prototype.Tt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.Tt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.Tt(t,e,n))).Ft()},t.prototype.Ot=function(){if(this.left.W())return t.EMPTY;var e=this;return e.left.Mt()||e.left.left.Mt()||(e=e.kt()),(e=e.copy(null,null,null,e.left.Ot(),null)).Ft()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.W()||i.left.Mt()||i.left.left.Mt()||(i=i.kt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.Mt()&&(i=i.$t()),i.right.W()||i.right.Mt()||i.right.left.Mt()||(i=i.Lt()),0===n(e,i.key)){if(i.right.W())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.Ot())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.Ft()},t.prototype.Mt=function(){return this.color},t.prototype.Ft=function(){var t=this;return t.right.Mt()&&!t.left.Mt()&&(t=t.Bt()),t.left.Mt()&&t.left.left.Mt()&&(t=t.$t()),t.left.Mt()&&t.right.Mt()&&(t=t.qt()),t},t.prototype.kt=function(){var t=this.qt();return t.right.left.Mt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.$t())).Bt()).qt()),t},t.prototype.Lt=function(){var t=this.qt();return t.left.left.Mt()&&(t=(t=t.$t()).qt()),t},t.prototype.Bt=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.$t=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.qt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Ut=function(){var t=this.Qt();return Math.pow(2,t)<=this.size+1},t.prototype.Qt=function(){if(this.Mt()&&this.left.Mt())throw Rr();if(this.right.Mt())throw Rr();var t=this.left.Qt();if(t!==this.right.Qt())throw Rr();return t+(this.Mt()?0:1)},t}();wi.EMPTY=null,wi.RED=!0,wi.It=!1,wi.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Rr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Rr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Rr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Rr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Rr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.Tt=function(t,e,n){return new wi(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.W=function(){return!0},t.prototype.Pt=function(t){return!1},t.prototype.gt=function(t){return!1},t.prototype.At=function(){return null},t.prototype.Rt=function(){return null},t.prototype.Mt=function(){return!1},t.prototype.Ut=function(){return!0},t.prototype.Qt=function(){return 0},t}());var _i=function(){function t(t){this.$=t,this.data=new bi(this.$)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.At()},t.prototype.last=function(){return this.data.Rt()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.Pt((function(e,n){return t(e),!1}))},t.prototype.Kt=function(t,e){for(var n=this.data.Vt(t[0]);n.Nt();){var r=n.Ct();if(this.$(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Wt=function(t,e){var n;for(n=void 0!==e?this.data.Vt(e):this.data.yt();n.Nt();)if(!t(n.Ct().key))return},t.prototype.jt=function(t){var e=this.data.Vt(t);return e.Nt()?e.Ct().key:null},t.prototype.yt=function(){return new Ii(this.data.yt())},t.prototype.Vt=function(t){return new Ii(this.data.Vt(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).Tt(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.W=function(){return this.data.W()},t.prototype.Gt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.yt(),r=e.data.yt();n.Nt();){var i=n.Ct().key,o=r.Ct().key;if(0!==this.$(i,o))return!1}return!0},t.prototype.H=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.$);return n.data=e,n},t}(),Ii=function(){function t(t){this.zt=t}return t.prototype.Ct=function(){return this.zt.Ct().key},t.prototype.Nt=function(){return this.zt.Nt()},t}(),Ei=new bi(ni.$);function Oi(){return Ei}function Ti(){return Oi()}var Ai=new bi(ni.$);function ji(){return Ai}var Ni=new bi(ni.$),Di=new _i(ni.$);function Si(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Di,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var xi=new _i(Qr);function Pi(){return xi}var ki=function(){function t(t){this.$=t?function(e,n){return t(e,n)||ni.$(e.key,n.key)}:function(t,e){return ni.$(t.key,e.key)},this.Ht=ji(),this.Jt=new bi(this.$)}return t.Yt=function(e){return new t(e.$)},t.prototype.has=function(t){return null!=this.Ht.get(t)},t.prototype.get=function(t){return this.Ht.get(t)},t.prototype.first=function(){return this.Jt.At()},t.prototype.last=function(){return this.Jt.Rt()},t.prototype.W=function(){return this.Jt.W()},t.prototype.indexOf=function(t){var e=this.Ht.get(t);return e?this.Jt.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.Jt.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.Jt.Pt((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Ht.Tt(t.key,t),e.Jt.Tt(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Ht.remove(t),this.Jt.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.Jt.yt(),r=e.Jt.yt();n.Nt();){var i=n.Ct().key,o=r.Ct().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.$=this.$,r.Ht=e,r.Jt=n,r},t}(),Ci=function(){function t(){this.Xt=new bi(ni.$)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Xt.get(e);n?0!==t.type&&3===n.type?this.Xt=this.Xt.Tt(e,t):3===t.type&&1!==n.type?this.Xt=this.Xt.Tt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Xt=this.Xt.Tt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Xt=this.Xt.Tt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Xt=this.Xt.remove(e):1===t.type&&2===n.type?this.Xt=this.Xt.Tt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Xt=this.Xt.Tt(e,{type:2,doc:t.doc}):Rr():this.Xt=this.Xt.Tt(e,t)},t.prototype.Zt=function(){var t=[];return this.Xt.Pt((function(e,n){t.push(n)})),t},t}(),Ri=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.te=n,this.docChanges=r,this.ee=i,this.fromCache=o,this.ne=s,this.se=u}return t.ie=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,ki.Yt(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.ee.W()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.ne===t.ne&&this.ee.isEqual(t.ee)&&Bs(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.te.isEqual(t.te)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Li=function(){function t(t,e,n,r,i){this.ft=t,this.re=e,this.oe=n,this.ce=r,this.ue=i}return t.ae=function(e,n){var r=new Map;return r.set(e,Ui.he(e,n)),new t(Yr.min(),r,Pi(),Oi(),Si())},t}(),Ui=function(){function t(t,e,n,r,i){this.resumeToken=t,this.le=e,this._e=n,this.fe=r,this.de=i}return t.he=function(e,n){return new t(fi.lt,n,Si(),Si(),Si())},t}(),Mi=function(t,e,n,r){this.we=t,this.removedTargetIds=e,this.key=n,this.Ee=r},Vi=function(t,e){this.targetId=t,this.Te=e},qi=function(t,e,n,r){void 0===n&&(n=fi.lt),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Fi=function(){function t(){this.Ie=0,this.me=Gi(),this.Ae=fi.lt,this.Re=!1,this.Pe=!0}return Object.defineProperty(t.prototype,"le",{get:function(){return this.Re},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.Ae},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ge",{get:function(){return 0!==this.Ie},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ye",{get:function(){return this.Pe},enumerable:!1,configurable:!0}),t.prototype.Ve=function(t){t.ht()>0&&(this.Pe=!0,this.Ae=t)},t.prototype.pe=function(){var t=Si(),e=Si(),n=Si();return this.me.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Rr()}})),new Ui(this.Ae,this.Re,t,e,n)},t.prototype.ve=function(){this.Pe=!1,this.me=Gi()},t.prototype.be=function(t,e){this.Pe=!0,this.me=this.me.Tt(t,e)},t.prototype.Se=function(t){this.Pe=!0,this.me=this.me.remove(t)},t.prototype.De=function(){this.Ie+=1},t.prototype.Ce=function(){this.Ie-=1},t.prototype.Ne=function(){this.Pe=!0,this.Re=!0},t}(),Bi=function(){function t(t){this.xe=t,this.Fe=new Map,this.Oe=Oi(),this.Me=zi(),this.ke=new _i(Qr)}return t.prototype.$e=function(t){for(var e=0,n=t.we;e<n.length;e++){var r=n[e];t.Ee instanceof Ns?this.Le(r,t.Ee):t.Ee instanceof Ds&&this.Be(r,t.key,t.Ee)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.Be(o[i],t.key,t.Ee)},t.prototype.qe=function(t){var e=this;this.Ue(t,(function(n){var r=e.Qe(n);switch(t.state){case 0:e.Ke(n)&&r.Ve(t.resumeToken);break;case 1:r.Ce(),r.ge||r.ve(),r.Ve(t.resumeToken);break;case 2:r.Ce(),r.ge||e.removeTarget(n);break;case 3:e.Ke(n)&&(r.Ne(),r.Ve(t.resumeToken));break;case 4:e.Ke(n)&&(e.We(n),r.Ve(t.resumeToken));break;default:Rr()}}))},t.prototype.Ue=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Fe.forEach((function(t,r){n.Ke(r)&&e(r)}))},t.prototype.je=function(t){var e=t.targetId,n=t.Te.count,r=this.Ge(e);if(r){var i=r.target;if(hi(i))if(0===n){var o=new ni(i.path);this.Be(e,o,new Ds(o,Yr.min()))}else Lr(1===n);else this.ze(e)!==n&&(this.We(e),this.ke=this.ke.add(e))}},t.prototype.He=function(t){var e=this,n=new Map;this.Fe.forEach((function(r,i){var o=e.Ge(i);if(o){if(r.le&&hi(o.target)){var s=new ni(o.target.path);null!==e.Oe.get(s)||e.Je(i,s)||e.Be(i,s,new Ds(s,t))}r.ye&&(n.set(i,r.pe()),r.ve())}}));var r=Si();this.Me.forEach((function(t,n){var i=!0;n.Wt((function(t){var n=e.Ge(t);return!n||2===n._t||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new Li(t,n,this.ke,this.Oe,r);return this.Oe=Oi(),this.Me=zi(),this.ke=new _i(Qr),i},t.prototype.Le=function(t,e){if(this.Ke(t)){var n=this.Je(t,e.key)?2:0;this.Qe(t).be(e.key,n),this.Oe=this.Oe.Tt(e.key,e),this.Me=this.Me.Tt(e.key,this.Ye(e.key).add(t))}},t.prototype.Be=function(t,e,n){if(this.Ke(t)){var r=this.Qe(t);this.Je(t,e)?r.be(e,1):r.Se(e),this.Me=this.Me.Tt(e,this.Ye(e).delete(t)),n&&(this.Oe=this.Oe.Tt(e,n))}},t.prototype.removeTarget=function(t){this.Fe.delete(t)},t.prototype.ze=function(t){var e=this.Qe(t).pe();return this.xe.Xe(t).size+e._e.size-e.de.size},t.prototype.De=function(t){this.Qe(t).De()},t.prototype.Qe=function(t){var e=this.Fe.get(t);return e||(e=new Fi,this.Fe.set(t,e)),e},t.prototype.Ye=function(t){var e=this.Me.get(t);return e||(e=new _i(Qr),this.Me=this.Me.Tt(t,e)),e},t.prototype.Ke=function(t){var e=null!==this.Ge(t);return e||xr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.Ge=function(t){var e=this.Fe.get(t);return e&&e.ge?null:this.xe.Ze(t)},t.prototype.We=function(t){var e=this;this.Fe.set(t,new Fi),this.xe.Xe(t).forEach((function(n){e.Be(t,n,null)}))},t.prototype.Je=function(t,e){return this.xe.Xe(t).has(e)},t}();function zi(){return new bi(ni.$)}function Gi(){return new bi(ni.$)}function Ki(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Wi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Qi(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ji(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Xi(t){var e=ro(t.mapValue.fields.__local_write_time__.timestampValue);return new $r(e.seconds,e.nanos)}var $i=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Yi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ji(t)?4:10:Rr()}function Hi(t,e){var n=Yi(t);if(n!==Yi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Xi(t).isEqual(Xi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=ro(t.timestampValue),r=ro(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return oo(t.bytesValue).isEqual(oo(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return io(t.geoPointValue.latitude)===io(e.geoPointValue.latitude)&&io(t.geoPointValue.longitude)===io(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return io(t.integerValue)===io(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=io(t.doubleValue),r=io(e.doubleValue);return n===r?ii(n)===ii(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Jr(t.arrayValue.values||[],e.arrayValue.values||[],Hi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Ki(n)!==Ki(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Hi(n[i],r[i])))return!1;return!0}(t,e);default:return Rr()}}function Zi(t,e){return void 0!==(t.values||[]).find((function(t){return Hi(t,e)}))}function to(t,e){var n=Yi(t),r=Yi(e);if(n!==r)return Qr(n,r);switch(n){case 0:return 0;case 1:return Qr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=io(t.integerValue||t.doubleValue),r=io(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return eo(t.timestampValue,e.timestampValue);case 4:return eo(Xi(t),Xi(e));case 5:return Qr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=oo(t),r=oo(e);return n.F(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Qr(n[i],r[i]);if(0!==o)return o}return Qr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Qr(io(t.latitude),io(e.latitude));return 0!==n?n:Qr(io(t.longitude),io(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=to(n[i],r[i]);if(o)return o}return Qr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Qr(r[s],o[s]);if(0!==u)return u;var a=to(n[r[s]],i[o[s]]);if(0!==a)return a}return Qr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Rr()}}function eo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Qr(t,e);var n=ro(t),r=ro(e),i=Qr(n.seconds,r.seconds);return 0!==i?i:Qr(n.nanos,r.nanos)}function no(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=ro(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?oo(e.bytesValue).toBase64():"referenceValue"in e?ni.it(e.referenceValue).toString():"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):Rr();var n}(t)}function ro(t){if(Lr(!!t),"string"==typeof t){var e=0,n=$i.exec(t);if(Lr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:io(t.seconds),nanos:io(t.nanos)}}function io(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function oo(t){return"string"==typeof t?fi.fromBase64String(t):fi.fromUint8Array(t)}function so(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.J()}}function uo(t){return!!t&&"integerValue"in t}function ao(t){return!!t&&"arrayValue"in t}function co(t){return!!t&&"nullValue"in t}function ho(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function fo(t){return!!t&&"mapValue"in t}var lo={asc:"ASCENDING",desc:"DESCENDING"},po={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vo=function(t,e){this.t=t,this.tn=e};function yo(t){return{integerValue:""+t}}function go(t,e){if(t.tn){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ii(e)?"-0":e}}function bo(t,e){return oi(e)?yo(e):go(t,e)}function mo(t,e){return t.tn?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function wo(t,e){return t.tn?e.toBase64():e.toUint8Array()}function _o(t,e){return mo(t,e.M())}function Io(t){return Lr(!!t),Yr.N(function(t){var e=ro(t);return new $r(e.seconds,e.nanos)}(t))}function Eo(t,e){return function(t){return new Zr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).J()}function Oo(t){var e=Zr.Y(t);return Lr(Wo(e)),e}function To(t,e){return Eo(t.t,e.path)}function Ao(t,e){var n=Oo(e);if(n.get(1)!==t.t.projectId)throw new Vr(Mr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.t.projectId);if(n.get(3)!==t.t.database)throw new Vr(Mr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.t.database);return new ni(So(n))}function jo(t,e){return Eo(t.t,e)}function No(t){var e=Oo(t);return 4===e.length?Zr.X():So(e)}function Do(t){return new Zr(["projects",t.t.projectId,"databases",t.t.database]).J()}function So(t){return Lr(t.length>4&&"documents"===t.get(4)),t.B(5)}function xo(t,e,n){return{name:To(t,e),fields:n.proto.mapValue.fields}}function Po(t,e){var n;if(e instanceof ys)n={update:xo(t,e.key,e.value)};else if(e instanceof Is)n={delete:To(t,e.key)};else if(e instanceof gs)n={update:xo(t,e.key,e.data),updateMask:Ko(e.en)};else if(e instanceof ms)n={transform:{document:To(t,e.key),fieldTransforms:e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Yo)return{fieldPath:e.field.J(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ho)return{fieldPath:e.field.J(),appendMissingElements:{values:n.elements}};if(n instanceof ts)return{fieldPath:e.field.J(),removeAllFromArray:{values:n.elements}};if(n instanceof ns)return{fieldPath:e.field.J(),increment:n.nn};throw Rr()}(0,t)}))}};else{if(!(e instanceof Es))return Rr();n={verify:To(t,e.key)}}return e.rn.sn||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:_o(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Rr()}(t,e.rn)),n}function ko(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?as.updateTime(Io(t.updateTime)):void 0!==t.exists?as.exists(t.exists):as.on()}(e.currentDocument):as.on();if(e.update){var r=Ao(t,e.update.name),i=new Os({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){return new os((t.fieldPaths||[]).map((function(t){return ei.nt(t)})))}(e.updateMask);return new gs(r,i,o,n)}return new ys(r,i,n)}if(e.delete){var s=Ao(t,e.delete);return new Is(s,n)}if(e.transform){var u=Ao(t,e.transform.document),a=e.transform.fieldTransforms.map((function(e){return function(t,e){var n=null;"setToServerValue"in e?(Lr("REQUEST_TIME"===e.setToServerValue),n=new Yo):"appendMissingElements"in e?n=new Ho(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new ts(e.removeAllFromArray.values||[]):"increment"in e?n=new ns(t,e.increment):Rr();var r=ei.nt(e.fieldPath);return new ss(r,n)}(t,e)}));return Lr(!0===n.exists),new ms(u,a)}if(e.verify){var c=Ao(t,e.verify);return new Es(c,n)}return Rr()}function Co(t,e){return{documents:[jo(t,e.path)]}}function Ro(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=jo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=jo(t,r.q()),n.structuredQuery.from=[{collectionId:r.K()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(ho(t.value))return{unaryFilter:{field:Fo(t.field),op:"IS_NAN"}};if(co(t.value))return{unaryFilter:{field:Fo(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ho(t.value))return{unaryFilter:{field:Fo(t.field),op:"IS_NOT_NAN"}};if(co(t.value))return{unaryFilter:{field:Fo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fo(t.field),op:qo(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Fo(t.field),direction:Vo(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.tn||ri(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Uo(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Uo(e.endAt)),n}function Lo(t){var e=No(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Lr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[Go(e)]:void 0!==e.fieldFilter?[zo(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):Rr():[]}(n.where));var u=[];n.orderBy&&(u=n.orderBy.map((function(t){return function(t){return new su(Bo(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var a=null;n.limit&&(a=function(t){var e;return ri(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Mo(n.startAt));var h=null;return n.endAt&&(h=Mo(n.endAt)),Ps(e,i,u,s,a,"F",c,h)}function Uo(t){return{before:t.before,values:t.position}}function Mo(t){return new nu(t.values||[],!!t.before)}function Vo(t){return lo[t]}function qo(t){return po[t]}function Fo(t){return{fieldPath:t.J()}}function Bo(t){return ei.nt(t.fieldPath)}function zo(t){return Qs.create(Bo(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Rr()}}(t.fieldFilter.op),t.fieldFilter.value)}function Go(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Bo(t.unaryFilter.field);return Qs.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Bo(t.unaryFilter.field);return Qs.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Bo(t.unaryFilter.field);return Qs.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Bo(t.unaryFilter.field);return Qs.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Rr()}}function Ko(t){var e=[];return t.fields.forEach((function(t){return e.push(t.J())})),{fieldPaths:e}}function Wo(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}var Qo=function(){this.cn=void 0};function Jo(t,e,n){return t instanceof Yo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ho?Zo(t,e):t instanceof ts?es(t,e):function(t,e){var n=$o(t,e),r=rs(n)+rs(t.nn);return uo(n)&&uo(t.nn)?yo(r):go(t.serializer,r)}(t,e)}function Xo(t,e,n){return t instanceof Ho?Zo(t,e):t instanceof ts?es(t,e):n}function $o(t,e){return t instanceof ns?uo(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Yo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.d)(e,t),e}(Qo),Ho=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(_.d)(e,t),e}(Qo);function Zo(t,e){for(var n=is(e),r=function(t){n.some((function(e){return Hi(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ts=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(_.d)(e,t),e}(Qo);function es(t,e){for(var n=is(e),r=function(t){n=n.filter((function(e){return!Hi(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ns=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).serializer=e,r.nn=n,r}return Object(_.d)(e,t),e}(Qo);function rs(t){return io(t.integerValue||t.doubleValue)}function is(t){return ao(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var os=function(){function t(t){this.fields=t,t.sort(ei.$)}return t.prototype.un=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].j(t))return!0;return!1},t.prototype.isEqual=function(t){return Jr(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),ss=function(t,e){this.field=t,this.transform=e},us=function(t,e){this.version=t,this.transformResults=e},as=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.on=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"sn",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function cs(t,e){return void 0!==t.updateTime?e instanceof Ns&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Ns}var hs=function(){};function fs(t,e,n){return t instanceof ys?function(t,e,n){return new Ns(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof gs?function(t,e,n){if(!cs(t.rn,e))return new Ss(t.key,n.version);var r=bs(t,e);return new Ns(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof ms?function(t,e,n){if(Lr(null!=n.transformResults),!cs(t.rn,e))return new Ss(t.key,n.version);var r=ws(0,e),i=function(t,e,n){var r=[];Lr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof Ns&&(u=e.field(o.field)),r.push(Xo(s,u,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=_s(t,r.data(),i);return new Ns(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new Ds(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function ls(t,e,n,r){return t instanceof ys?function(t,e){if(!cs(t.rn,e))return e;var n=vs(e);return new Ns(t.key,n,t.value,{an:!0})}(t,e):t instanceof gs?function(t,e){if(!cs(t.rn,e))return e;var n=vs(e),r=bs(t,e);return new Ns(t.key,n,r,{an:!0})}(t,e):t instanceof ms?function(t,e,n,r){if(!cs(t.rn,e))return e;var i=ws(0,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof Ns&&(c=n.field(u.field)),null===c&&r instanceof Ns&&(c=r.field(u.field)),i.push(Jo(a,c,e))}return i}(t.fieldTransforms,n,e,r),s=_s(t,i.data(),o);return new Ns(t.key,i.version,s,{an:!0})}(t,e,r,n):function(t,e){return cs(t.rn,e)?new Ds(t.key,Yr.min()):e}(t,e)}function ps(t,e){return t instanceof ms?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e instanceof Ns?e.field(o.field):void 0,u=$o(o.transform,s||null);null!=u&&(n=null==n?(new Ts).set(o.field,u):n.set(o.field,u))}return n?n.hn():null}(t,e):null}function ds(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.rn.isEqual(e.rn)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.en.isEqual(e.en):2!==t.type||Jr(t.fieldTransforms,t.fieldTransforms,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ho&&e instanceof Ho||t instanceof ts&&e instanceof ts?Jr(t.elements,e.elements,Hi):t instanceof ns&&e instanceof ns?Hi(t.nn,e.nn):t instanceof Yo&&e instanceof Yo}(t.transform,e.transform)}(t,e)})))}function vs(t){return t instanceof Ns?t.version:Yr.min()}var ys=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).key=e,i.value=n,i.rn=r,i.type=0,i}return Object(_.d)(e,t),e}(hs),gs=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.en=r,o.rn=i,o.type=1,o}return Object(_.d)(e,t),e}(hs);function bs(t,e){return function(t,e){var n=new Ts(e);return t.en.fields.forEach((function(e){if(!e.W()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.hn()}(t,e instanceof Ns?e.data():Os.empty())}var ms=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.fieldTransforms=n,r.type=2,r.rn=as.exists(!0),r}return Object(_.d)(e,t),e}(hs);function ws(t,e){return e}function _s(t,e,n){for(var r=new Ts(e),i=0;i<t.fieldTransforms.length;i++)r.set(t.fieldTransforms[i].field,n[i]);return r.hn()}var Is=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.rn=n,r.type=3,r}return Object(_.d)(e,t),e}(hs),Es=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.rn=n,r.type=4,r}return Object(_.d)(e,t),e}(hs),Os=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.W())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!fo(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.K()])||null},t.prototype.isEqual=function(t){return Hi(this.proto,t.proto)},t}(),Ts=function(){function t(t){void 0===t&&(t=Os.empty()),this.ln=t,this._n=new Map}return t.prototype.set=function(t,e){return this.fn(t,e),this},t.prototype.delete=function(t){return this.fn(t,null),this},t.prototype.fn=function(t,e){for(var n=this._n,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===Yi(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.K(),e)},t.prototype.hn=function(){var t=this.dn(ei.X(),this._n);return null!=t?new Os(t):this.ln},t.prototype.dn=function(t,e){var n=this,r=!1,i=this.ln.field(t),o=fo(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.dn(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function As(t){var e=[];return Wi(t.fields||{},(function(t,n){var r=new ei([t]);if(fo(n)){var i=As(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)})),new os(e)}var js=function(t,e){this.key=t,this.version=e},Ns=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).wn=r,o.an=!!i.an,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return Object(_.d)(e,t),e.prototype.field=function(t){return this.wn.field(t)},e.prototype.data=function(){return this.wn},e.prototype.En=function(){return this.wn.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.an===t.an&&this.hasCommittedMutations===t.hasCommittedMutations&&this.wn.isEqual(t.wn)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.wn.toString()+", {hasLocalMutations: "+this.an+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.an||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(js),Ds=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Object(_.d)(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(js),Ss=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.d)(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(js),xs=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.Tn=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.In=null,this.mn=null};function Ps(t,e,n,r,i,o,s,u){return new xs(t,e,n,r,i,o,s,u)}function ks(t){return new xs(t)}function Cs(t){return!ri(t.limit)&&"F"===t.limitType}function Rs(t){return!ri(t.limit)&&"L"===t.limitType}function Ls(t){return t.Tn.length>0?t.Tn[0].field:null}function Us(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.An())return r.field}return null}function Ms(t){return null!==t.collectionGroup}function Vs(t){var e=Ur(t);if(null===e.In){e.In=[];var n=Us(e),r=Ls(e);if(null!==n&&null===r)n.tt()||e.In.push(new su(n)),e.In.push(new su(ei.et(),"asc"));else{for(var i=!1,o=0,s=e.Tn;o<s.length;o++){var u=s[o];e.In.push(u),u.field.tt()&&(i=!0)}if(!i){var a=e.Tn.length>0?e.Tn[e.Tn.length-1].dir:"asc";e.In.push(new su(ei.et(),a))}}}return e.In}function qs(t){var e=Ur(t);if(!e.mn)if("F"===e.limitType)e.mn=ui(e.path,e.collectionGroup,Vs(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Vs(e);r<i.length;r++){var o=i[r];n.push(new su(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new nu(e.endAt.position,!e.endAt.before):null,u=e.startAt?new nu(e.startAt.position,!e.startAt.before):null;e.mn=ui(e.path,e.collectionGroup,n,e.filters,e.limit,s,u)}return e.mn}function Fs(t,e,n){return new xs(t.path,t.collectionGroup,t.Tn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Bs(t,e){return ci(qs(t),qs(e))&&t.limitType===e.limitType}function zs(t){return ai(qs(t))+"|lt:"+t.limitType}function Gs(t){return"Query(target="+function(t){var e=t.path.J();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.J()+" "+e.op+" "+no(e.value);var e})).join(", ")+"]"),ri(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.J()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+ru(t.startAt)),t.endAt&&(e+=", endAt: "+ru(t.endAt)),"Target("+e+")"}(qs(t))+"; limitType="+t.limitType+")"}function Ks(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.rt(t.collectionGroup)&&t.path.j(n):ni.ot(t.path)?t.path.isEqual(n):t.path.G(n)}(t,e)&&function(t,e){for(var n=0,r=t.Tn;n<r.length;n++){var i=r[n];if(!i.field.tt()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!iu(t.startAt,Vs(t),e)||t.endAt&&iu(t.endAt,Vs(t),e))}(t,e)}function Ws(t){return function(e,n){for(var r=!1,i=0,o=Vs(t);i<o.length;i++){var s=o[i],u=uu(s,e,n);if(0!==u)return u;r=r||s.field.tt()}return 0}}var Qs=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(_.d)(e,t),e.create=function(t,n,r){return t.tt()?"in"===n||"not-in"===n?this.Rn(t,n,r):new Js(t,n,r):"array-contains"===n?new Hs(t,r):"in"===n?new Zs(t,r):"not-in"===n?new tu(t,r):"array-contains-any"===n?new eu(t,r):new e(t,n,r)},e.Rn=function(t,e,n){return"in"===e?new Xs(t,n):new $s(t,n)},e.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.Pn(to(e,this.value)):null!==e&&Yi(this.value)===Yi(e)&&this.Pn(to(e,this.value))},e.prototype.Pn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Rr()}},e.prototype.An=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),Js=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=ni.it(r.referenceValue),i}return Object(_.d)(e,t),e.prototype.matches=function(t){var e=ni.$(t.key,this.key);return this.Pn(e)},e}(Qs),Xs=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Ys(0,n),r}return Object(_.d)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Qs),$s=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Ys(0,n),r}return Object(_.d)(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Qs);function Ys(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return ni.it(t.referenceValue)}))}var Hs=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(_.d)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return ao(e)&&Zi(e.arrayValue,this.value)},e}(Qs),Zs=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(_.d)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Zi(this.value.arrayValue,e)},e}(Qs),tu=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(_.d)(e,t),e.prototype.matches=function(t){if(Zi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!Zi(this.value.arrayValue,e)},e}(Qs),eu=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(_.d)(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!ao(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Zi(e.value.arrayValue,t)}))},e}(Qs),nu=function(t,e){this.position=t,this.before=e};function ru(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return no(t)})).join(",")}function iu(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.tt()?ni.$(ni.it(s.referenceValue),n.key):to(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ou(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Hi(t.position[n],e.position[n]))return!1;return!0}var su=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function uu(t,e,n){var r=t.field.tt()?ni.$(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?to(r,i):Rr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Rr()}}function au(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var cu=function(){function t(t,e,n,r){this.batchId=t,this.gn=e,this.baseMutations=n,this.mutations=r}return t.prototype.yn=function(t,e,n){for(var r=n.Vn,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=fs(o,e,r[i]))}return e},t.prototype.pn=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=ls(i,e,e,this.gn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=ls(a,e,o,this.gn))}return e},t.prototype.vn=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.pn(r.key,t.get(r.key));i&&(n=n.Tt(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Si())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Jr(this.mutations,t.mutations,(function(t,e){return ds(t,e)}))&&Jr(this.baseMutations,t.baseMutations,(function(t,e){return ds(t,e)}))},t}(),hu=function(){function t(t,e,n,r){this.batch=t,this.bn=e,this.Vn=n,this.Sn=r}return t.from=function(e,n,r){Lr(e.mutations.length===r.length);for(var i=Ni,o=e.mutations,s=0;s<o.length;s++)i=i.Tt(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),fu=function(){function t(t,e){this.Dn=t,this.Cn=e,this.Nn={}}return t.prototype.get=function(t){var e=this.Dn(t),n=this.Nn[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.Cn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.Dn(t),r=this.Nn[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.Cn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.Nn[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.Dn(t),n=this.Nn[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.Cn(n[r][0],t))return 1===n.length?delete this.Nn[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Wi(this.Nn,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}}))},t.prototype.W=function(){return Qi(this.Nn)},t}(),lu=function(){function t(t){var e=this;this.xn=null,this.Fn=null,this.result=void 0,this.error=void 0,this.On=!1,this.Mn=!1,t((function(t){e.On=!0,e.result=t,e.xn&&e.xn(t)}),(function(t){e.On=!0,e.error=t,e.Fn&&e.Fn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Mn&&Rr(),this.Mn=!0,this.On?this.error?this.kn(n,this.error):this.$n(e,this.result):new t((function(t,i){r.xn=function(n){r.$n(e,n).next(t,i)},r.Fn=function(e){r.kn(n,e).next(t,i)}}))},t.prototype.Ln=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.Bn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.$n=function(e,n){return e?this.Bn((function(){return e(n)})):t.resolve(n)},t.prototype.kn=function(e,n){return e?this.Bn((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.qn=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.Un=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.qn(r)},t}(),pu=function(){function t(){this.Qn=new fu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.Kn=!1}return t.prototype.Wn=function(t){var e=this.Qn.get(t);return e?e.readTime:Yr.min()},t.prototype.jn=function(t,e){this.Gn(),this.Qn.set(t.key,{zn:t,readTime:e})},t.prototype.Hn=function(t,e){void 0===e&&(e=null),this.Gn(),this.Qn.set(t,{zn:null,readTime:e})},t.prototype.Jn=function(t,e){this.Gn();var n=this.Qn.get(e);return void 0!==n?lu.resolve(n.zn):this.Yn(t,e)},t.prototype.getEntries=function(t,e){return this.Xn(t,e)},t.prototype.apply=function(t){return this.Gn(),this.Kn=!0,this.Zn(t)},t.prototype.Gn=function(){},t}(),du=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))};function vu(t){return new vo(t,!0)}function yu(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var gu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",bu=function(){function t(){this.ts=[]}return t.prototype.es=function(t){this.ts.push(t)},t.prototype.ns=function(){this.ts.forEach((function(t){return t()}))},t}(),mu=function(){function t(t,e,n){this.ss=t,this.rs=e,this.os=n}return t.prototype.cs=function(t,e){var n=this;return this.rs.us(t,e).next((function(r){return n.hs(t,e,r)}))},t.prototype.hs=function(t,e,n){return this.ss.Jn(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].pn(e,t);return t}))},t.prototype.ls=function(t,e,n){var r=Ti();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].pn(t,e);r=r.Tt(t,e)})),r},t.prototype._s=function(t,e){var n=this;return this.ss.getEntries(t,e).next((function(e){return n.fs(t,e)}))},t.prototype.fs=function(t,e){var n=this;return this.rs.ds(t,e).next((function(r){var i=n.ls(t,e,r),o=Oi();return i.forEach((function(t,e){e||(e=new Ds(t,Yr.min())),o=o.Tt(t,e)})),o}))},t.prototype.ws=function(t,e,n){return function(t){return ni.ot(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Es(t,e.path):Ms(e)?this.Ts(t,e,n):this.Is(t,e,n)},t.prototype.Es=function(t,e){return this.cs(t,new ni(e)).next((function(t){var e=ji();return t instanceof Ns&&(e=e.Tt(t.key,t)),e}))},t.prototype.Ts=function(t,e,n){var r=this,i=e.collectionGroup,o=ji();return this.os.As(t,i).next((function(s){return lu.forEach(s,(function(s){var u=function(t,e){return new xs(e,null,t.Tn.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.Is(t,u,n).next((function(t){t.forEach((function(t,e){o=o.Tt(t,e)}))}))})).next((function(){return o}))}))},t.prototype.Is=function(t,e,n){var r,i,o=this;return this.ss.ws(t,e,n).next((function(n){return r=n,o.rs.Rs(t,e)})).next((function(e){return o.Ps(t,i=e,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=r.get(c),f=ls(a,h,h,o.gn);r=f instanceof Ns?r.Tt(c,f):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){Ks(e,n)||(r=r.remove(t))})),r}))},t.prototype.Ps=function(t,e,n){for(var r=Si(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof gs&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.ss.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof Ns&&(c=c.Tt(t,e))})),c}))},t}(),wu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.gs=n,this.ys=r}return t.Vs=function(e,n){for(var r=Si(),i=Si(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),_u=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.ps=function(t){return n.vs(t)},this.bs=function(t){return e.Ss(t)})}return t.prototype.vs=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.bs&&this.bs(t),t},t}();_u.Ds=-1;var Iu=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Cs=t,this.Ns=e,this.xs=n,this.Fs=r,this.Os=i,this.Ms=0,this.ks=null,this.$s=Date.now(),this.reset()}return t.prototype.reset=function(){this.Ms=0},t.prototype.Ls=function(){this.Ms=this.Os},t.prototype.Bs=function(t){var e=this;this.cancel();var n=Math.floor(this.Ms+this.qs()),r=Math.max(0,Date.now()-this.$s),i=Math.max(0,n-r);i>0&&xr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Ms+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.ks=this.Cs.Us(this.Ns,i,(function(){return e.$s=Date.now(),t()})),this.Ms*=this.Fs,this.Ms<this.xs&&(this.Ms=this.xs),this.Ms>this.Os&&(this.Ms=this.Os)},t.prototype.Qs=function(){null!==this.ks&&(this.ks.Ks(),this.ks=null)},t.prototype.cancel=function(){null!==this.ks&&(this.ks.cancel(),this.ks=null)},t.prototype.qs=function(){return(Math.random()-.5)*this.Ms},t}(),Eu=function(){function t(e,n,r){this.name=e,this.version=n,this.Ws=r,12.2===t.js(Object(O.n)())&&Pr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return xr("SimpleDb","Removing database:",t),Du(window.indexedDB.deleteDatabase(t)).Ln()},t.Gs=function(){if("undefined"==typeof indexedDB)return!1;if(t.zs())return!0;var e=Object(O.n)(),n=t.js(e),r=0<n&&n<10,i=t.Hs(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.zs=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Js)},t.Ys=function(t,e){return t.store(e)},t.js=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Hs=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.Xs=function(t){return Object(_.b)(this,void 0,void 0,(function(){var e,n=this;return Object(_.e)(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(xr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Tu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new Vr(Mr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Tu(t,n))},i.onupgradeneeded=function(t){xr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.Ws.createOrUpgrade(t.target.result,i.transaction,t.oldVersion,n.version).next((function(){xr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.Zs&&(this.db.onversionchange=function(t){return n.Zs(t)}),this.db)]}}))}))},t.prototype.ti=function(t){this.Zs=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(_.b)(this,void 0,void 0,(function(){var i,o,s,u,a;return Object(_.e)(this,(function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,a,c,h;return Object(_.e)(this,(function(f){switch(f.label){case 0:++o,f.label=1;case 1:return f.trys.push([1,4,,5]),[4,u.Xs(t)];case 2:return u.db=f.sent(),e=ju.open(u.db,t,i?"readonly":"readwrite",n),s=r(e).catch((function(t){return e.abort(t),lu.reject(t)})).Ln(),a={},s.catch((function(){})),[4,e.ei];case 3:return[2,(a.value=(f.sent(),s),a)];case 4:return xr("SimpleDb","Transaction failed with error:",(c=f.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),u.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},u=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(a=c.sent()))return[2,a.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Ou=function(){function t(t){this.ni=t,this.si=!1,this.ii=null}return Object.defineProperty(t.prototype,"On",{get:function(){return this.si},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ri",{get:function(){return this.ii},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.ni=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.si=!0},t.prototype.oi=function(t){this.ii=t},t.prototype.delete=function(){return Du(this.ni.delete())},t}(),Tu=function(t){function e(e,n){var r=this;return(r=t.call(this,Mr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(_.d)(e,t),e}(Vr);function Au(t){return"IndexedDbTransactionError"===t.name}var ju=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ci=new du,this.transaction.oncomplete=function(){n.ci.resolve()},this.transaction.onabort=function(){e.error?n.ci.reject(new Tu(t,e.error)):n.ci.resolve()},this.transaction.onerror=function(e){var r=xu(e.target.error);n.ci.reject(new Tu(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Tu(n,e)}},Object.defineProperty(t.prototype,"ei",{get:function(){return this.ci.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ci.reject(t),this.aborted||(xr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Nu(e)},t}(),Nu=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(xr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(xr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Du(n)},t.prototype.add=function(t){return xr("SimpleDb","ADD",this.store.name,t,t),Du(this.store.add(t))},t.prototype.get=function(t){var e=this;return Du(this.store.get(t)).next((function(n){return void 0===n&&(n=null),xr("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return xr("SimpleDb","DELETE",this.store.name,t),Du(this.store.delete(t))},t.prototype.count=function(){return xr("SimpleDb","COUNT",this.store.name),Du(this.store.count())},t.prototype.ui=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.ai(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.hi=function(t,e){xr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.li=!1;var r=this.cursor(n);return this.ai(r,(function(t,e,n){return n.delete()}))},t.prototype._i=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.ai(r,e)},t.prototype.fi=function(t){var e=this.cursor({});return new lu((function(n,r){e.onerror=function(t){var e=xu(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.ai=function(t,e){var n=[];return new lu((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Ou(i),s=e(i.primaryKey,i.value,o);if(s instanceof lu){var u=s.catch((function(t){return o.done(),lu.reject(t)}));n.push(u)}o.On?r():null===o.ri?i.continue():i.continue(o.ri)}else r()}})).next((function(){return lu.qn(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.li?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Du(t){return new lu((function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=xu(t.target.error);n(e)}}))}var Su=!1;function xu(t){var e=Eu.js(Object(O.n)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Vr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Su||(Su=!0,setTimeout((function(){throw r}),0)),r}}return t}function Pu(){return"undefined"!=typeof window?window:null}function ku(){return"undefined"!=typeof document?document:null}var Cu=function(){function t(t,e,n,r,i){this.di=t,this.Ns=e,this.wi=n,this.op=r,this.Ei=i,this.Ti=new du,this.then=this.Ti.promise.then.bind(this.Ti.promise),this.Ti.promise.catch((function(t){}))}return t.Ii=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.mi=setTimeout((function(){return e.Ai()}),t)},t.prototype.Ks=function(){return this.Ai()},t.prototype.cancel=function(t){null!==this.mi&&(this.clearTimeout(),this.Ti.reject(new Vr(Mr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.Ai=function(){var t=this;this.di.Ri((function(){return null!==t.mi?(t.clearTimeout(),t.op().then((function(e){return t.Ti.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.mi&&(this.Ei(this),clearTimeout(this.mi),this.mi=null)},t}(),Ru=function(){function t(){var t=this;this.Pi=Promise.resolve(),this.gi=[],this.yi=!1,this.Vi=[],this.pi=null,this.vi=!1,this.bi=[],this.Si=new Iu(this,"async_queue_retry"),this.Di=function(){var e=ku();e&&xr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Si.Qs()};var e=ku();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Di)}return Object.defineProperty(t.prototype,"Ci",{get:function(){return this.yi},enumerable:!1,configurable:!0}),t.prototype.Ri=function(t){this.enqueue(t)},t.prototype.Ni=function(t){this.xi(),this.Fi(t)},t.prototype.Oi=function(){if(!this.yi){this.yi=!0;var t=ku();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Di)}},t.prototype.enqueue=function(t){return this.xi(),this.yi?new Promise((function(t){})):this.Fi(t)},t.prototype.Mi=function(t){var e=this;this.Ri((function(){return e.gi.push(t),e.ki()}))},t.prototype.ki=function(){return Object(_.b)(this,void 0,void 0,(function(){var t,e=this;return Object(_.e)(this,(function(n){switch(n.label){case 0:if(0===this.gi.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.gi[0]()];case 2:return n.sent(),this.gi.shift(),this.Si.reset(),[3,4];case 3:if(!Au(t=n.sent()))throw t;return xr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.gi.length>0&&this.Si.Bs((function(){return e.ki()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Fi=function(t){var e=this,n=this.Pi.then((function(){return e.vi=!0,t().catch((function(t){throw e.pi=t,e.vi=!1,Pr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.vi=!1,t}))}));return this.Pi=n,n},t.prototype.Us=function(t,e,n){var r=this;this.xi(),this.bi.indexOf(t)>-1&&(e=0);var i=Cu.Ii(this,t,e,n,(function(t){return r.$i(t)}));return this.Vi.push(i),i},t.prototype.xi=function(){this.pi&&Rr()},t.prototype.Li=function(){},t.prototype.Bi=function(){return Object(_.b)(this,void 0,void 0,(function(){var t;return Object(_.e)(this,(function(e){switch(e.label){case 0:return[4,t=this.Pi];case 1:e.sent(),e.label=2;case 2:if(t!==this.Pi)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.qi=function(t){for(var e=0,n=this.Vi;e<n.length;e++)if(n[e].Ns===t)return!0;return!1},t.prototype.Ui=function(t){var e=this;return this.Bi().then((function(){e.Vi.sort((function(t,e){return t.wi-e.wi}));for(var n=0,r=e.Vi;n<r.length;n++){var i=r[n];if(i.Ks(),"all"!==t&&i.Ns===t)break}return e.Bi()}))},t.prototype.Qi=function(t){this.bi.push(t)},t.prototype.$i=function(t){var e=this.Vi.indexOf(t);this.Vi.splice(e,1)},t}();function Lu(t,e){if(Pr("AsyncQueue",e+": "+t),Au(t))return new Vr(Mr.UNAVAILABLE,e+": "+t);throw t}function Uu(t,e){var n=t[1],r=e[1],i=Qr(t[0],e[0]);return 0===i?Qr(n,r):i}var Mu=function(){function t(t){this.Ki=t,this.buffer=new _i(Uu),this.Wi=0}return t.prototype.ji=function(){return++this.Wi},t.prototype.Gi=function(t){var e=[t,this.ji()];if(this.buffer.size<this.Ki)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Uu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Vu={zi:!1,Hi:0,Ji:0,Yi:0},qu=function(){function t(t,e,n){this.Xi=t,this.Zi=e,this.tr=n}return t.er=function(e){return new t(e,t.nr,t.sr)},t}();qu.nr=10,qu.sr=1e3,qu.ir=new qu(41943040,qu.nr,qu.sr),qu.rr=new qu(-1,0,0);var Fu=function(){function t(t,e){this.cr=t,this.di=e,this.ur=!1,this.ar=null}return t.prototype.start=function(t){-1!==this.cr.params.Xi&&this.hr(t)},t.prototype.stop=function(){this.ar&&(this.ar.cancel(),this.ar=null)},Object.defineProperty(t.prototype,"lr",{get:function(){return null!==this.ar},enumerable:!1,configurable:!0}),t.prototype.hr=function(t){var e=this,n=this.ur?3e5:6e4;xr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ar=this.di.Us("lru_garbage_collection",n,(function(){return Object(_.b)(e,void 0,void 0,(function(){var e;return Object(_.e)(this,(function(n){switch(n.label){case 0:this.ar=null,this.ur=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t._r(this.cr)];case 2:return n.sent(),[3,7];case 3:return Au(e=n.sent())?(xr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,vc(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.hr(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),Bu=function(){function t(t,e){this.dr=t,this.params=e}return t.prototype.wr=function(t,e){return this.dr.Er(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.Tr=function(t,e){var n=this;if(0===e)return lu.resolve(_u.Ds);var r=new Mu(e);return this.dr.Ue(t,(function(t){return r.Gi(t.sequenceNumber)})).next((function(){return n.dr.Ir(t,(function(t){return r.Gi(t)}))})).next((function(){return r.maxValue}))},t.prototype.mr=function(t,e,n){return this.dr.mr(t,e,n)},t.prototype.Ar=function(t,e){return this.dr.Ar(t,e)},t.prototype.Rr=function(t,e){var n=this;return-1===this.params.Xi?(xr("LruGarbageCollector","Garbage collection skipped; disabled"),lu.resolve(Vu)):this.Pr(t).next((function(r){return r<n.params.Xi?(xr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.Xi),Vu):n.gr(t,e)}))},t.prototype.Pr=function(t){return this.dr.Pr(t)},t.prototype.gr=function(t,e){var n,r,i,o,s,u,a,c=this,h=Date.now();return this.wr(t,this.params.Zi).next((function(e){return e>c.params.tr?(xr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.tr+" from "+e),r=c.params.tr):r=e,o=Date.now(),c.Tr(t,r)})).next((function(r){return n=r,s=Date.now(),c.mr(t,n,e)})).next((function(e){return i=e,u=Date.now(),c.Ar(t,n)})).next((function(t){return a=Date.now(),Sr()<=E.a.DEBUG&&xr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(a-u)+"ms\nTotal Duration: "+(a-h)+"ms"),lu.resolve({zi:!0,Hi:r,Ji:i,Yi:t})}))},t}(),zu=function(){function t(){}return t.prototype.yr=function(t){this.Vr=t},t.prototype.ws=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.Tn.length||1===t.Tn.length&&t.Tn[0].field.tt())}(e)||n.isEqual(Yr.min())?this.pr(t,e):this.Vr._s(t,r).next((function(o){var s=i.vr(e,o);return(Cs(e)||Rs(e))&&i.br(e.limitType,s,r,n)?i.pr(t,e):(Sr()<=E.a.DEBUG&&xr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Gs(e)),i.Vr.ws(t,e,n).next((function(t){return s.forEach((function(e){t=t.Tt(e.key,e)})),t})))}))},t.prototype.vr=function(t,e){var n=new _i(Ws(t));return e.forEach((function(e,r){r instanceof Ns&&Ks(t,r)&&(n=n.add(r))})),n},t.prototype.br=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.F(r)>0)},t.prototype.pr=function(t,e){return Sr()<=E.a.DEBUG&&xr("QueryEngine","Using full collection scan to execute query:",Gs(e)),this.Vr.ws(t,e,Yr.min())},t}();function Gu(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Wu(e)),e=Ku(t.get(n),e);return Wu(e)}function Ku(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Wu(t){return t+"\x01\x01"}function Qu(t){var e=t.length;if(Lr(e>=2),2===e)return Lr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Zr.X();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Rr(),t.charAt(s+1)){case"\x01":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Rr()}o=s+2}return new Zr(r)}var Ju=function(t){this.Sr=t};function Xu(t,e){if(e.document)return function(t,e,n){var r=Ao(t,e.name),i=Io(e.updateTime),o=new Os({mapValue:{fields:e.fields}});return new Ns(r,i,o,{hasCommittedMutations:!!n})}(t.Sr,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=ni.ct(e.noDocument.path),r=ta(e.noDocument.readTime);return new Ds(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=ni.ct(e.unknownDocument.path),o=ta(e.unknownDocument.version);return new Ss(i,o)}return Rr()}function $u(t,e,n){var r=Yu(n),i=e.key.path.q().H();if(e instanceof Ns){var o=function(t,e){return{name:To(t,e.key),fields:e.En().mapValue.fields,updateTime:mo(t,e.version.M())}}(t.Sr,e);return new ja(null,null,o,e.hasCommittedMutations,r,i)}if(e instanceof Ds){var s=e.key.path.H(),u=Zu(e.version),a=e.hasCommittedMutations;return new ja(null,new Ta(s,u),null,a,r,i)}if(e instanceof Ss){var c=e.key.path.H(),h=Zu(e.version);return new ja(new Aa(c,h),null,null,!0,r,i)}return Rr()}function Yu(t){var e=t.M();return[e.seconds,e.nanoseconds]}function Hu(t){var e=new $r(t[0],t[1]);return Yr.N(e)}function Zu(t){var e=t.M();return new wa(e.seconds,e.nanoseconds)}function ta(t){var e=new $r(t.seconds,t.nanoseconds);return Yr.N(e)}function ea(t,e){var n=(e.baseMutations||[]).map((function(e){return ko(t.Sr,e)})),r=e.mutations.map((function(e){return ko(t.Sr,e)})),i=$r.fromMillis(e.localWriteTimeMs);return new cu(e.batchId,i,n,r)}function na(t){var e,n,r=ta(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?ta(t.lastLimboFreeSnapshotVersion):Yr.min();return void 0!==t.query.documents?(Lr(1===(n=t.query).documents.length),e=qs(ks(No(n.documents[0])))):e=function(t){return qs(Lo(t))}(t.query),new di(e,t.targetId,0,t.lastListenSequenceNumber,r,i,fi.fromBase64String(t.resumeToken))}function ra(t,e){var n,r=Zu(e.ft),i=Zu(e.lastLimboFreeSnapshotVersion);n=hi(e.target)?Co(t.Sr,e.target):Ro(t.Sr,e.target);var o=e.resumeToken.toBase64();return new Da(e.targetId,ai(e.target),r,o,e.sequenceNumber,i,n)}function ia(t){var e=Lo({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Fs(e,e.limit,"L"):e}var oa=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.os=n,this.Dr=r,this.Cr={}}return t.Nr=function(e,n,r,i){return Lr(""!==e.uid),new t(e.u()?e.uid:"",n,r,i)},t.prototype.Fr=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return aa(t)._i({index:Ea.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.Or=function(t,e,n,r){var i=this,o=ca(t),s=aa(t);return s.add({}).next((function(u){Lr("number"==typeof u);for(var a=new cu(u,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Po(t.Sr,e)})),i=n.mutations.map((function(e){return Po(t.Sr,e)}));return new Ea(e,n.batchId,n.gn.toMillis(),r,i)}(i.serializer,i.userId,a),h=[],f=new _i((function(t,e){return Qr(t.J(),e.J())})),l=0,p=r;l<p.length;l++){var d=p[l],v=Oa.key(i.userId,d.key.path,u);f=f.add(d.key.path.q()),h.push(s.put(c)),h.push(o.put(v,Oa.PLACEHOLDER))}return f.forEach((function(e){h.push(i.os.Mr(t,e))})),t.es((function(){i.Cr[u]=a.keys()})),lu.qn(h).next((function(){return a}))}))},t.prototype.kr=function(t,e){var n=this;return aa(t).get(e).next((function(t){return t?(Lr(t.userId===n.userId),ea(n.serializer,t)):null}))},t.prototype.$r=function(t,e){var n=this;return this.Cr[e]?lu.resolve(this.Cr[e]):this.kr(t,e).next((function(t){if(t){var r=t.keys();return n.Cr[e]=r,r}return null}))},t.prototype.Lr=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return aa(t)._i({index:Ea.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Lr(e.batchId>=r),o=ea(n.serializer,e)),i.done()})).next((function(){return o}))},t.prototype.Br=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return aa(t)._i({index:Ea.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.qr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return aa(t).ui(Ea.userMutationsIndex,n).next((function(t){return t.map((function(t){return ea(e.serializer,t)}))}))},t.prototype.us=function(t,e){var n=this,r=Oa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return ca(t)._i({range:i},(function(r,i,s){var u=r[0],a=r[2],c=Qu(r[1]);if(u===n.userId&&e.path.isEqual(c))return aa(t).get(a).next((function(t){if(!t)throw Rr();Lr(t.userId===n.userId),o.push(ea(n.serializer,t))}));s.done()})).next((function(){return o}))},t.prototype.ds=function(t,e){var n=this,r=new _i(Qr),i=[];return e.forEach((function(e){var o=Oa.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=ca(t)._i({range:s},(function(t,i,o){var s=t[0],u=t[2],a=Qu(t[1]);s===n.userId&&e.path.isEqual(a)?r=r.add(u):o.done()}));i.push(u)})),lu.qn(i).next((function(){return n.Ur(t,r)}))},t.prototype.Rs=function(t,e){var n=this,r=e.path,i=r.length+1,o=Oa.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new _i(Qr);return ca(t)._i({range:s},(function(t,e,o){var s=t[0],a=t[2],c=Qu(t[1]);s===n.userId&&r.j(c)?c.length===i&&(u=u.add(a)):o.done()})).next((function(){return n.Ur(t,u)}))},t.prototype.Ur=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(aa(t).get(e).next((function(t){if(null===t)throw Rr();Lr(t.userId===n.userId),r.push(ea(n.serializer,t))})))})),lu.qn(i).next((function(){return r}))},t.prototype.Qr=function(t,e){var n=this;return ua(t.Kr,this.userId,e).next((function(r){return t.es((function(){n.Wr(e.batchId)})),lu.forEach(r,(function(e){return n.Dr.jr(t,e)}))}))},t.prototype.Wr=function(t){delete this.Cr[t]},t.prototype.Gr=function(t){var e=this;return this.Fr(t).next((function(n){if(!n)return lu.resolve();var r=IDBKeyRange.lowerBound(Oa.prefixForUser(e.userId)),i=[];return ca(t)._i({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Qu(t[1]);i.push(o)}else r.done()})).next((function(){Lr(0===i.length)}))}))},t.prototype.zr=function(t,e){return sa(t,this.userId,e)},t.prototype.Hr=function(t){var e=this;return ha(t).get(this.userId).next((function(t){return t||new Ia(e.userId,-1,"")}))},t}();function sa(t,e,n){var r=Oa.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return ca(t)._i({range:o,li:!0},(function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()})).next((function(){return s}))}function ua(t,e,n){var r=t.store(Ea.store),i=t.store(Oa.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r._i({range:s},(function(t,e,n){return u++,n.delete()}));o.push(a.next((function(){Lr(1===u)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Oa.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return lu.qn(o).next((function(){return c}))}function aa(t){return $a.Ys(t,Ea.store)}function ca(t){return $a.Ys(t,Oa.store)}function ha(t){return $a.Ys(t,Ia.store)}var fa=function(){function t(t,e){this.serializer=t,this.os=e}return t.prototype.jn=function(t,e,n){return da(t).put(va(e),n)},t.prototype.Hn=function(t,e){var n=da(t),r=va(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Jr(t,r)}))},t.prototype.Jn=function(t,e){var n=this;return da(t).get(va(e)).next((function(t){return n.Yr(t)}))},t.prototype.Xr=function(t,e){var n=this;return da(t).get(va(e)).next((function(t){var e=n.Yr(t);return e?{zn:e,size:ya(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=Ti();return this.Zr(t,e,(function(t,e){var i=n.Yr(e);r=r.Tt(t,i)})).next((function(){return r}))},t.prototype.eo=function(t,e){var n=this,r=Ti(),i=new bi(ni.$);return this.Zr(t,e,(function(t,e){var o=n.Yr(e);o?(r=r.Tt(t,o),i=i.Tt(t,ya(e))):(r=r.Tt(t,null),i=i.Tt(t,0))})).next((function(){return{no:r,so:i}}))},t.prototype.Zr=function(t,e,n){if(e.W())return lu.resolve();var r=IDBKeyRange.bound(e.first().path.H(),e.last().path.H()),i=e.yt(),o=i.Ct();return da(t)._i({range:r},(function(t,e,r){for(var s=ni.ct(t);o&&ni.$(o,s)<0;)n(o,null),o=i.Ct();o&&o.isEqual(s)&&(n(o,e),o=i.Nt()?i.Ct():null),o?r.oi(o.path.H()):r.done()})).next((function(){for(;o;)n(o,null),o=i.Nt()?i.Ct():null}))},t.prototype.ws=function(t,e,n){var r=this,i=ji(),o=e.path.length+1,s={};if(n.isEqual(Yr.min())){var u=e.path.H();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.H(),c=Yu(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=ja.collectionReadTimeIndex}return da(t)._i(s,(function(t,n,s){if(t.length===o){var u=Xu(r.serializer,n);e.path.j(u.key.path)?u instanceof Ns&&Ks(e,u)&&(i=i.Tt(u.key,u)):s.done()}})).next((function(){return i}))},t.prototype.io=function(t){return new la(this,!!t&&t.ro)},t.prototype.oo=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return pa(t).get(Na.key).next((function(t){return Lr(!!t),t}))},t.prototype.Jr=function(t,e){return pa(t).put(Na.key,e)},t.prototype.Yr=function(t){if(t){var e=Xu(this.serializer,t);return e instanceof Ds&&e.version.isEqual(Yr.min())?null:e}return null},t}(),la=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).co=e,r.ro=n,r.uo=new fu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Object(_.d)(e,t),e.prototype.Zn=function(t){var e=this,n=[],r=0,i=new _i((function(t,e){return Qr(t.J(),e.J())}));return this.Qn.forEach((function(o,s){var u=e.uo.get(o);if(s.zn){var a=$u(e.co.serializer,s.zn,e.Wn(o));i=i.add(o.path.q());var c=ya(a);r+=c-u,n.push(e.co.jn(t,o,a))}else if(r-=u,e.ro){var h=$u(e.co.serializer,new Ds(o,Yr.min()),e.Wn(o));n.push(e.co.jn(t,o,h))}else n.push(e.co.Hn(t,o))})),i.forEach((function(r){n.push(e.co.os.Mr(t,r))})),n.push(this.co.updateMetadata(t,r)),lu.qn(n)},e.prototype.Yn=function(t,e){var n=this;return this.co.Xr(t,e).next((function(t){return null===t?(n.uo.set(e,0),null):(n.uo.set(e,t.size),t.zn)}))},e.prototype.Xn=function(t,e){var n=this;return this.co.eo(t,e).next((function(t){var e=t.no;return t.so.forEach((function(t,e){n.uo.set(t,e)})),e}))},e}(pu);function pa(t){return $a.Ys(t,Na.store)}function da(t){return $a.Ys(t,ja.store)}function va(t){return t.path.H()}function ya(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Rr();e=t.noDocument}return JSON.stringify(e).length}var ga=function(){function t(){this.ao=new ba}return t.prototype.Mr=function(t,e){return this.ao.add(e),lu.resolve()},t.prototype.As=function(t,e){return lu.resolve(this.ao.getEntries(e))},t}(),ba=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.K(),n=t.q(),r=this.index[e]||new _i(Zr.$),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.K(),n=t.q(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new _i(Zr.$)).H()},t}(),ma=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Lr(n<r&&n>=0&&r<=11);var o=new ju("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(_a.store)}(t),function(t){t.createObjectStore(Ia.store,{keyPath:Ia.keyPath}),t.createObjectStore(Ea.store,{keyPath:Ea.keyPath,autoIncrement:!0}).createIndex(Ea.userMutationsIndex,Ea.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Oa.store)}(t),ka(t),function(t){t.createObjectStore(ja.store)}(t));var s=lu.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Sa.store),t.deleteObjectStore(Da.store),t.deleteObjectStore(xa.store)}(t),ka(t)),s=s.next((function(){return function(t){var e=t.store(xa.store),n=new xa(0,0,Yr.min().M(),0);return e.put(xa.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Ea.store).ui().next((function(n){t.deleteObjectStore(Ea.store),t.createObjectStore(Ea.store,{keyPath:Ea.keyPath,autoIncrement:!0}).createIndex(Ea.userMutationsIndex,Ea.userMutationsKeyPath,{unique:!0});var r=e.store(Ea.store),i=n.map((function(t){return r.put(t)}));return lu.qn(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(Ca.store,{keyPath:Ca.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Na.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(ja.store);e.createIndex(ja.readTimeIndex,ja.readTimeIndexPath,{unique:!1}),e.createIndex(ja.collectionReadTimeIndex,ja.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.rewriteCanonicalIds(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(Ra.store,{keyPath:Ra.keyPath})}(t),function(t){t.createObjectStore(La.store,{keyPath:La.keyPath})}(t)}))),s},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(ja.store)._i((function(t,n){e+=ya(n)})).next((function(){var n=new Na(e);return t.store(Na.store).put(Na.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Ia.store),r=t.store(Ea.store);return n.ui().next((function(n){return lu.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.ui(Ea.userMutationsIndex,i).next((function(r){return lu.forEach(r,(function(r){Lr(r.userId===n.userId);var i=ea(e.serializer,r);return ua(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Sa.store),n=t.store(ja.store);return t.store(xa.store).get(xa.key).next((function(t){var r=[];return n._i((function(n,i){var o=new Zr(n),s=function(t){return[0,Gu(t)]}(o);r.push(e.get(s).next((function(n){return n?lu.resolve():function(n){return e.put(new Sa(0,Gu(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return lu.qn(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Pa.store,{keyPath:Pa.keyPath});var n=e.store(Pa.store),r=new ba,i=function(t){if(r.add(t)){var e=t.K(),i=t.q();return n.put({collectionId:e,parent:Gu(i)})}};return e.store(ja.store)._i({li:!0},(function(t,e){var n=new Zr(t);return i(n.q())})).next((function(){return e.store(Oa.store)._i({li:!0},(function(t,e){var n=Qu(t[1]);return i(n.q())}))}))},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(Da.store);return n._i((function(t,r){var i=na(r),o=ra(e.serializer,i);return n.put(o)}))},t}(),wa=function(t,e){this.seconds=t,this.nanoseconds=e},_a=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};_a.store="owner",_a.key="owner";var Ia=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ia.store="mutationQueues",Ia.keyPath="userId";var Ea=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ea.store="mutations",Ea.keyPath="batchId",Ea.userMutationsIndex="userMutationsIndex",Ea.userMutationsKeyPath=["userId","batchId"];var Oa=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Gu(e)]},t.key=function(t,e,n){return[t,Gu(e),n]},t}();Oa.store="documentMutations",Oa.PLACEHOLDER=new Oa;var Ta=function(t,e){this.path=t,this.readTime=e},Aa=function(t,e){this.path=t,this.version=e},ja=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};ja.store="remoteDocuments",ja.readTimeIndex="readTimeIndex",ja.readTimeIndexPath="readTime",ja.collectionReadTimeIndex="collectionReadTimeIndex",ja.collectionReadTimeIndexPath=["parentPath","readTime"];var Na=function(t){this.byteSize=t};Na.store="remoteDocumentGlobal",Na.key="remoteDocumentGlobalKey";var Da=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Da.store="targets",Da.keyPath="targetId",Da.queryTargetsIndexName="queryTargetsIndex",Da.queryTargetsKeyPath=["canonicalId","targetId"];var Sa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Sa.store="targetDocuments",Sa.keyPath=["targetId","path"],Sa.documentTargetsIndex="documentTargetsIndex",Sa.documentTargetsKeyPath=["path","targetId"];var xa=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};xa.key="targetGlobalKey",xa.store="targetGlobal";var Pa=function(t,e){this.collectionId=t,this.parent=e};function ka(t){t.createObjectStore(Sa.store,{keyPath:Sa.keyPath}).createIndex(Sa.documentTargetsIndex,Sa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Da.store,{keyPath:Da.keyPath}).createIndex(Da.queryTargetsIndexName,Da.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(xa.store)}Pa.store="collectionParents",Pa.keyPath=["collectionId","parent"];var Ca=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ca.store="clientMetadata",Ca.keyPath="clientId";var Ra=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Ra.store="bundles",Ra.keyPath="bundleId";var La=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};La.store="namedQueries",La.keyPath="name";var Ua=Object(_.h)(Object(_.h)(Object(_.h)(Object(_.h)([Ia.store,Ea.store,Oa.store,ja.store,Da.store,_a.store,xa.store,Sa.store],[Ca.store]),[Na.store]),[Pa.store]),[Ra.store,La.store]),Ma=function(){function t(t){this.serializer=t}return t.prototype.ho=function(t,e){return Va(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:ta(e.createTime),version:e.version};var e}))},t.prototype.lo=function(t,e){return Va(t).put({bundleId:(n=e).id,createTime:Zu(Io(n.createTime)),version:n.version});var n},t.prototype._o=function(t,e){return qa(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:ia(e.bundledQuery),readTime:ta(e.readTime)};var e}))},t.prototype.fo=function(t,e){return qa(t).put(function(t){return{name:t.name,readTime:Zu(Io(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Va(t){return $a.Ys(t,Ra.store)}function qa(t){return $a.Ys(t,La.store)}var Fa=function(){function t(){this.wo=new ba}return t.prototype.Mr=function(t,e){var n=this;if(!this.wo.has(e)){var r=e.K(),i=e.q();t.es((function(){n.wo.add(e)}));var o={collectionId:r,parent:Gu(i)};return Ba(t).put(o)}return lu.resolve()},t.prototype.As=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Xr(e),""],!1,!0);return Ba(t).ui(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Qu(o.parent))}return n}))},t}();function Ba(t){return $a.Ys(t,Pa.store)}var za=function(){function t(t){this.Eo=t}return t.prototype.next=function(){return this.Eo+=2,this.Eo},t.To=function(){return new t(0)},t.Io=function(){return new t(-1)},t}(),Ga=function(){function t(t,e){this.Dr=t,this.serializer=e}return t.prototype.mo=function(t){var e=this;return this.Ao(t).next((function(n){var r=new za(n.highestTargetId);return n.highestTargetId=r.next(),e.Ro(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.Po=function(t){return this.Ao(t).next((function(t){return Yr.N(new $r(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.yo=function(t){return this.Ao(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.Vo=function(t,e,n){var r=this;return this.Ao(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.M()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Ro(t,i)}))},t.prototype.po=function(t,e){var n=this;return this.vo(t,e).next((function(){return n.Ao(t).next((function(r){return r.targetCount+=1,n.bo(e,r),n.Ro(t,r)}))}))},t.prototype.So=function(t,e){return this.vo(t,e)},t.prototype.Do=function(t,e){var n=this;return this.Co(t,e.targetId).next((function(){return Ka(t).delete(e.targetId)})).next((function(){return n.Ao(t)})).next((function(e){return Lr(e.targetCount>0),e.targetCount-=1,n.Ro(t,e)}))},t.prototype.mr=function(t,e,n){var r=this,i=0,o=[];return Ka(t)._i((function(s,u){var a=na(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.Do(t,a)))})).next((function(){return lu.qn(o)})).next((function(){return i}))},t.prototype.Ue=function(t,e){return Ka(t)._i((function(t,n){var r=na(n);e(r)}))},t.prototype.Ao=function(t){return Wa(t).get(xa.key).next((function(t){return Lr(null!==t),t}))},t.prototype.Ro=function(t,e){return Wa(t).put(xa.key,e)},t.prototype.vo=function(t,e){return Ka(t).put(ra(this.serializer,e))},t.prototype.bo=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.No=function(t){return this.Ao(t).next((function(t){return t.targetCount}))},t.prototype.xo=function(t,e){var n=ai(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Ka(t)._i({range:r,index:Da.queryTargetsIndexName},(function(t,n,r){var o=na(n);ci(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.Fo=function(t,e,n){var r=this,i=[],o=Qa(t);return e.forEach((function(e){var s=Gu(e.path);i.push(o.put(new Sa(n,s))),i.push(r.Dr.Oo(t,n,e))})),lu.qn(i)},t.prototype.Mo=function(t,e,n){var r=this,i=Qa(t);return lu.forEach(e,(function(e){var o=Gu(e.path);return lu.qn([i.delete([n,o]),r.Dr.ko(t,n,e)])}))},t.prototype.Co=function(t,e){var n=Qa(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.$o=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Qa(t),i=Si();return r._i({range:n,li:!0},(function(t,e,n){var r=Qu(t[1]),o=new ni(r);i=i.add(o)})).next((function(){return i}))},t.prototype.zr=function(t,e){var n=Gu(e.path),r=IDBKeyRange.bound([n],[Xr(n)],!1,!0),i=0;return Qa(t)._i({index:Sa.documentTargetsIndex,li:!0,range:r},(function(t,e,n){0!==t[0]&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.Ze=function(t,e){return Ka(t).get(e).next((function(t){return t?na(t):null}))},t}();function Ka(t){return $a.Ys(t,Da.store)}function Wa(t){return $a.Ys(t,xa.store)}function Qa(t){return $a.Ys(t,Sa.store)}var Ja="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Xa=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Kr=e,r.Lo=n,r}return Object(_.d)(e,t),e}(bu),$a=function(){function t(e,n,r,i,o,s,u,a,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Cs=o,this.window=s,this.document=u,this.Bo=c,this.qo=h,this.Uo=null,this.Qo=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ko=null,this.inForeground=!1,this.Wo=null,this.jo=null,this.Go=Number.NEGATIVE_INFINITY,this.zo=function(t){return Promise.resolve()},!t.Gs())throw new Vr(Mr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Dr=new Za(this,i),this.Ho=n+"main",this.serializer=new Ju(a),this.Jo=new Eu(this.Ho,11,new ma(this.serializer)),this.Yo=new Ga(this.Dr,this.serializer),this.os=new Fa,this.ss=function(t,e){return new fa(t,e)}(this.serializer,this.os),this.Xo=new Ma(this.serializer),this.window&&this.window.localStorage?this.Zo=this.window.localStorage:(this.Zo=null,!1===h&&Pr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.Ys=function(t,e){if(t instanceof Xa)return Eu.Ys(t.Kr,e);throw Rr()},t.prototype.start=function(){var t=this;return this.tc().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Vr(Mr.FAILED_PRECONDITION,Ja);return t.ec(),t.nc(),t.sc(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.Yo.yo(e)}))})).then((function(e){t.Uo=new _u(e,t.Bo)})).then((function(){t.Qo=!0})).catch((function(e){return t.Jo&&t.Jo.close(),Promise.reject(e)}))},t.prototype.ic=function(t){var e=this;return this.zo=function(n){return Object(_.b)(e,void 0,void 0,(function(){return Object(_.e)(this,(function(e){return this.lr?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.rc=function(t){var e=this;this.Jo.ti((function(n){return Object(_.b)(e,void 0,void 0,(function(){return Object(_.e)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.oc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Cs.Ri((function(){return Object(_.b)(e,void 0,void 0,(function(){return Object(_.e)(this,(function(t){switch(t.label){case 0:return this.lr?[4,this.tc()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.tc=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Ha(e).put(new Ca(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.cc(e).next((function(e){e||(t.isPrimary=!1,t.Cs.Mi((function(){return t.zo(!1)})))}))})).next((function(){return t.uc(e)})).next((function(n){return t.isPrimary&&!n?t.ac(e).next((function(){return!1})):!!n&&t.hc(e).next((function(){return!0}))}))})).catch((function(e){if(Au(e))return xr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return xr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Cs.Mi((function(){return t.zo(e)})),t.isPrimary=e}))},t.prototype.cc=function(t){var e=this;return Ya(t).get(_a.key).next((function(t){return lu.resolve(e.lc(t))}))},t.prototype._c=function(t){return Ha(t).delete(this.clientId)},t.prototype.fc=function(){return Object(_.b)(this,void 0,void 0,(function(){var e,n,r,i=this;return Object(_.e)(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.dc(this.Go,18e5)?[3,2]:(this.Go=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var n=t.Ys(e,Ca.store);return n.ui().next((function(t){var e=i.wc(t,18e5),r=t.filter((function(t){return-1===e.indexOf(t)}));return lu.forEach(r,(function(t){return n.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(e=o.sent(),this.Zo)for(n=0,r=e;n<r.length;n++)this.Zo.removeItem(this.Ec(r[n].clientId));o.label=2;case 2:return[2]}}))}))},t.prototype.sc=function(){var t=this;this.jo=this.Cs.Us("client_metadata_refresh",4e3,(function(){return t.tc().then((function(){return t.fc()})).then((function(){return t.sc()}))}))},t.prototype.lc=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.uc=function(t){var e=this;return this.qo?lu.resolve(!0):Ya(t).get(_a.key).next((function(n){if(null!==n&&e.dc(n.leaseTimestampMs,5e3)&&!e.Tc(n.ownerId)){if(e.lc(n)&&e.networkEnabled)return!0;if(!e.lc(n)){if(!n.allowTabSynchronization)throw new Vr(Mr.FAILED_PRECONDITION,Ja);return!1}}return!(!e.networkEnabled||!e.inForeground)||Ha(t).ui().next((function(t){return void 0===e.wc(t,5e3).find((function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))}))}))})).next((function(t){return e.isPrimary!==t&&xr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.Ic=function(){return Object(_.b)(this,void 0,void 0,(function(){var t=this;return Object(_.e)(this,(function(e){switch(e.label){case 0:return this.Qo=!1,this.mc(),this.jo&&(this.jo.cancel(),this.jo=null),this.Ac(),this.Rc(),[4,this.Jo.runTransaction("shutdown","readwrite",[_a.store,Ca.store],(function(e){var n=new Xa(e,_u.Ds);return t.ac(n).next((function(){return t._c(n)}))}))];case 1:return e.sent(),this.Jo.close(),this.Pc(),[2]}}))}))},t.prototype.wc=function(t,e){var n=this;return t.filter((function(t){return n.dc(t.updateTimeMs,e)&&!n.Tc(t.clientId)}))},t.prototype.gc=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Ha(e).ui().next((function(e){return t.wc(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"lr",{get:function(){return this.Qo},enumerable:!1,configurable:!0}),t.prototype.yc=function(t){return oa.Nr(t,this.serializer,this.os,this.Dr)},t.prototype.Vc=function(){return this.Yo},t.prototype.vc=function(){return this.ss},t.prototype.bc=function(){return this.os},t.prototype.Sc=function(){return this.Xo},t.prototype.runTransaction=function(t,e,n){var r,i=this;return xr("IndexedDbPersistence","Starting transaction:",t),this.Jo.runTransaction(t,"readonly"===e?"readonly":"readwrite",Ua,(function(o){return r=new Xa(o,i.Uo?i.Uo.next():_u.Ds),"readwrite-primary"===e?i.cc(r).next((function(t){return!!t||i.uc(r)})).next((function(e){if(!e)throw Pr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Cs.Mi((function(){return i.zo(!1)})),new Vr(Mr.FAILED_PRECONDITION,gu);return n(r)})).next((function(t){return i.hc(r).next((function(){return t}))})):i.Dc(r).next((function(){return n(r)}))})).then((function(t){return r.ns(),t}))},t.prototype.Dc=function(t){var e=this;return Ya(t).get(_a.key).next((function(t){if(null!==t&&e.dc(t.leaseTimestampMs,5e3)&&!e.Tc(t.ownerId)&&!e.lc(t)&&!(e.qo||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Vr(Mr.FAILED_PRECONDITION,Ja)}))},t.prototype.hc=function(t){var e=new _a(this.clientId,this.allowTabSynchronization,Date.now());return Ya(t).put(_a.key,e)},t.Gs=function(){return Eu.Gs()},t.prototype.ac=function(t){var e=this,n=Ya(t);return n.get(_a.key).next((function(t){return e.lc(t)?(xr("IndexedDbPersistence","Releasing primary lease."),n.delete(_a.key)):lu.resolve()}))},t.prototype.dc=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Pr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.ec=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Wo=function(){t.Cs.Ri((function(){return t.inForeground="visible"===t.document.visibilityState,t.tc()}))},this.document.addEventListener("visibilitychange",this.Wo),this.inForeground="visible"===this.document.visibilityState)},t.prototype.Ac=function(){this.Wo&&(this.document.removeEventListener("visibilitychange",this.Wo),this.Wo=null)},t.prototype.nc=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Ko=function(){e.mc(),e.Cs.Ri((function(){return e.Ic()}))},this.window.addEventListener("unload",this.Ko))},t.prototype.Rc=function(){this.Ko&&(this.window.removeEventListener("unload",this.Ko),this.Ko=null)},t.prototype.Tc=function(t){var e;try{var n=null!==(null===(e=this.Zo)||void 0===e?void 0:e.getItem(this.Ec(t)));return xr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Pr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.mc=function(){if(this.Zo)try{this.Zo.setItem(this.Ec(this.clientId),String(Date.now()))}catch(t){Pr("Failed to set zombie client id.",t)}},t.prototype.Pc=function(){if(this.Zo)try{this.Zo.removeItem(this.Ec(this.clientId))}catch(t){}},t.prototype.Ec=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Ya(t){return $a.Ys(t,_a.store)}function Ha(t){return $a.Ys(t,Ca.store)}var Za=function(){function t(t,e){this.db=t,this.cr=new Bu(this,e)}return t.prototype.Er=function(t){var e=this.Cc(t);return this.db.Vc().No(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.Cc=function(t){var e=0;return this.Ir(t,(function(t){e++})).next((function(){return e}))},t.prototype.Ue=function(t,e){return this.db.Vc().Ue(t,e)},t.prototype.Ir=function(t,e){return this.Nc(t,(function(t,n){return e(n)}))},t.prototype.Oo=function(t,e,n){return tc(t,n)},t.prototype.ko=function(t,e,n){return tc(t,n)},t.prototype.mr=function(t,e,n){return this.db.Vc().mr(t,e,n)},t.prototype.jr=function(t,e){return tc(t,e)},t.prototype.xc=function(t,e){return function(t,e){var n=!1;return ha(t).fi((function(r){return sa(t,r,e).next((function(t){return t&&(n=!0),lu.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.Ar=function(t,e){var n=this,r=this.db.vc().io(),i=[],o=0;return this.Nc(t,(function(s,u){if(u<=e){var a=n.xc(t,s).next((function(e){if(!e)return o++,r.Jn(t,s).next((function(){return r.Hn(s),Qa(t).delete([0,Gu(s.path)])}))}));i.push(a)}})).next((function(){return lu.qn(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.dt(t.Lo);return this.db.Vc().So(t,n)},t.prototype.Fc=function(t,e){return tc(t,e)},t.prototype.Nc=function(t,e){var n,r=Qa(t),i=_u.Ds;return r._i({index:Sa.documentTargetsIndex},(function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==_u.Ds&&e(new ni(Qu(n)),i),i=s,n=o):i=_u.Ds})).next((function(){i!==_u.Ds&&e(new ni(Qu(n)),i)}))},t.prototype.Pr=function(t){return this.db.vc().oo(t)},t}();function tc(t,e){return Qa(t).put(function(t,e){return new Sa(0,Gu(t.path),e)}(e,t.Lo))}function ec(t,e){var n=t.projectId;return t.o||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var nc=function(){function t(t,e,n,r){this.persistence=t,this.Oc=e,this.serializer=r,this.Mc=new bi(Qr),this.kc=new fu((function(t){return ai(t)}),ci),this.$c=Yr.min(),this.rs=t.yc(n),this.Lc=t.vc(),this.Yo=t.Vc(),this.Bc=new mu(this.Lc,this.rs,this.persistence.bc()),this.Xo=t.Sc(),this.Oc.yr(this.Bc)}return t.prototype._r=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.Rr(n,e.Mc)}))},t}();function rc(t,e,n,r){return new nc(t,e,n,r)}function ic(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(_.e)(this,(function(s){switch(s.label){case 0:return n=Ur(t),r=n.rs,i=n.Bc,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n.rs.qr(t).next((function(s){return o=s,r=n.persistence.yc(e),i=new mu(n.Lc,r,n.persistence.bc()),r.qr(t)})).next((function(e){for(var n=[],r=[],s=Si(),u=0,a=o;u<a.length;u++){var c=a[u];n.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++)s=s.add(f[h].key)}for(var l=0,p=e;l<p.length;l++){var d=p[l];r.push(d.batchId);for(var v=0,y=d.mutations;v<y.length;v++)s=s.add(y[v].key)}return i._s(t,s).next((function(t){return{qc:t,Uc:n,Qc:r}}))}))}))];case 1:return o=s.sent(),[2,(n.rs=r,n.Bc=i,n.Oc.yr(n.Bc),o)]}}))}))}function oc(t,e){var n=Ur(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.Lc.io({ro:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=lu.resolve();return o.forEach((function(t){s=s.next((function(){return r.Jn(e,t)})).next((function(e){var o=e,s=n.Sn.get(t);Lr(null!==s),(!o||o.version.F(s)<0)&&(o=i.yn(t,o,n))&&r.jn(o,n.bn)}))})),s.next((function(){return t.rs.Qr(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n.rs.Gr(t)})).next((function(){return n.Bc._s(t,r)}))}))}function sc(t){var e=Ur(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.Yo.Po(t)}))}function uc(t,e){var n=Ur(t),r=e.ft,i=n.Mc;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Lc.io({ro:!0});i=n.Mc;var s=[];e.re.forEach((function(e,o){var u=i.get(o);if(u){s.push(n.Yo.Mo(t,e.de,o).next((function(){return n.Yo.Fo(t,e._e,o)})));var a=e.resumeToken;if(a.ht()>0){var c=u.wt(a,r).dt(t.Lo);i=i.Tt(o,c),function(t,e,n){return Lr(e.resumeToken.ht()>0),0===t.resumeToken.ht()||e.ft.O()-t.ft.O()>=3e8||n._e.size+n.fe.size+n.de.size>0}(u,c,e)&&s.push(n.Yo.So(t,c))}}}));var u=Oi();if(e.ce.forEach((function(r,i){e.ue.has(r)&&s.push(n.persistence.Dr.Fc(t,r))})),s.push(function(t,e,n,r,i){var o=Si();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var i=Oi();return n.forEach((function(n,o){var s=t.get(n),u=r;o instanceof Ds&&o.version.isEqual(Yr.min())?(e.Hn(n,u),i=i.Tt(n,o)):null==s||o.version.F(s.version)>0||0===o.version.F(s.version)&&s.hasPendingWrites?(e.jn(o,u),i=i.Tt(n,o)):xr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",o.version)})),i}))}(t,o,e.ce,r).next((function(t){u=t}))),!r.isEqual(Yr.min())){var a=n.Yo.Po(t).next((function(e){return n.Yo.Vo(t,t.Lo,r)}));s.push(a)}return lu.qn(s).next((function(){return o.apply(t)})).next((function(){return n.Bc.fs(t,u)}))})).then((function(t){return n.Mc=i,t}))}function ac(t,e){var n=Ur(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n.rs.Lr(t,e)}))}function cc(t,e){var n=Ur(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.Yo.xo(t,e).next((function(i){return i?lu.resolve(r=i):n.Yo.mo(t).next((function(i){return r=new di(e,i,0,t.Lo),n.Yo.po(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Mc.get(t.targetId);return(null===r||t.ft.F(r.ft)>0)&&(n.Mc=n.Mc.Tt(t.targetId,t),n.kc.set(e,t.targetId)),t}))}function hc(t,e,n){return Object(_.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(_.e)(this,(function(u){switch(u.label){case 0:r=Ur(t),i=r.Mc.get(e),o=n?"readwrite":"readwrite-primary",u.label=1;case 1:return u.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.Dr.removeTarget(t,i)}))];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:if(!Au(s=u.sent()))throw s;return xr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Mc=r.Mc.remove(e),r.kc.delete(i.target),[2]}}))}))}function fc(t,e,n){var r=Ur(t),i=Yr.min(),o=Si();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=Ur(t),i=r.kc.get(n);return void 0!==i?lu.resolve(r.Mc.get(i)):r.Yo.xo(e,n)}(r,t,qs(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.Yo.$o(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.Oc.ws(t,e,n?i:Yr.min(),n?o:Si())})).next((function(t){return{documents:t,Kc:o}}))}))}function lc(t,e){var n=Ur(t),r=Ur(n.Yo),i=n.Mc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.Ze(t,e).next((function(t){return t?t.target:null}))}))}function pc(t){var e=Ur(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=Ur(t),i=Oi(),o=Yu(n),s=da(e),u=IDBKeyRange.lowerBound(o,!0);return s._i({index:ja.readTimeIndex,range:u},(function(t,e){var n=Xu(r.serializer,e);i=i.Tt(n.key,n),o=e.readTime})).next((function(){return{Wc:i,readTime:Hu(o)}}))}(e.Lc,t,e.$c)})).then((function(t){var n=t.Wc;return e.$c=t.readTime,n}))}function dc(t){return Object(_.b)(this,void 0,void 0,(function(){var e;return Object(_.e)(this,(function(n){return[2,(e=Ur(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=da(t),n=Yr.min();return e._i({index:ja.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Hu(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.$c=t}))]}))}))}function vc(t){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(e){if(t.code!==Mr.FAILED_PRECONDITION||t.message!==gu)throw t;return xr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}var yc=function(){function t(t,e,n,r,i,o){this.Cs=t,this.jc=n,this.Gc=r,this.zc=i,this.listener=o,this.state=0,this.Hc=0,this.Jc=null,this.stream=null,this.Si=new Iu(t,e)}return t.prototype.Yc=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.Xc=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.Zc()},t.prototype.stop=function(){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(t){switch(t.label){case 0:return this.Yc()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.tu=function(){this.state=0,this.Si.reset()},t.prototype.eu=function(){var t=this;this.Xc()&&null===this.Jc&&(this.Jc=this.Cs.Us(this.jc,6e4,(function(){return t.nu()})))},t.prototype.su=function(t){this.iu(),this.stream.send(t)},t.prototype.nu=function(){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(t){return this.Xc()?[2,this.close(0)]:[2]}))}))},t.prototype.iu=function(){this.Jc&&(this.Jc.cancel(),this.Jc=null)},t.prototype.close=function(t,e){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(n){switch(n.label){case 0:return this.iu(),this.Si.cancel(),this.Hc++,3!==t?this.Si.reset():e&&e.code===Mr.RESOURCE_EXHAUSTED?(Pr(e.toString()),Pr("Using maximum backoff delay to prevent overloading the backend."),this.Si.Ls()):e&&e.code===Mr.UNAUTHENTICATED&&this.zc.m(),null!==this.stream&&(this.ru(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.ou(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ru=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.cu(this.Hc),n=this.Hc;this.zc.getToken().then((function(e){t.Hc===n&&t.uu(e)}),(function(n){e((function(){var e=new Vr(Mr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.au(e)}))}))},t.prototype.uu=function(t){var e=this,n=this.cu(this.Hc);this.stream=this.hu(t),this.stream.lu((function(){n((function(){return e.state=2,e.listener.lu()}))})),this.stream.ou((function(t){n((function(){return e.au(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.Zc=function(){var t=this;this.state=4,this.Si.Bs((function(){return Object(_.b)(t,void 0,void 0,(function(){return Object(_.e)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.au=function(t){return xr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.cu=function(t){var e=this;return function(n){e.Cs.Ri((function(){return e.Hc===t?n():(xr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),gc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).serializer=i,s}return Object(_.d)(e,t),e.prototype.hu=function(t){return this.Gc._u("Listen",t)},e.prototype.onMessage=function(t){this.Si.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Rr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.tn?(Lr(void 0===e||"string"==typeof e),fi.fromBase64String(e||"")):(Lr(void 0===e||e instanceof Uint8Array),fi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,u=s&&function(t){var e=void 0===t.code?Mr.UNKNOWN:gi(t.code);return new Vr(e,t.message||"")}(s);n=new qi(r,i,o,u||null)}else if("documentChange"in e){var a=e.documentChange,c=Ao(t,a.document.name),h=Io(a.document.updateTime),f=new Os({mapValue:{fields:a.document.fields}}),l=new Ns(c,h,f,{});n=new Mi(a.targetIds||[],a.removedTargetIds||[],l.key,l)}else if("documentDelete"in e){var p=e.documentDelete,d=Ao(t,p.document),v=p.readTime?Io(p.readTime):Yr.min(),y=new Ds(d,v);n=new Mi([],p.removedTargetIds||[],y.key,y)}else if("documentRemove"in e){var g=e.documentRemove,b=Ao(t,g.document);n=new Mi([],g.removedTargetIds||[],b,null)}else{if(!("filter"in e))return Rr();var m=e.filter,w=new vi(m.count||0);n=new Vi(m.targetId,w)}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Yr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Yr.min():e.readTime?Io(e.readTime):Yr.min()}(t);return this.listener.fu(e,n)},e.prototype.du=function(t){var e={};e.database=Do(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=hi(r)?{documents:Co(t,r)}:{query:Ro(t,r)}).targetId=e.targetId,e.resumeToken.ht()>0?n.resumeToken=wo(t,e.resumeToken):e.ft.F(Yr.min())>0&&(n.readTime=mo(t,e.ft.M())),n}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Rr()}}(0,e._t);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.su(e)},e.prototype.wu=function(t){var e={};e.database=Do(this.serializer),e.removeTarget=t,this.su(e)},e}(yc),bc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).serializer=i,s.Eu=!1,s}return Object(_.d)(e,t),Object.defineProperty(e.prototype,"Tu",{get:function(){return this.Eu},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.Eu=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ru=function(){this.Eu&&this.Iu([])},e.prototype.hu=function(t){return this.Gc._u("Write",t)},e.prototype.onMessage=function(t){if(Lr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Eu){this.Si.reset();var e=function(t,e){return t&&t.length>0?(Lr(void 0!==e),t.map((function(t){return function(t,e){var n=Io(t.updateTime?t.updateTime:e);n.isEqual(Yr.min())&&(n=Io(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new us(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=Io(t.commitTime);return this.listener.mu(n,e)}return Lr(!t.writeResults||0===t.writeResults.length),this.Eu=!0,this.listener.Au()},e.prototype.Ru=function(){var t={};t.database=Do(this.serializer),this.su(t)},e.prototype.Iu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Po(e.serializer,t)}))};this.su(n)},e}(yc),mc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Gc=n,i.serializer=r,i.Pu=!1,i}return Object(_.d)(e,t),e.prototype.gu=function(){if(this.Pu)throw new Vr(Mr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.yu=function(t,e,n){var r=this;return this.gu(),this.credentials.getToken().then((function(i){return r.Gc.yu(t,e,n,i)})).catch((function(t){throw t.code===Mr.UNAUTHENTICATED&&r.credentials.m(),t}))},e.prototype.Vu=function(t,e,n){var r=this;return this.gu(),this.credentials.getToken().then((function(i){return r.Gc.Vu(t,e,n,i)})).catch((function(t){throw t.code===Mr.UNAUTHENTICATED&&r.credentials.m(),t}))},e.prototype.terminate=function(){this.Pu=!1},e}((function(){})),wc=function(){function t(t,e){this.di=t,this.pu=e,this.state="Unknown",this.vu=0,this.bu=null,this.Su=!0}return t.prototype.Du=function(){var t=this;0===this.vu&&(this.Cu("Unknown"),this.bu=this.di.Us("online_state_timeout",1e4,(function(){return t.bu=null,t.Nu("Backend didn't respond within 10 seconds."),t.Cu("Offline"),Promise.resolve()})))},t.prototype.xu=function(t){"Online"===this.state?this.Cu("Unknown"):(this.vu++,this.vu>=1&&(this.Fu(),this.Nu("Connection failed 1 times. Most recent error: "+t.toString()),this.Cu("Offline")))},t.prototype.set=function(t){this.Fu(),this.vu=0,"Online"===t&&(this.Su=!1),this.Cu(t)},t.prototype.Cu=function(t){t!==this.state&&(this.state=t,this.pu(t))},t.prototype.Nu=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Su?(Pr(e),this.Su=!1):xr("OnlineStateTracker",e)},t.prototype.Fu=function(){null!==this.bu&&(this.bu.cancel(),this.bu=null)},t}(),_c=function(t,e,n,r,i){var o=this;this.Ou=t,this.Mu=e,this.di=n,this.ku={},this.$u=[],this.Lu=new Map,this.Bu=new Set,this.qu=[],this.Uu=i,this.Uu.Qu((function(t){n.Ri((function(){return Object(_.b)(o,void 0,void 0,(function(){return Object(_.e)(this,(function(t){switch(t.label){case 0:return Sc(this)?(xr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(_.b)(this,void 0,void 0,(function(){var e;return Object(_.e)(this,(function(n){switch(n.label){case 0:return(e=Ur(t)).Bu.add(4),[4,Ec(e)];case 1:return n.sent(),e.Ku.set("Unknown"),e.Bu.delete(4),[4,Ic(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Ku=new wc(n,r)};function Ic(t){return Object(_.b)(this,void 0,void 0,(function(){var e,n;return Object(_.e)(this,(function(r){switch(r.label){case 0:if(!Sc(t))return[3,4];e=0,n=t.qu,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Ec(t){return Object(_.b)(this,void 0,void 0,(function(){var e,n;return Object(_.e)(this,(function(r){switch(r.label){case 0:e=0,n=t.qu,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Oc(t,e){var n=Ur(t);n.Lu.has(e.targetId)||(n.Lu.set(e.targetId,e),Dc(n)?Nc(n):Kc(n).Xc()&&Ac(n,e))}function Tc(t,e){var n=Ur(t),r=Kc(n);n.Lu.delete(e),r.Xc()&&jc(n,e),0===n.Lu.size&&(r.Xc()?r.eu():Sc(n)&&n.Ku.set("Unknown"))}function Ac(t,e){t.Wu.De(e.targetId),Kc(t).du(e)}function jc(t,e){t.Wu.De(e),Kc(t).wu(e)}function Nc(t){t.Wu=new Bi({Xe:function(e){return t.ku.Xe(e)},Ze:function(e){return t.Lu.get(e)||null}}),Kc(t).start(),t.Ku.Du()}function Dc(t){return Sc(t)&&!Kc(t).Yc()&&t.Lu.size>0}function Sc(t){return 0===Ur(t).Bu.size}function xc(t){t.Wu=void 0}function Pc(t){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(e){return t.Lu.forEach((function(e,n){Ac(t,e)})),[2]}))}))}function kc(t,e){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(n){return xc(t),Dc(t)?(t.Ku.xu(e),Nc(t)):t.Ku.set("Unknown"),[2]}))}))}function Cc(t,e,n){return Object(_.b)(this,void 0,void 0,(function(){var r,i,o;return Object(_.e)(this,(function(s){switch(s.label){case 0:if(t.Ku.set("Online"),!(e instanceof qi&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(_.e)(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.Lu.has(o=i[r])?[4,t.ku.ju(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.Lu.delete(o),t.Wu.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),xr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Rc(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Mi?t.Wu.$e(e):e instanceof Vi?t.Wu.je(e):t.Wu.qe(e),n.isEqual(Yr.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,sc(t.Ou)];case 8:return i=s.sent(),n.F(i)>=0?[4,function(t,e){var n=t.Wu.He(e);return n.re.forEach((function(n,r){if(n.resumeToken.ht()>0){var i=t.Lu.get(r);i&&t.Lu.set(r,i.wt(n.resumeToken,e))}})),n.oe.forEach((function(e){var n=t.Lu.get(e);if(n){t.Lu.set(e,n.wt(fi.lt,n.ft)),jc(t,e);var r=new di(n.target,e,1,n.sequenceNumber);Ac(t,r)}})),t.ku.Gu(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return xr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Rc(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function Rc(t,e,n){return Object(_.b)(this,void 0,void 0,(function(){var r=this;return Object(_.e)(this,(function(i){switch(i.label){case 0:if(!Au(e))throw e;return t.Bu.add(1),[4,Ec(t)];case 1:return i.sent(),t.Ku.set("Offline"),n||(n=function(){return sc(t.Ou)}),t.di.Mi((function(){return Object(_.b)(r,void 0,void 0,(function(){return Object(_.e)(this,(function(e){switch(e.label){case 0:return xr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Bu.delete(1),[4,Ic(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Lc(t,e){return e().catch((function(n){return Rc(t,n,e)}))}function Uc(t){return Object(_.b)(this,void 0,void 0,(function(){var e,n,r,i,o;return Object(_.e)(this,(function(s){switch(s.label){case 0:e=Ur(t),n=Wc(e),r=e.$u.length>0?e.$u[e.$u.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Sc(t)&&t.$u.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,ac(e.Ou,r)];case 3:return null===(i=s.sent())?(0===e.$u.length&&n.eu(),[3,7]):(r=i.batchId,function(t,e){t.$u.push(e);var n=Wc(t);n.Xc()&&n.Tu&&n.Iu(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,Rc(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Mc(e)&&Vc(e),[2]}}))}))}function Mc(t){return Sc(t)&&!Wc(t).Yc()&&t.$u.length>0}function Vc(t){Wc(t).start()}function qc(t){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(e){return Wc(t).Ru(),[2]}))}))}function Fc(t){return Object(_.b)(this,void 0,void 0,(function(){var e,n,r;return Object(_.e)(this,(function(i){for(e=Wc(t),n=0,r=t.$u;n<r.length;n++)e.Iu(r[n].mutations);return[2]}))}))}function Bc(t,e,n){return Object(_.b)(this,void 0,void 0,(function(){var r,i;return Object(_.e)(this,(function(o){switch(o.label){case 0:return r=t.$u.shift(),i=hu.from(r,e,n),[4,Lc(t,(function(){return t.ku.zu(i)}))];case 1:return o.sent(),[4,Uc(t)];case 2:return o.sent(),[2]}}))}))}function zc(t,e){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(n){switch(n.label){case 0:return e&&Wc(t).Tu?[4,function(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r;return Object(_.e)(this,(function(i){switch(i.label){case 0:return yi(r=e.code)&&r!==Mr.ABORTED?(n=t.$u.shift(),Wc(t).tu(),[4,Lc(t,(function(){return t.ku.Hu(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Uc(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Mc(t)&&Vc(t),[2]}}))}))}function Gc(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n;return Object(_.e)(this,(function(r){switch(r.label){case 0:return n=Ur(t),e?(n.Bu.delete(2),[4,Ic(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Bu.add(2),[4,Ec(n)]);case 3:r.sent(),n.Ku.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Kc(t){var e=this;return t.Ju||(t.Ju=function(t,e,n){var r=Ur(t);return r.gu(),new gc(e,r.Gc,r.credentials,r.serializer,n)}(t.Mu,t.di,{lu:Pc.bind(null,t),ou:kc.bind(null,t),fu:Cc.bind(null,t)}),t.qu.push((function(n){return Object(_.b)(e,void 0,void 0,(function(){return Object(_.e)(this,(function(e){switch(e.label){case 0:return n?(t.Ju.tu(),Dc(t)?Nc(t):t.Ku.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ju.stop()];case 2:e.sent(),xc(t),e.label=3;case 3:return[2]}}))}))}))),t.Ju}function Wc(t){var e=this;return t.Yu||(t.Yu=function(t,e,n){var r=Ur(t);return r.gu(),new bc(e,r.Gc,r.credentials,r.serializer,n)}(t.Mu,t.di,{lu:qc.bind(null,t),ou:zc.bind(null,t),Au:Fc.bind(null,t),mu:Bc.bind(null,t)}),t.qu.push((function(n){return Object(_.b)(e,void 0,void 0,(function(){return Object(_.e)(this,(function(e){switch(e.label){case 0:return n?(t.Yu.tu(),[4,Uc(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Yu.stop()];case 3:e.sent(),t.$u.length>0&&(xr("RemoteStore","Stopping write stream with "+t.$u.length+" pending writes"),t.$u=[]),e.label=4;case 4:return[2]}}))}))}))),t.Yu}var Qc=function(){this.Xu=void 0,this.listeners=[]},Jc=function(){this.queries=new fu((function(t){return zs(t)}),Bs),this.onlineState="Unknown",this.Zu=new Set};function Xc(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i,o,s,u,a;return Object(_.e)(this,(function(c){switch(c.label){case 0:if(n=Ur(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Qc),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.ta(r)];case 2:return s.Xu=c.sent(),[3,4];case 3:return u=c.sent(),a=Lu(u,"Initialization of query '"+Gs(e.query)+"' failed"),[2,void e.onError(a)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.ea(n.onlineState),o.Xu&&e.na(o.Xu)&&Zc(n),[2]}}))}))}function $c(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(_.e)(this,(function(u){return n=Ur(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.sa(r))]:[2]}))}))}function Yc(t,e){for(var n=Ur(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=n.queries.get(s.query);if(u){for(var a=0,c=u.listeners;a<c.length;a++)c[a].na(s)&&(r=!0);u.Xu=s}}r&&Zc(n)}function Hc(t,e,n){var r=Ur(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Zc(t){t.Zu.forEach((function(t){t.next()}))}var th=function(){function t(t,e,n){this.query=t,this.ia=e,this.ra=!1,this.oa=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.na=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Ri(t.query,t.docs,t.te,e,t.ee,t.fromCache,t.ne,!0)}var o=!1;return this.ra?this.ca(t)&&(this.ia.next(t),o=!0):this.ua(t,this.onlineState)&&(this.aa(t),o=!0),this.oa=t,o},t.prototype.onError=function(t){this.ia.error(t)},t.prototype.ea=function(t){this.onlineState=t;var e=!1;return this.oa&&!this.ra&&this.ua(this.oa,t)&&(this.aa(this.oa),e=!0),e},t.prototype.ua=function(t,e){return!t.fromCache||!(this.options.ha&&"Offline"!==e||t.docs.W()&&"Offline"!==e)},t.prototype.ca=function(t){return t.docChanges.length>0||!!(t.ne||this.oa&&this.oa.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.aa=function(t){t=Ri.ie(t.query,t.docs,t.ee,t.fromCache),this.ra=!0,this.ia.next(t)},t}(),eh=function(){function t(){this.la=new _i(nh._a),this.fa=new _i(nh.da)}return t.prototype.W=function(){return this.la.W()},t.prototype.Oo=function(t,e){var n=new nh(t,e);this.la=this.la.add(n),this.fa=this.fa.add(n)},t.prototype.wa=function(t,e){var n=this;t.forEach((function(t){return n.Oo(t,e)}))},t.prototype.ko=function(t,e){this.Ea(new nh(t,e))},t.prototype.Ta=function(t,e){var n=this;t.forEach((function(t){return n.ko(t,e)}))},t.prototype.Ia=function(t){var e=this,n=new ni(new Zr([])),r=new nh(n,t),i=new nh(n,t+1),o=[];return this.fa.Kt([r,i],(function(t){e.Ea(t),o.push(t.key)})),o},t.prototype.ma=function(){var t=this;this.la.forEach((function(e){return t.Ea(e)}))},t.prototype.Ea=function(t){this.la=this.la.delete(t),this.fa=this.fa.delete(t)},t.prototype.Aa=function(t){var e=new ni(new Zr([])),n=new nh(e,t),r=new nh(e,t+1),i=Si();return this.fa.Kt([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.zr=function(t){var e=new nh(t,0),n=this.la.jt(e);return null!==n&&t.isEqual(n.key)},t}(),nh=function(){function t(t,e){this.key=t,this.Ra=e}return t._a=function(t,e){return ni.$(t.key,e.key)||Qr(t.Ra,e.Ra)},t.da=function(t,e){return Qr(t.Ra,e.Ra)||ni.$(t.key,e.key)},t}();function rh(t,e){return"firestore_clients_"+t+"_"+e}function ih(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.u()&&(r+="_"+e.uid),r}function oh(t,e){return"firestore_targets_"+t+"_"+e}var sh=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Pa=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new Vr(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(Pr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.ga=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),uh=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Pa=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Vr(r.error.code,r.error.message)),i?new t(e,r.state,o):(Pr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.ga=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),ah=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Pa=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Pi(),s=0;i&&s<r.activeTargetIds.length;++s)i=oi(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Pr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),ch=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Pa=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Pr("SharedClientState","Failed to parse online state: "+e),null)},t}(),hh=function(){function t(){this.activeTargetIds=Pi()}return t.prototype.ya=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Va=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.ga=function(){var t={activeTargetIds:this.activeTargetIds.H(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),fh=function(){function t(t,e,n,r,i){this.window=t,this.Cs=e,this.persistenceKey=n,this.pa=r,this.va=null,this.pu=null,this.ps=null,this.ba=this.Sa.bind(this),this.Da=new bi(Qr),this.lr=!1,this.Ca=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Na=rh(this.persistenceKey,this.pa),this.xa=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Da=this.Da.Tt(this.pa,new hh),this.Fa=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Oa=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Ma=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.ka=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.$a=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.ba)}return t.Gs=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(_.b)(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,u,a,c,h=this;return Object(_.e)(this,(function(f){switch(f.label){case 0:return[4,this.va.gc()];case 1:for(t=f.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.pa&&(i=this.getItem(rh(this.persistenceKey,r)))&&(o=ah.Pa(r,i))&&(this.Da=this.Da.Tt(o.clientId,o));for(this.La(),(s=this.storage.getItem(this.ka))&&(u=this.Ba(s))&&this.qa(u),a=0,c=this.Ca;a<c.length;a++)this.Sa(c[a]);return this.Ca=[],this.window.addEventListener("unload",(function(){return h.Ic()})),this.lr=!0,[2]}}))}))},t.prototype.Ss=function(t){this.setItem(this.xa,JSON.stringify(t))},t.prototype.Ua=function(){return this.Qa(this.Da)},t.prototype.Ka=function(t){var e=!1;return this.Da.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.Wa=function(t){this.ja(t,"pending")},t.prototype.Ga=function(t,e,n){this.ja(t,e,n),this.za(t)},t.prototype.Ha=function(t){var e="not-current";if(this.Ka(t)){var n=this.storage.getItem(oh(this.persistenceKey,t));if(n){var r=uh.Pa(t,n);r&&(e=r.state)}}return this.Ja.ya(t),this.La(),e},t.prototype.Ya=function(t){this.Ja.Va(t),this.La()},t.prototype.Xa=function(t){return this.Ja.activeTargetIds.has(t)},t.prototype.Za=function(t){this.removeItem(oh(this.persistenceKey,t))},t.prototype.th=function(t,e,n){this.eh(t,e,n)},t.prototype.nh=function(t,e,n){var r=this;e.forEach((function(t){r.za(t)})),this.currentUser=t,n.forEach((function(t){r.Wa(t)}))},t.prototype.sh=function(t){this.ih(t)},t.prototype.rh=function(){this.oh()},t.prototype.Ic=function(){this.lr&&(this.window.removeEventListener("storage",this.ba),this.removeItem(this.Na),this.lr=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return xr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){xr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){xr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Sa=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(xr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Na)return void Pr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Cs.Mi((function(){return Object(_.b)(e,void 0,void 0,(function(){var t,e,r,i,o,s;return Object(_.e)(this,(function(u){if(this.lr){if(null!==n.key)if(this.Fa.test(n.key)){if(null==n.newValue)return t=this.uh(n.key),[2,this.ah(t,null)];if(e=this.hh(n.key,n.newValue))return[2,this.ah(e.clientId,e)]}else if(this.Oa.test(n.key)){if(null!==n.newValue&&(r=this.lh(n.key,n.newValue)))return[2,this._h(r)]}else if(this.Ma.test(n.key)){if(null!==n.newValue&&(i=this.fh(n.key,n.newValue)))return[2,this.dh(i)]}else if(n.key===this.ka){if(null!==n.newValue&&(o=this.Ba(n.newValue)))return[2,this.qa(o)]}else if(n.key===this.xa)(s=function(t){var e=_u.Ds;if(null!=t)try{var n=JSON.parse(t);Lr("number"==typeof n),e=n}catch(t){Pr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==_u.Ds&&this.ps(s);else if(n.key===this.$a)return[2,this.va.wh()]}else this.Ca.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Ja",{get:function(){return this.Da.get(this.pa)},enumerable:!1,configurable:!0}),t.prototype.La=function(){this.setItem(this.Na,this.Ja.ga())},t.prototype.ja=function(t,e,n){var r=new sh(this.currentUser,t,e,n),i=ih(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ga())},t.prototype.za=function(t){var e=ih(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.ih=function(t){this.storage.setItem(this.ka,JSON.stringify({clientId:this.pa,onlineState:t}))},t.prototype.eh=function(t,e,n){var r=oh(this.persistenceKey,t),i=new uh(t,e,n);this.setItem(r,i.ga())},t.prototype.oh=function(){this.setItem(this.$a,"value-not-used")},t.prototype.uh=function(t){var e=this.Fa.exec(t);return e?e[1]:null},t.prototype.hh=function(t,e){var n=this.uh(t);return ah.Pa(n,e)},t.prototype.lh=function(t,e){var n=this.Oa.exec(t),r=Number(n[1]);return sh.Pa(new Nr(void 0!==n[2]?n[2]:null),r,e)},t.prototype.fh=function(t,e){var n=this.Ma.exec(t),r=Number(n[1]);return uh.Pa(r,e)},t.prototype.Ba=function(t){return ch.Pa(t)},t.prototype._h=function(t){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.va.Eh(t.batchId,t.state,t.error)]:(xr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.dh=function(t){return this.va.Th(t.targetId,t.state,t.error)},t.prototype.ah=function(t,e){var n=this,r=e?this.Da.Tt(t,e):this.Da.remove(t),i=this.Qa(this.Da),o=this.Qa(r),s=[],u=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||u.push(t)})),this.va.Ih(s,u).then((function(){n.Da=r}))},t.prototype.qa=function(t){this.Da.get(t.clientId)&&this.pu(t.onlineState)},t.prototype.Qa=function(t){var e=Pi();return t.forEach((function(t,n){e=e.Gt(n.activeTargetIds)})),e},t}(),lh=function(){function t(){this.mh=new hh,this.Ah={},this.pu=null,this.ps=null}return t.prototype.Wa=function(t){},t.prototype.Ga=function(t,e,n){},t.prototype.Ha=function(t){return this.mh.ya(t),this.Ah[t]||"not-current"},t.prototype.th=function(t,e,n){this.Ah[t]=e},t.prototype.Ya=function(t){this.mh.Va(t)},t.prototype.Xa=function(t){return this.mh.activeTargetIds.has(t)},t.prototype.Za=function(t){delete this.Ah[t]},t.prototype.Ua=function(){return this.mh.activeTargetIds},t.prototype.Ka=function(t){return this.mh.activeTargetIds.has(t)},t.prototype.start=function(){return this.mh=new hh,Promise.resolve()},t.prototype.nh=function(t,e,n){},t.prototype.sh=function(t){},t.prototype.Ic=function(){},t.prototype.Ss=function(t){},t.prototype.rh=function(){},t}(),ph=function(t){this.key=t},dh=function(t){this.key=t},vh=function(){function t(t,e){this.query=t,this.Rh=e,this.Ph=null,this.le=!1,this.gh=Si(),this.ee=Si(),this.yh=Ws(t),this.Vh=new ki(this.yh)}return Object.defineProperty(t.prototype,"ph",{get:function(){return this.Rh},enumerable:!1,configurable:!0}),t.prototype.bh=function(t,e){var n=this,r=e?e.Sh:new Ci,i=e?e.Vh:this.Vh,o=e?e.ee:this.ee,s=i,u=!1,a=Cs(this.query)&&i.size===this.query.limit?i.last():null,c=Rs(this.query)&&i.size===this.query.limit?i.first():null;if(t.Pt((function(t,e){var h=i.get(t),f=e instanceof Ns?e:null;f&&(f=Ks(n.query,f)?f:null);var l=!!h&&n.ee.has(h.key),p=!!f&&(f.an||n.ee.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.Dh(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.yh(f,a)>0||c&&n.yh(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(u=!0)),d&&(f?(s=s.add(f),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Cs(this.query)||Rs(this.query))for(;s.size>this.query.limit;){var h=Cs(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{Vh:s,Sh:r,br:u,ee:o}},t.prototype.Dh=function(t,e){return t.an&&e.hasCommittedMutations&&!e.an},t.prototype.Zn=function(t,e,n){var r=this,i=this.Vh;this.Vh=t.Vh,this.ee=t.ee;var o=t.Sh.Zt();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Rr()}};return n(t)-n(e)}(t.type,e.type)||r.yh(t.doc,e.doc)})),this.Ch(n);var s=e?this.Nh():[],u=0===this.gh.size&&this.le?1:0,a=u!==this.Ph;return this.Ph=u,0!==o.length||a?{snapshot:new Ri(this.query,t.Vh,i,o,t.ee,0===u,a,!1),xh:s}:{xh:s}},t.prototype.ea=function(t){return this.le&&"Offline"===t?(this.le=!1,this.Zn({Vh:this.Vh,Sh:new Ci,ee:this.ee,br:!1},!1)):{xh:[]}},t.prototype.Fh=function(t){return!this.Rh.has(t)&&!!this.Vh.has(t)&&!this.Vh.get(t).an},t.prototype.Ch=function(t){var e=this;t&&(t._e.forEach((function(t){return e.Rh=e.Rh.add(t)})),t.fe.forEach((function(t){})),t.de.forEach((function(t){return e.Rh=e.Rh.delete(t)})),this.le=t.le)},t.prototype.Nh=function(){var t=this;if(!this.le)return[];var e=this.gh;this.gh=Si(),this.Vh.forEach((function(e){t.Fh(e.key)&&(t.gh=t.gh.add(e.key))}));var n=[];return e.forEach((function(e){t.gh.has(e)||n.push(new dh(e))})),this.gh.forEach((function(t){e.has(t)||n.push(new ph(t))})),n},t.prototype.Oh=function(t){this.Rh=t.Kc,this.gh=Si();var e=this.bh(t.documents);return this.Zn(e,!0)},t.prototype.Mh=function(){return Ri.ie(this.query,this.Vh,this.ee,0===this.Ph)},t}(),yh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},gh=function(t){this.key=t,this.kh=!1},bh=function(){function t(t,e,n,r,i,o){this.Ou=t,this.$h=e,this.Lh=n,this.Bh=r,this.currentUser=i,this.qh=o,this.Uh={},this.Qh=new fu((function(t){return zs(t)}),Bs),this.Kh=new Map,this.Wh=[],this.jh=new bi(ni.$),this.Gh=new Map,this.zh=new eh,this.Hh={},this.Jh=new Map,this.Yh=za.Io(),this.onlineState="Unknown",this.Xh=void 0}return Object.defineProperty(t.prototype,"Zh",{get:function(){return!0===this.Xh},enumerable:!1,configurable:!0}),t}();function mh(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(_.e)(this,(function(u){switch(u.label){case 0:return n=Jh(t),(i=n.Qh.get(e))?(n.Bh.Ha(i.targetId),r=i.view.Mh(),[3,4]):[3,1];case 1:return[4,cc(n.Ou,qs(e))];case 2:return o=u.sent(),s=n.Bh.Ha(o.targetId),[4,wh(n,e,o.targetId,"current"===s)];case 3:r=u.sent(),n.Zh&&Oc(n.$h,o),u.label=4;case 4:return[2,r]}}))}))}function wh(t,e,n,r){return Object(_.b)(this,void 0,void 0,(function(){var i,o,s,u,a,c;return Object(_.e)(this,(function(h){switch(h.label){case 0:return t.tl=function(e,n,r){return function(t,e,n,r){return Object(_.b)(this,void 0,void 0,(function(){var i,o,s;return Object(_.e)(this,(function(u){switch(u.label){case 0:return(i=e.view.bh(n)).br?[4,fc(t.Ou,e.query,!1).then((function(t){return e.view.bh(t.documents,i)}))]:[3,2];case 1:i=u.sent(),u.label=2;case 2:return o=r&&r.re.get(e.targetId),s=e.view.Zn(i,t.Zh,o),[2,(kh(t,e.targetId,s.xh),s.snapshot)]}}))}))}(t,e,n,r)},[4,fc(t.Ou,e,!0)];case 1:return i=h.sent(),o=new vh(e,i.Kc),s=o.bh(i.documents),u=Ui.he(n,r&&"Offline"!==t.onlineState),a=o.Zn(s,t.Zh,u),kh(t,n,a.xh),c=new yh(e,n,o),[2,(t.Qh.set(e,c),t.Kh.has(n)?t.Kh.get(n).push(e):t.Kh.set(n,[e]),a.snapshot)]}}))}))}function _h(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i;return Object(_.e)(this,(function(o){switch(o.label){case 0:return n=Ur(t),r=n.Qh.get(e),(i=n.Kh.get(r.targetId)).length>1?[2,(n.Kh.set(r.targetId,i.filter((function(t){return!Bs(t,e)}))),void n.Qh.delete(e))]:n.Zh?(n.Bh.Ya(r.targetId),n.Bh.Ka(r.targetId)?[3,2]:[4,hc(n.Ou,r.targetId,!1).then((function(){n.Bh.Za(r.targetId),Tc(n.$h,r.targetId),xh(n,r.targetId)})).catch(vc)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return xh(n,r.targetId),[4,hc(n.Ou,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function Ih(t,e,n){return Object(_.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(_.e)(this,(function(u){switch(u.label){case 0:r=Xh(t),u.label=1;case 1:return u.trys.push([1,5,,6]),[4,function(t,e){var n,r=Ur(t),i=$r.now(),o=e.reduce((function(t,e){return t.add(e.key)}),Si());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Bc._s(t,o).next((function(o){n=o;for(var s=[],u=0,a=e;u<a.length;u++){var c=a[u],h=ps(c,n.get(c.key));null!=h&&s.push(new gs(c.key,h,As(h.proto.mapValue),as.exists(!0)))}return r.rs.Or(t,i,s,e)}))})).then((function(t){var e=t.vn(n);return{batchId:t.batchId,Qn:e}}))}(r.Ou,e)];case 2:return i=u.sent(),r.Bh.Wa(i.batchId),function(t,e,n){var r=t.Hh[t.currentUser.h()];r||(r=new bi(Qr)),r=r.Tt(e,n),t.Hh[t.currentUser.h()]=r}(r,i.batchId,n),[4,Lh(r,i.Qn)];case 3:return u.sent(),[4,Uc(r.$h)];case 4:return u.sent(),[3,6];case 5:return o=u.sent(),s=Lu(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function Eh(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r;return Object(_.e)(this,(function(i){switch(i.label){case 0:n=Ur(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,uc(n.Ou,e)];case 2:return r=i.sent(),e.re.forEach((function(t,e){var r=n.Gh.get(e);r&&(Lr(t._e.size+t.fe.size+t.de.size<=1),t._e.size>0?r.kh=!0:t.fe.size>0?Lr(r.kh):t.de.size>0&&(Lr(r.kh),r.kh=!1))})),[4,Lh(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,vc(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Oh(t,e,n){var r=Ur(t);if(r.Zh&&0===n||!r.Zh&&1===n){var i=[];r.Qh.forEach((function(t,n){var r=n.view.ea(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=Ur(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].ea(e)&&(r=!0)})),r&&Zc(n)}(r.Lh,e),i.length&&r.Uh.fu(i),r.onlineState=e,r.Zh&&r.Bh.sh(e)}}function Th(t,e,n){return Object(_.b)(this,void 0,void 0,(function(){var r,i,o,s,u,a;return Object(_.e)(this,(function(c){switch(c.label){case 0:return(r=Ur(t)).Bh.th(e,"rejected",n),i=r.Gh.get(e),(o=i&&i.key)?(s=(s=new bi(ni.$)).Tt(o,new Ds(o,Yr.min())),u=Si().add(o),a=new Li(Yr.min(),new Map,new _i(Qr),s,u),[4,Eh(r,a)]):[3,2];case 1:return c.sent(),r.jh=r.jh.remove(o),r.Gh.delete(e),Rh(r),[3,4];case 2:return[4,hc(r.Ou,e,!1).then((function(){return xh(r,e,n)})).catch(vc)];case 3:c.sent(),c.label=4;case 4:return[2]}}))}))}function Ah(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i;return Object(_.e)(this,(function(o){switch(o.label){case 0:n=Ur(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,oc(n.Ou,e)];case 2:return i=o.sent(),Sh(n,r,null),Dh(n,r),n.Bh.Ga(r,"acknowledged"),[4,Lh(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,vc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function jh(t,e,n){return Object(_.b)(this,void 0,void 0,(function(){var r,i;return Object(_.e)(this,(function(o){switch(o.label){case 0:r=Ur(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Ur(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n.rs.kr(t,e).next((function(e){return Lr(null!==e),r=e.keys(),n.rs.Qr(t,e)})).next((function(){return n.rs.Gr(t)})).next((function(){return n.Bc._s(t,r)}))}))}(r.Ou,e)];case 2:return i=o.sent(),Sh(r,e,n),Dh(r,e),r.Bh.Ga(e,"rejected",n),[4,Lh(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,vc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Nh(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(_.e)(this,(function(u){switch(u.label){case 0:Sc((n=Ur(t)).$h)||xr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,function(t){var e=Ur(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e.rs.Br(t)}))}(n.Ou)];case 2:return-1===(r=u.sent())?[2,void e.resolve()]:((i=n.Jh.get(r)||[]).push(e),n.Jh.set(r,i),[3,4]);case 3:return o=u.sent(),s=Lu(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}}))}))}function Dh(t,e){(t.Jh.get(e)||[]).forEach((function(t){t.resolve()})),t.Jh.delete(e)}function Sh(t,e,n){var r=Ur(t),i=r.Hh[r.currentUser.h()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Hh[r.currentUser.h()]=i}}function xh(t,e,n){void 0===n&&(n=null),t.Bh.Ya(e);for(var r=0,i=t.Kh.get(e);r<i.length;r++){var o=i[r];t.Qh.delete(o),n&&t.Uh.el(o,n)}t.Kh.delete(e),t.Zh&&t.zh.Ia(e).forEach((function(e){t.zh.zr(e)||Ph(t,e)}))}function Ph(t,e){var n=t.jh.get(e);null!==n&&(Tc(t.$h,n),t.jh=t.jh.remove(e),t.Gh.delete(n),Rh(t))}function kh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof ph?(t.zh.Oo(o.key,e),Ch(t,o)):o instanceof dh?(xr("SyncEngine","Document no longer in limbo: "+o.key),t.zh.ko(o.key,e),t.zh.zr(o.key)||Ph(t,o.key)):Rr()}}function Ch(t,e){var n=e.key;t.jh.get(n)||(xr("SyncEngine","New document in limbo: "+n),t.Wh.push(n),Rh(t))}function Rh(t){for(;t.Wh.length>0&&t.jh.size<t.qh;){var e=t.Wh.shift(),n=t.Yh.next();t.Gh.set(n,new gh(e)),t.jh=t.jh.Tt(e,n),Oc(t.$h,new di(qs(ks(e.path)),n,2,_u.Ds))}}function Lh(t,e,n){return Object(_.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(_.e)(this,(function(u){switch(u.label){case 0:return r=Ur(t),i=[],o=[],s=[],r.Qh.W()?[3,3]:(r.Qh.forEach((function(t,u){s.push(r.tl(u,e,n).then((function(t){if(t){r.Zh&&r.Bh.th(u.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=wu.Vs(u.targetId,t);o.push(e)}})))})),[4,Promise.all(s)]);case 1:return u.sent(),r.Uh.fu(i),[4,function(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i,o,s,u,a,c;return Object(_.e)(this,(function(h){switch(h.label){case 0:n=Ur(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return lu.forEach(e,(function(e){return lu.forEach(e.gs,(function(r){return n.persistence.Dr.Oo(t,e.targetId,r)})).next((function(){return lu.forEach(e.ys,(function(r){return n.persistence.Dr.ko(t,e.targetId,r)}))}))}))}))];case 2:return h.sent(),[3,4];case 3:if(!Au(r=h.sent()))throw r;return xr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)u=(s=o[i]).targetId,s.fromCache||(a=n.Mc.get(u),c=a.Et(a.ft),n.Mc=n.Mc.Tt(u,c));return[2]}}))}))}(r.Ou,o)];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))}function Uh(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r;return Object(_.e)(this,(function(i){switch(i.label){case 0:return(n=Ur(t)).currentUser.isEqual(e)?[3,3]:(xr("SyncEngine","User change. New user:",e.h()),[4,ic(n.Ou,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Jh.forEach((function(t){t.forEach((function(t){t.reject(new Vr(Mr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Jh.clear()}(n),n.Bh.nh(e,r.Uc,r.Qc),[4,Lh(n,r.qc)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function Mh(t,e){var n=Ur(t),r=n.Gh.get(e);if(r&&r.kh)return Si().add(r.key);var i=Si(),o=n.Kh.get(e);if(!o)return i;for(var s=0,u=o;s<u.length;s++){var a=n.Qh.get(u[s]);i=i.Gt(a.view.ph)}return i}function Vh(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i;return Object(_.e)(this,(function(o){switch(o.label){case 0:return[4,fc((n=Ur(t)).Ou,e.query,!0)];case 1:return r=o.sent(),i=e.view.Oh(r),[2,(n.Zh&&kh(n,e.targetId,i.xh),i)]}}))}))}function qh(t){return Object(_.b)(this,void 0,void 0,(function(){var e;return Object(_.e)(this,(function(n){return[2,pc((e=Ur(t)).Ou).then((function(t){return Lh(e,t)}))]}))}))}function Fh(t,e,n,r){return Object(_.b)(this,void 0,void 0,(function(){var i,o;return Object(_.e)(this,(function(s){switch(s.label){case 0:return[4,function(t,e){var n=Ur(t),r=Ur(n.rs);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.$r(t,e).next((function(e){return e?n.Bc._s(t,e):lu.resolve(null)}))}))}((i=Ur(t)).Ou,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Uc(i.$h)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Sh(i,e,r||null),Dh(i,e),function(t,e){Ur(Ur(t).rs).Wr(e)}(i.Ou,e)):Rr(),s.label=4;case 4:return[4,Lh(i,o)];case 5:return s.sent(),[3,7];case 6:xr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}}))}))}function Bh(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i,o,s,u,a;return Object(_.e)(this,(function(c){switch(c.label){case 0:return Jh(n=Ur(t)),Xh(n),!0!==e||!0===n.Xh?[3,3]:(r=n.Bh.Ua(),[4,zh(n,r.H())]);case 1:return i=c.sent(),n.Xh=!0,[4,Gc(n.$h,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)Oc(n.$h,s[o]);return[3,7];case 3:return!1!==e||!1===n.Xh?[3,7]:(u=[],a=Promise.resolve(),n.Kh.forEach((function(t,e){n.Bh.Xa(e)?u.push(e):a=a.then((function(){return xh(n,e),hc(n.Ou,e,!0)})),Tc(n.$h,e)})),[4,a]);case 4:return c.sent(),[4,zh(n,u)];case 5:return c.sent(),function(t){var e=Ur(t);e.Gh.forEach((function(t,n){Tc(e.$h,n)})),e.zh.ma(),e.Gh=new Map,e.jh=new bi(ni.$)}(n),n.Xh=!1,[4,Gc(n.$h,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}}))}))}function zh(t,e,n){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i,o,s,u,a,c,h,f,l,p,d;return Object(_.e)(this,(function(v){switch(v.label){case 0:n=Ur(t),r=[],i=[],o=0,s=e,v.label=1;case 1:return o<s.length?(a=void 0,(c=n.Kh.get(u=s[o]))&&0!==c.length?[4,cc(n.Ou,qs(c[0]))]:[3,7]):[3,13];case 2:a=v.sent(),h=0,f=c,v.label=3;case 3:return h<f.length?(l=n.Qh.get(f[h]),[4,Vh(n,l)]):[3,6];case 4:(p=v.sent()).snapshot&&i.push(p.snapshot),v.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,lc(n.Ou,u)];case 8:return d=v.sent(),[4,cc(n.Ou,d)];case 9:return a=v.sent(),[4,wh(n,Gh(d),u,!1)];case 10:v.sent(),v.label=11;case 11:r.push(a),v.label=12;case 12:return o++,[3,1];case 13:return[2,(n.Uh.fu(i),r)]}}))}))}function Gh(t){return Ps(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Kh(t){var e=Ur(t);return Ur(Ur(e.Ou).persistence).gc()}function Wh(t,e,n,r){return Object(_.b)(this,void 0,void 0,(function(){var i,o,s;return Object(_.e)(this,(function(u){switch(u.label){case 0:return(i=Ur(t)).Xh?(xr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Kh.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,pc(i.Ou)];case 3:return o=u.sent(),s=Li.ae(e,"current"===n),[4,Lh(i,o,s)];case 4:return u.sent(),[3,8];case 5:return[4,hc(i.Ou,e,!0)];case 6:return u.sent(),xh(i,e,r),[3,8];case 7:Rr(),u.label=8;case 8:return[2]}}))}))}function Qh(t,e,n){return Object(_.b)(this,void 0,void 0,(function(){var r,i,o,s,u,a,c,h,f;return Object(_.e)(this,(function(l){switch(l.label){case 0:if(!(r=Jh(t)).Xh)return[3,10];i=0,o=e,l.label=1;case 1:return i<o.length?r.Kh.has(s=o[i])?(xr("SyncEngine","Adding an already active target "+s),[3,5]):[4,lc(r.Ou,s)]:[3,6];case 2:return u=l.sent(),[4,cc(r.Ou,u)];case 3:return a=l.sent(),[4,wh(r,Gh(u),a.targetId,!1)];case 4:l.sent(),Oc(r.$h,a),l.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(_.e)(this,(function(e){switch(e.label){case 0:return r.Kh.has(t)?[4,hc(r.Ou,t,!1).then((function(){Tc(r.$h,t),xh(r,t)})).catch(vc)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},h=0,f=n,l.label=7;case 7:return h<f.length?[5,c(f[h])]:[3,10];case 8:l.sent(),l.label=9;case 9:return h++,[3,7];case 10:return[2]}}))}))}function Jh(t){var e=Ur(t);return e.$h.ku.Gu=Eh.bind(null,e),e.$h.ku.Xe=Mh.bind(null,e),e.$h.ku.ju=Th.bind(null,e),e.Uh.fu=Yc.bind(null,e.Lh),e.Uh.el=Hc.bind(null,e.Lh),e}function Xh(t){var e=Ur(t);return e.$h.ku.zu=Ah.bind(null,e),e.$h.ku.Hu=jh.bind(null,e),e}var $h=function(){function t(t,e){this.os=t,this.Dr=e,this.rs=[],this.nl=1,this.sl=new _i(nh._a)}return t.prototype.Fr=function(t){return lu.resolve(0===this.rs.length)},t.prototype.Or=function(t,e,n,r){var i=this.nl;this.nl++;var o=new cu(i,e,n,r);this.rs.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.sl=this.sl.add(new nh(a.key,i)),this.os.Mr(t,a.key.path.q())}return lu.resolve(o)},t.prototype.kr=function(t,e){return lu.resolve(this.il(e))},t.prototype.Lr=function(t,e){var n=this.rl(e+1),r=n<0?0:n;return lu.resolve(this.rs.length>r?this.rs[r]:null)},t.prototype.Br=function(){return lu.resolve(0===this.rs.length?-1:this.nl-1)},t.prototype.qr=function(t){return lu.resolve(this.rs.slice())},t.prototype.us=function(t,e){var n=this,r=new nh(e,0),i=new nh(e,Number.POSITIVE_INFINITY),o=[];return this.sl.Kt([r,i],(function(t){var e=n.il(t.Ra);o.push(e)})),lu.resolve(o)},t.prototype.ds=function(t,e){var n=this,r=new _i(Qr);return e.forEach((function(t){var e=new nh(t,0),i=new nh(t,Number.POSITIVE_INFINITY);n.sl.Kt([e,i],(function(t){r=r.add(t.Ra)}))})),lu.resolve(this.ol(r))},t.prototype.Rs=function(t,e){var n=e.path,r=n.length+1,i=n;ni.ot(i)||(i=i.child(""));var o=new nh(new ni(i),0),s=new _i(Qr);return this.sl.Wt((function(t){var e=t.key.path;return!!n.j(e)&&(e.length===r&&(s=s.add(t.Ra)),!0)}),o),lu.resolve(this.ol(s))},t.prototype.ol=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.il(t);null!==r&&n.push(r)})),n},t.prototype.Qr=function(t,e){var n=this;Lr(0===this.cl(e.batchId,"removed")),this.rs.shift();var r=this.sl;return lu.forEach(e.mutations,(function(i){var o=new nh(i.key,e.batchId);return r=r.delete(o),n.Dr.jr(t,i.key)})).next((function(){n.sl=r}))},t.prototype.Wr=function(t){},t.prototype.zr=function(t,e){var n=new nh(e,0),r=this.sl.jt(n);return lu.resolve(e.isEqual(r&&r.key))},t.prototype.Gr=function(t){return lu.resolve()},t.prototype.cl=function(t,e){return this.rl(t)},t.prototype.rl=function(t){return 0===this.rs.length?0:t-this.rs[0].batchId},t.prototype.il=function(t){var e=this.rl(t);return e<0||e>=this.rs.length?null:this.rs[e]},t}(),Yh=function(){function t(t,e){this.os=t,this.ul=e,this.docs=new bi(ni.$),this.size=0}return t.prototype.jn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ul(e);return this.docs=this.docs.Tt(r,{zn:e,size:s,readTime:n}),this.size+=s-o,this.os.Mr(t,r.path.q())},t.prototype.Hn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.Jn=function(t,e){var n=this.docs.get(e);return lu.resolve(n?n.zn:null)},t.prototype.getEntries=function(t,e){var n=this,r=Ti();return e.forEach((function(t){var e=n.docs.get(t);r=r.Tt(t,e?e.zn:null)})),lu.resolve(r)},t.prototype.ws=function(t,e,n){for(var r=ji(),i=new ni(e.path.child("")),o=this.docs.Vt(i);o.Nt();){var s=o.Ct(),u=s.value,a=u.zn,c=u.readTime;if(!e.path.j(s.key.path))break;c.F(n)<=0||a instanceof Ns&&Ks(e,a)&&(r=r.Tt(a.key,a))}return lu.resolve(r)},t.prototype.al=function(t,e){return lu.forEach(this.docs,(function(t){return e(t)}))},t.prototype.io=function(t){return new Hh(this)},t.prototype.oo=function(t){return lu.resolve(this.size)},t}(),Hh=function(t){function e(e){var n=this;return(n=t.call(this)||this).co=e,n}return Object(_.d)(e,t),e.prototype.Zn=function(t){var e=this,n=[];return this.Qn.forEach((function(r,i){i&&i.zn?n.push(e.co.jn(t,i.zn,e.Wn(r))):e.co.Hn(r)})),lu.qn(n)},e.prototype.Yn=function(t,e){return this.co.Jn(t,e)},e.prototype.Xn=function(t,e){return this.co.getEntries(t,e)},e}(pu),Zh=function(){function t(t){this.persistence=t,this.hl=new fu((function(t){return ai(t)}),ci),this.lastRemoteSnapshotVersion=Yr.min(),this.highestTargetId=0,this.ll=0,this._l=new eh,this.targetCount=0,this.fl=za.To()}return t.prototype.Ue=function(t,e){return this.hl.forEach((function(t,n){return e(n)})),lu.resolve()},t.prototype.Po=function(t){return lu.resolve(this.lastRemoteSnapshotVersion)},t.prototype.yo=function(t){return lu.resolve(this.ll)},t.prototype.mo=function(t){return this.highestTargetId=this.fl.next(),lu.resolve(this.highestTargetId)},t.prototype.Vo=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ll&&(this.ll=e),lu.resolve()},t.prototype.vo=function(t){this.hl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.fl=new za(e),this.highestTargetId=e),t.sequenceNumber>this.ll&&(this.ll=t.sequenceNumber)},t.prototype.po=function(t,e){return this.vo(e),this.targetCount+=1,lu.resolve()},t.prototype.So=function(t,e){return this.vo(e),lu.resolve()},t.prototype.Do=function(t,e){return this.hl.delete(e.target),this._l.Ia(e.targetId),this.targetCount-=1,lu.resolve()},t.prototype.mr=function(t,e,n){var r=this,i=0,o=[];return this.hl.forEach((function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.hl.delete(s),o.push(r.Co(t,u.targetId)),i++)})),lu.qn(o).next((function(){return i}))},t.prototype.No=function(t){return lu.resolve(this.targetCount)},t.prototype.xo=function(t,e){var n=this.hl.get(e)||null;return lu.resolve(n)},t.prototype.Fo=function(t,e,n){return this._l.wa(e,n),lu.resolve()},t.prototype.Mo=function(t,e,n){this._l.Ta(e,n);var r=this.persistence.Dr,i=[];return r&&e.forEach((function(e){i.push(r.jr(t,e))})),lu.qn(i)},t.prototype.Co=function(t,e){return this._l.Ia(e),lu.resolve()},t.prototype.$o=function(t,e){var n=this._l.Aa(e);return lu.resolve(n)},t.prototype.zr=function(t,e){return lu.resolve(this._l.zr(e))},t}(),tf=function(){function t(t){this.serializer=t,this.dl=new Map,this.wl=new Map}return t.prototype.ho=function(t,e){return lu.resolve(this.dl.get(e))},t.prototype.lo=function(t,e){var n;return this.dl.set(e.id,{id:(n=e).id,version:n.version,createTime:Io(n.createTime)}),lu.resolve()},t.prototype._o=function(t,e){return lu.resolve(this.wl.get(e))},t.prototype.fo=function(t,e){var n;return this.wl.set(e.name,{name:(n=e).name,query:ia(n.bundledQuery),readTime:Io(n.readTime)}),lu.resolve()},t}(),ef=function(){function t(t,e){var n=this;this.El={},this.Uo=new _u(0),this.Qo=!1,this.Qo=!0,this.Dr=t(this),this.Yo=new Zh(this),this.os=new ga,this.ss=function(t,e){return new Yh(t,(function(t){return n.Dr.Tl(t)}))}(this.os),this.serializer=new Ju(e),this.Xo=new tf(this.serializer)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.Ic=function(){return this.Qo=!1,Promise.resolve()},Object.defineProperty(t.prototype,"lr",{get:function(){return this.Qo},enumerable:!1,configurable:!0}),t.prototype.rc=function(){},t.prototype.oc=function(){},t.prototype.bc=function(){return this.os},t.prototype.yc=function(t){var e=this.El[t.h()];return e||(e=new $h(this.os,this.Dr),this.El[t.h()]=e),e},t.prototype.Vc=function(){return this.Yo},t.prototype.vc=function(){return this.ss},t.prototype.Sc=function(){return this.Xo},t.prototype.runTransaction=function(t,e,n){var r=this;xr("MemoryPersistence","Starting transaction:",t);var i=new nf(this.Uo.next());return this.Dr.Il(),n(i).next((function(t){return r.Dr.ml(i).next((function(){return t}))})).Ln().then((function(t){return i.ns(),t}))},t.prototype.Al=function(t,e){return lu.Un(Object.values(this.El).map((function(n){return function(){return n.zr(t,e)}})))},t}(),nf=function(t){function e(e){var n=this;return(n=t.call(this)||this).Lo=e,n}return Object(_.d)(e,t),e}(bu),rf=function(){function t(t){this.persistence=t,this.Rl=new eh,this.Pl=null}return t.gl=function(e){return new t(e)},Object.defineProperty(t.prototype,"yl",{get:function(){if(this.Pl)return this.Pl;throw Rr()},enumerable:!1,configurable:!0}),t.prototype.Oo=function(t,e,n){return this.Rl.Oo(n,e),this.yl.delete(n.toString()),lu.resolve()},t.prototype.ko=function(t,e,n){return this.Rl.ko(n,e),this.yl.add(n.toString()),lu.resolve()},t.prototype.jr=function(t,e){return this.yl.add(e.toString()),lu.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.Rl.Ia(e.targetId).forEach((function(t){return n.yl.add(t.toString())}));var r=this.persistence.Vc();return r.$o(t,e.targetId).next((function(t){t.forEach((function(t){return n.yl.add(t.toString())}))})).next((function(){return r.Do(t,e)}))},t.prototype.Il=function(){this.Pl=new Set},t.prototype.ml=function(t){var e=this,n=this.persistence.vc().io();return lu.forEach(this.yl,(function(r){var i=ni.st(r);return e.Vl(t,i).next((function(t){t||n.Hn(i)}))})).next((function(){return e.Pl=null,n.apply(t)}))},t.prototype.Fc=function(t,e){var n=this;return this.Vl(t,e).next((function(t){t?n.yl.delete(e.toString()):n.yl.add(e.toString())}))},t.prototype.Tl=function(t){return 0},t.prototype.Vl=function(t,e){var n=this;return lu.Un([function(){return lu.resolve(n.Rl.zr(e))},function(){return n.persistence.Vc().zr(t,e)},function(){return n.persistence.Al(t,e)}])},t}(),of=function(){function t(t){this.pl=t.pl,this.vl=t.vl}return t.prototype.lu=function(t){this.bl=t},t.prototype.ou=function(t){this.Sl=t},t.prototype.onMessage=function(t){this.Dl=t},t.prototype.close=function(){this.vl()},t.prototype.send=function(t){this.pl(t)},t.prototype.Cl=function(){this.bl()},t.prototype.Nl=function(t){this.Sl(t)},t.prototype.xl=function(t){this.Dl(t)},t}(),sf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},uf=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.i=e.i,n}return Object(_.d)(e,t),e.prototype.Ll=function(t,e,n,r){return new Promise((function(i,o){var s=new Or;s.listenOnce(_r.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case wr.NO_ERROR:var e=s.getResponseJson();xr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case wr.TIMEOUT:xr("Connection",'RPC "'+t+'" timed out'),o(new Vr(Mr.DEADLINE_EXCEEDED,"Request time out"));break;case wr.HTTP_ERROR:var n=s.getStatus();if(xr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var u=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Mr).indexOf(e)>=0?e:Mr.UNKNOWN}(r.status);o(new Vr(u,r.message))}else o(new Vr(Mr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Vr(Mr.UNAVAILABLE,"Connection failed."));break;default:Rr()}}finally{xr("Connection",'RPC "'+t+'" completed.')}}));var u=JSON.stringify(r);s.send(e,"POST",u,n,15)}))},e.prototype._u=function(t,e){var n=[this.Ol,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new vr,i=ge(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.t.projectId+"/databases/"+this.t.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.i};this.$l(o.initMessageHeaders,e),Object(O.u)()||Object(O.x)()||Object(O.r)()||Object(O.t)()||Object(O.y)()||Object(O.q)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");xr("Connection","Creating WebChannel: "+s,o);var u=r.createWebChannel(s,o),a=!1,c=!1,h=new of({pl:function(t){c?xr("Connection","Not sending because WebChannel is closed:",t):(a||(xr("Connection","Opening WebChannel transport."),u.open(),a=!0),xr("Connection","WebChannel sending:",t),u.send(t))},vl:function(){return u.close()}}),f=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return f(u,Er.EventType.OPEN,(function(){c||xr("Connection","WebChannel transport opened.")})),f(u,Er.EventType.CLOSE,(function(){c||(c=!0,xr("Connection","WebChannel transport closed"),h.Nl())})),f(u,Er.EventType.ERROR,(function(t){c||(c=!0,kr("Connection","WebChannel transport errored:",t),h.Nl(new Vr(Mr.UNAVAILABLE,"The operation could not be completed")))})),f(u,Er.EventType.MESSAGE,(function(t){var e;if(!c){var n=t.data[0];Lr(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){xr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=li[t];if(void 0!==e)return gi(e)}(i),s=r.message;void 0===o&&(o=Mr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Nl(new Vr(o,s)),u.close()}else xr("Connection","WebChannel received:",n),h.xl(n)}})),f(i,Ir.STAT_EVENT,(function(t){10===t.stat?xr("Connection","Detected buffering proxy"):11===t.stat&&xr("Connection","Detected no buffering proxy")})),setTimeout((function(){h.Cl()}),0),h},e}(function(){function t(t){this.Fl=t,this.t=t.t,this.Ol=(t.ssl?"https":"http")+"://"+t.host,this.Ml="projects/"+this.t.projectId+"/databases/"+this.t.database+"/documents"}return t.prototype.yu=function(t,e,n,r){var i=this.kl(t,e);xr("RestConnection","Sending: ",i,n);var o={};return this.$l(o,r),this.Ll(t,i,o,n).then((function(t){return xr("RestConnection","Received: ",t),t}),(function(e){throw kr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Vu=function(t,e,n,r){return this.yu(t,e,n,r)},t.prototype.$l=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.1.2",t["Content-Type"]="text/plain",e)for(var n in e.T)e.T.hasOwnProperty(n)&&(t[n]=e.T[n])},t.prototype.kl=function(t,e){return this.Ol+"/v1/"+e+":"+sf[t]},t}()),af=function(){function t(){var t=this;this.Bl=function(){return t.ql()},this.Ul=function(){return t.Ql()},this.Kl=[],this.Wl()}return t.prototype.Qu=function(t){this.Kl.push(t)},t.prototype.Ic=function(){window.removeEventListener("online",this.Bl),window.removeEventListener("offline",this.Ul)},t.prototype.Wl=function(){window.addEventListener("online",this.Bl),window.addEventListener("offline",this.Ul)},t.prototype.ql=function(){xr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Kl;t<e.length;t++)(0,e[t])(0)},t.prototype.Ql=function(){xr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Kl;t<e.length;t++)(0,e[t])(1)},t.Gs=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),cf=function(){function t(){}return t.prototype.Qu=function(t){},t.prototype.Ic=function(){},t}(),hf=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(e){switch(e.label){case 0:return this.serializer=vu(t.Fl.t),this.Bh=this.jl(t),this.persistence=this.Gl(t),[4,this.persistence.start()];case 1:return e.sent(),this.zl=this.Hl(t),this.Ou=this.Jl(t),[2]}}))}))},t.prototype.Hl=function(t){return null},t.prototype.Jl=function(t){return rc(this.persistence,new zu,t.Yl,this.serializer)},t.prototype.Gl=function(t){return new ef(rf.gl,this.serializer)},t.prototype.jl=function(t){return new lh},t.prototype.terminate=function(){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(t){switch(t.label){case 0:return this.zl&&this.zl.stop(),[4,this.Bh.Ic()];case 1:return t.sent(),[4,this.persistence.Ic()];case 2:return t.sent(),[2]}}))}))},t}(),ff=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Xl=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(_.d)(e,t),e.prototype.initialize=function(e){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,dc(this.Ou)];case 2:return n.sent(),[4,this.Xl.initialize(this,e)];case 3:return n.sent(),[4,Xh(this.Xl.va)];case 4:return n.sent(),[4,Uc(this.Xl.$h)];case 5:return n.sent(),[2]}}))}))},e.prototype.Jl=function(t){return rc(this.persistence,new zu,t.Yl,this.serializer)},e.prototype.Hl=function(t){return new Fu(this.persistence.Dr.cr,t.di)},e.prototype.Gl=function(t){var e=ec(t.Fl.t,t.Fl.persistenceKey),n=void 0!==this.cacheSizeBytes?qu.er(this.cacheSizeBytes):qu.ir;return new $a(this.synchronizeTabs,e,t.clientId,n,t.di,Pu(),ku(),this.serializer,this.Bh,!!this.forceOwnership)},e.prototype.jl=function(t){return new lh},e}(hf),lf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Xl=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(_.d)(e,t),e.prototype.initialize=function(e){return Object(_.b)(this,void 0,void 0,(function(){var n,r=this;return Object(_.e)(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Xl.va,this.Bh instanceof fh?(this.Bh.va={Eh:Fh.bind(null,n),Th:Wh.bind(null,n),Ih:Qh.bind(null,n),gc:Kh.bind(null,n),wh:qh.bind(null,n)},[4,this.Bh.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.ic((function(t){return Object(_.b)(r,void 0,void 0,(function(){return Object(_.e)(this,(function(e){switch(e.label){case 0:return[4,Bh(this.Xl.va,t)];case 1:return e.sent(),this.zl&&(t&&!this.zl.lr?this.zl.start(this.Ou):t||this.zl.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.jl=function(t){var e=Pu();if(!fh.Gs(e))throw new Vr(Mr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=ec(t.Fl.t,t.Fl.persistenceKey);return new fh(e,t.di,n,t.clientId,t.Yl)},e}(ff),pf=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n=this;return Object(_.e)(this,(function(r){switch(r.label){case 0:return this.Ou?[3,2]:(this.Ou=t.Ou,this.Bh=t.Bh,this.Mu=this.Zl(e),this.$h=this.t_(e),this.Lh=this.e_(e),this.va=this.n_(e,!t.synchronizeTabs),this.Bh.pu=function(t){return Oh(n.va,t,1)},this.$h.ku.s_=Uh.bind(null,this.va),[4,Gc(this.$h,this.va.Zh)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.e_=function(t){return new Jc},t.prototype.Zl=function(t){var e=vu(t.Fl.t),n=new uf(t.Fl);return function(t,e,n){return new mc(t,e,n)}(t.credentials,n,e)},t.prototype.t_=function(t){var e,n,r,i,o,s=this;return e=this.Ou,n=this.Mu,r=t.di,i=function(t){return Oh(s.va,t,0)},o=af.Gs()?new af:new cf,new _c(e,n,r,i,o)},t.prototype.n_=function(t,e){return function(t,e,n,r,i,o,s){var u=new bh(t,e,n,r,i,o);return s&&(u.Xh=!0),u}(this.Ou,this.$h,this.Lh,this.Bh,t.Yl,t.qh,e)},t.prototype.terminate=function(){return function(t){return Object(_.b)(this,void 0,void 0,(function(){var e;return Object(_.e)(this,(function(n){switch(n.label){case 0:return e=Ur(t),xr("RemoteStore","RemoteStore shutting down."),e.Bu.add(5),[4,Ec(e)];case 1:return n.sent(),e.Uu.Ic(),e.Ku.set("Unknown"),[2]}}))}))}(this.$h)},t}(),df=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.i_(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.i_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.r_=function(){this.muted=!0},t.prototype.i_=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}();function vf(t,e,n){if(!n)throw new Vr(Mr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function yf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function gf(t,e,n,r){if(!0===e&&!0===r)throw new Vr(Mr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function bf(t){if(!ni.ot(t))throw new Vr(Mr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function mf(t){if(ni.ot(t))throw new Vr(Mr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function wf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Rr()}function _f(t,e){if("_delegate"in t&&(t=t.o_),!(t instanceof e)){if(e.name===t.constructor.name)throw new Vr(Mr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=wf(t);throw new Vr(Mr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function If(t,e){if(e<=0)throw new Vr(Mr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Ef=function(t){this._methodName=t},Of=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.d)(e,t),e.prototype.c_=function(t){if(2!==t.u_)throw t.a_(1===t.u_?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.en.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Ef);function Tf(t,e,n){return new Dl({u_:3,h_:e.settings.h_,methodName:t._methodName,l_:n},e.t,e.serializer,e.ignoreUndefinedProperties)}var Af=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.d)(e,t),e.prototype.c_=function(t){return new ss(t.path,new Yo)},e.prototype.isEqual=function(t){return t instanceof e},e}(Ef),jf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).__=n,r}return Object(_.d)(e,t),e.prototype.c_=function(t){var e=Tf(this,t,!0),n=this.__.map((function(t){return Rl(t,e)})),r=new Ho(n);return new ss(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Ef),Nf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).__=n,r}return Object(_.d)(e,t),e.prototype.c_=function(t){var e=Tf(this,t,!0),n=this.__.map((function(t){return Rl(t,e)})),r=new ts(n);return new ss(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Ef),Df=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).f_=n,r}return Object(_.d)(e,t),e.prototype.c_=function(t){var e=new ns(t.serializer,bo(t.serializer,this.f_));return new ss(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Ef),Sf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Vr(Mr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Vr(Mr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.d_=t,this.w_=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.d_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.w_},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.d_===t.d_&&this.w_===t.w_},t.prototype.toJSON=function(){return{latitude:this.d_,longitude:this.w_}},t.prototype.C=function(t){return Qr(this.d_,t.d_)||Qr(this.w_,t.w_)},t}(),xf=function(){function t(t){this.E_=t}return t.fromBase64String=function(e){try{return new t(fi.fromBase64String(e))}catch(e){throw new Vr(Mr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(fi.fromUint8Array(e))},t.prototype.toBase64=function(){return this.E_.toBase64()},t.prototype.toUint8Array=function(){return this.E_.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.E_.isEqual(t.E_)},t}(),Pf=function(t){this.o_=t},kf=new Map,Cf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Vr(Mr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Vr(Mr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,gf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Rf=function(){function t(t,e){this.T_="(lite)",this.I_=new Cf({}),this.m_=!1,t instanceof jr?(this.A_=t,this.R_=new Fr):(this.P_=t,this.A_=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Vr(Mr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jr(t.options.projectId)}(t),this.R_=new Br(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this.P_)throw new Vr(Mr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.P_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g_",{get:function(){return this.m_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y_",{get:function(){return void 0!==this.V_},enumerable:!1,configurable:!0}),t.prototype.p_=function(t){if(this.m_)throw new Vr(Mr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.I_=new Cf(t),void 0!==t.credentials&&(this.R_=function(t){if(!t)return new Fr;switch(t.type){case"gapi":var e=t.client;return Lr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Gr(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Vr(Mr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype.v_=function(){return this.I_},t.prototype.b_=function(){return this.m_=!0,this.I_},t.prototype._delete=function(){return this.V_||(this.V_=this.S_()),this.V_},t.prototype.S_=function(){return function(t){var e=kf.get(t);e&&(xr("ComponentProvider","Removing Datastore"),kf.delete(t),e.terminate())}(this),Promise.resolve()},t}();function Lf(){if("undefined"==typeof Uint8Array)throw new Vr(Mr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Uf(){if("undefined"==typeof atob)throw new Vr(Mr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Mf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.d)(e,t),e.fromBase64String=function(t){return Uf(),new e(xf.fromBase64String(t))},e.fromUint8Array=function(t){return Lf(),new e(xf.fromUint8Array(t))},e.prototype.toBase64=function(){return Uf(),this.o_.toBase64()},e.prototype.toUint8Array=function(){return Lf(),this.o_.toUint8Array()},e.prototype.isEqual=function(t){return this.o_.isEqual(t.o_)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(Pf),Vf=function(){function t(){}return t.prototype.D_=function(t,e){switch(void 0===e&&(e="none"),Yi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return io(t.integerValue||t.doubleValue);case 3:return this.C_(t.timestampValue);case 4:return this.N_(t,e);case 5:return t.stringValue;case 6:return this.x_(oo(t.bytesValue));case 7:return this.F_(t.referenceValue);case 8:return this.O_(t.geoPointValue);case 9:return this.M_(t.arrayValue,e);case 10:return this.k_(t.mapValue,e);default:throw Rr()}},t.prototype.k_=function(t,e){var n=this,r={};return Wi(t.fields||{},(function(t,i){r[t]=n.D_(i,e)})),r},t.prototype.O_=function(t){return new Sf(io(t.latitude),io(t.longitude))},t.prototype.M_=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.D_(t,e)}))},t.prototype.N_=function(t,e){switch(e){case"previous":var n=function t(e){var n=e.mapValue.fields.__previous_value__;return Ji(n)?t(n):n}(t);return null==n?null:this.D_(n,e);case"estimate":return this.C_(Xi(t));default:return null}},t.prototype.C_=function(t){var e=ro(t);return new $r(e.seconds,e.nanos)},t.prototype.L_=function(t,e){var n=Zr.Y(t);Lr(Wo(n));var r=new jr(n.get(1),n.get(3)),i=new ni(n.B(5));return r.isEqual(e)||Pr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}(),qf=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(_.d)(e,t),e.prototype.x_=function(t){return new Mf(new xf(t))},e.prototype.F_=function(t){var e=this.L_(t,this.firestore.A_);return pp.B_(e,this.firestore,null)},e}(Vf),Ff=function(){function t(t,e,n,r,i){this.q_=t,this.U_=e,this.Q_=n,this.K_=r,this.W_=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this.Q_.path.K()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new il(this.q_,this.W_,this.Q_)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this.K_},t.prototype.data=function(){if(this.K_){if(this.W_){var t=new Bf(this.q_,this.U_,this.Q_,this.K_,null);return this.W_.fromFirestore(t)}return this.U_.D_(this.K_.En())}},t.prototype.get=function(t){if(this.K_){var e=this.K_.data().field(zf("DocumentSnapshot.get",t));if(null!==e)return this.U_.D_(e)}},t}(),Bf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.d)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Ff);function zf(t,e){return"string"==typeof e?Fl(t,e):e instanceof Pf?e.o_.j_:e.j_}var Gf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.j_=new ei(t)}return t.prototype.isEqual=function(t){return this.j_.isEqual(t.j_)},t}(),Kf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).G_=new Ru,r.T_="name"in e?e.name:"[DEFAULT]",r}return Object(_.d)(e,t),e.prototype.S_=function(){return this.z_||hp(this),this.z_.terminate()},e}(Rf);function Wf(t,e,n){var r=this,i=new du;return t.di.enqueue((function(){return Object(_.b)(r,void 0,void 0,(function(){var r;return Object(_.e)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Ql(t,n)];case 1:return o.sent(),[4,Jl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Mr.FAILED_PRECONDITION||t.code===Mr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function Qf(t){if(t.g_||t.y_)throw new Vr(Mr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Jf=function(t){function e(e,n,r,i,o,s){var u=this;return(u=t.call(this,e,n,r,i,s)||this).q_=e,u.H_=e,u.metadata=o,u}return Object(_.d)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this.K_){if(this.W_){var e=new Xf(this.q_,this.U_,this.Q_,this.K_,this.metadata,null);return this.W_.fromFirestore(e,t)}return this.U_.D_(this.K_.En(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this.K_){var n=this.K_.data().field(zf("DocumentSnapshot.get",t));if(null!==n)return this.U_.D_(n,e.serverTimestamps)}},e}(Ff),Xf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.d)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Jf),$f=function(){function t(t,e,n,r){this.q_=t,this.U_=e,this.J_=r,this.metadata=new gp(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.J_.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this.J_.docs.forEach((function(r){t.call(e,new Xf(n.q_,n.U_,r.key,r,new gp(n.J_.ee.has(r.key),n.J_.fromCache),n.query.W_))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this.J_.se)throw new Vr(Mr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Y_&&this.X_===e||(this.Y_=function(t,e){if(t.J_.te.W()){var n=0;return t.J_.docChanges.map((function(e){return{type:"added",doc:new Xf(t.q_,t.U_,e.doc.key,e.doc,new gp(t.J_.ee.has(e.doc.key),t.J_.fromCache),t.query.W_),oldIndex:-1,newIndex:n++}}))}var r=t.J_.te;return t.J_.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Xf(t.q_,t.U_,e.doc.key,e.doc,new gp(t.J_.ee.has(e.doc.key),t.J_.fromCache),t.query.W_),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Yf(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this.X_=e),this.Y_},t}();function Yf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Rr()}}function Hf(t,e){return t instanceof Jf&&e instanceof Jf?t.q_===e.q_&&t.Q_.isEqual(e.Q_)&&(null===t.K_?null===e.K_:t.K_.isEqual(e.K_))&&t.W_===e.W_:t instanceof $f&&e instanceof $f&&t.q_===e.q_&&El(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.J_.isEqual(e.J_)}var Zf=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(_.d)(e,t),e.prototype.x_=function(t){return new xf(t)},e.prototype.F_=function(t){var e=this.L_(t,this.firestore.A_);return new il(this.firestore,null,e)},e}(Vf);function tl(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=_f(t,il);var o=_f(t.firestore,Kf),s=Ol(o);return e instanceof Pf&&(e=e.o_),nl(o,("string"==typeof e||e instanceof Gf?kl(s,"updateDoc",t.Q_,e,n,r):Pl(s,"updateDoc",t.Q_,e)).tf(t.Q_,as.exists(!0)))}function el(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t instanceof Pf&&(t=t.o_);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||yu(i[u])||(s=i[u],u++);var a,c,h,f={includeMetadataChanges:s.includeMetadataChanges};if(yu(i[u])){var l=i[u];i[u]=null===(e=l.next)||void 0===e?void 0:e.bind(l),i[u+1]=null===(n=l.error)||void 0===n?void 0:n.bind(l),i[u+2]=null===(r=l.complete)||void 0===r?void 0:r.bind(l)}if(t instanceof il)c=_f(t.firestore,Kf),h=ks(t.Q_.path),a={next:function(e){i[u]&&i[u](rl(c,t,e))},error:i[u+1],complete:i[u+2]};else{var p=_f(t,ol);c=_f(p.firestore,Kf),h=p.Z_;var d=new Zf(c);a={next:function(t){i[u]&&i[u](new $f(c,d,p,t))},error:i[u+1],complete:i[u+2]},gl(t.Z_)}return function(t,e,n,r){var i=this,o=new df(r),s=new th(e,o,n);return t.di.Ri((function(){return Object(_.b)(i,void 0,void 0,(function(){var e;return Object(_.e)(this,(function(n){switch(n.label){case 0:return e=Xc,[4,ep(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))})),function(){o.r_(),t.di.Ri((function(){return Object(_.b)(i,void 0,void 0,(function(){var e;return Object(_.e)(this,(function(n){switch(n.label){case 0:return e=$c,[4,ep(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))}))}}(cp(c),h,f,a)}function nl(t,e){return function(t,e){var n=this,r=new du;return t.di.Ri((function(){return Object(_.b)(n,void 0,void 0,(function(){var n;return Object(_.e)(this,(function(i){switch(i.label){case 0:return n=Ih,[4,tp(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(cp(t),e)}function rl(t,e,n){var r=n.docs.get(e.Q_),i=new Zf(t);return new Jf(t,i,e.Q_,r,new gp(n.hasPendingWrites,n.fromCache),e.W_)}var il=function(){function t(t,e,n){this.W_=e,this.Q_=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"ef",{get:function(){return this.Q_.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.Q_.path.K()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this.Q_.path.J()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new bl(this.firestore,this.W_,this.Q_.path.q())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this.Q_)},t}(),ol=function(){function t(t,e,n){this.W_=e,this.Z_=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this.Z_)},t}(),sl=function(){};function ul(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o.nf(t)}return t}var al=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).sf=e,i.rf=n,i.cf=r,i.type="where",i}return Object(_.d)(e,t),e.prototype.nf=function(t){var e=Ol(t.firestore),n=function(t,e,n,r,i,o,s){var u;if(i.tt()){if("array-contains"===o||"array-contains-any"===o)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){vl(s,o);for(var a=[],c=0,h=s;c<h.length;c++)a.push(dl(r,t,h[c]));u={arrayValue:{values:a}}}else u=dl(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||vl(s,o),u=Cl(n,"where",s,"in"===o||"not-in"===o);var f=Qs.create(i,o,u);return function(t,e){if(e.An()){var n=Us(t);if(null!==n&&!n.isEqual(e.field))throw new Vr(Mr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Ls(t);null!==r&&yl(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Vr(Mr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(t.Z_,0,e,t.firestore.A_,this.sf,this.rf,this.cf);return new ol(t.firestore,t.W_,function(t,e){var n=t.filters.concat([e]);return new xs(t.path,t.collectionGroup,t.Tn.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t.Z_,n))},e}(sl),cl=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).sf=e,r.uf=n,r.type="orderBy",r}return Object(_.d)(e,t),e.prototype.nf=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new su(e,n);return function(t,e){if(null===Ls(t)){var n=Us(t);null!==n&&yl(0,n,e.field)}}(t,r),r}(t.Z_,this.sf,this.uf);return new ol(t.firestore,t.W_,function(t,e){var n=t.Tn.concat([e]);return new xs(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t.Z_,e))},e}(sl),hl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.af=n,i.hf=r,i}return Object(_.d)(e,t),e.prototype.nf=function(t){return new ol(t.firestore,t.W_,Fs(t.Z_,this.af,this.hf))},e}(sl),fl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.lf=n,i._f=r,i}return Object(_.d)(e,t),e.prototype.nf=function(t){var e=pl(t,this.type,this.lf,this._f);return new ol(t.firestore,t.W_,function(t,e){return new xs(t.path,t.collectionGroup,t.Tn.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t.Z_,e))},e}(sl),ll=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.lf=n,i._f=r,i}return Object(_.d)(e,t),e.prototype.nf=function(t){var e=pl(t,this.type,this.lf,this._f);return new ol(t.firestore,t.W_,function(t,e){return new xs(t.path,t.collectionGroup,t.Tn.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t.Z_,e))},e}(sl);function pl(t,e,n,r){if(n[0]instanceof Pf&&(n[0]=n[0].o_),n[0]instanceof Ff)return function(t,e,n,r,i){if(!r)throw new Vr(Mr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,u=Vs(t);s<u.length;s++){var a=u[s];if(a.field.tt())o.push(so(e,r.key));else{var c=r.field(a.field);if(Ji(c))throw new Vr(Mr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=a.field.J();throw new Vr(Mr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new nu(o,i)}(t.Z_,t.firestore.A_,e,n[0].K_,r);var i=Ol(t.firestore);return function(t,e,n,r,i,o){var s=t.Tn;if(i.length>s.length)throw new Vr(Mr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.tt()){if("string"!=typeof c)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Ms(t)&&-1!==c.indexOf("/"))throw new Vr(Mr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Zr.Y(c));if(!ni.ot(h))throw new Vr(Mr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new ni(h);u.push(so(e,f))}else{var l=Cl(n,r,c);u.push(l)}}return new nu(u,o)}(t.Z_,t.firestore.A_,i,e,n,r)}function dl(t,e,n){if(n instanceof Pf&&(n=n.o_),"string"==typeof n){if(""===n)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ms(e)&&-1!==n.indexOf("/"))throw new Vr(Mr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Zr.Y(n));if(!ni.ot(r))throw new Vr(Mr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return so(t,new ni(r))}if(n instanceof il)return so(t,n.Q_);throw new Vr(Mr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+wf(n)+".")}function vl(t,e){if(!Array.isArray(t)||0===t.length)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function yl(t,e,n){if(!n.isEqual(e))throw new Vr(Mr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function gl(t){if(Rs(t)&&0===t.Tn.length)throw new Vr(Mr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var bl=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,ks(r))||this).firestore=e,i.ef=r,i.type="collection",i}return Object(_.d)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.Z_.path.K()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.Z_.path.J()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.ef.q();return t.W()?null:new il(this.firestore,null,new ni(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this.ef)},e}(ol);function ml(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(t instanceof Pf&&(t=t.o_),vf("collection","path",e),t instanceof Rf){var i=Zr.Y.apply(Zr,Object(_.h)([e],n));return mf(i),new bl(t,null,i)}if(!(t instanceof il||t instanceof bl))throw new Vr(Mr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=Zr.Y.apply(Zr,Object(_.h)([t.path],n)).child(Zr.Y(e));return mf(o),new bl(t.firestore,null,o)}function wl(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(t instanceof Pf&&(t=t.o_),1===arguments.length&&(e=Wr.D()),vf("doc","path",e),t instanceof Rf){var i=Zr.Y.apply(Zr,Object(_.h)([e],n));return bf(i),new il(t,null,new ni(i))}if(!(t instanceof il||t instanceof bl))throw new Vr(Mr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=t.ef.child(Zr.Y.apply(Zr,Object(_.h)([e],n)));return bf(o),new il(t.firestore,t instanceof bl?t.W_:null,new ni(o))}var _l=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(_.d)(e,t),e.prototype.x_=function(t){return new xf(t)},e.prototype.F_=function(t){var e=this.L_(t,this.firestore.A_);return new il(this.firestore,null,e)},e}(Vf);function Il(t,e){return t instanceof Pf&&(t=t.o_),e instanceof Pf&&(e=e.o_),(t instanceof il||t instanceof bl)&&(e instanceof il||e instanceof bl)&&t.firestore===e.firestore&&t.path===e.path&&t.W_===e.W_}function El(t,e){return t instanceof Pf&&(t=t.o_),e instanceof Pf&&(e=e.o_),t instanceof ol&&e instanceof ol&&t.firestore===e.firestore&&Bs(t.Z_,e.Z_)&&t.W_===e.W_}function Ol(t){var e=t.b_(),n=vu(t.A_);return new Sl(t.A_,!!e.ignoreUndefinedProperties,n)}var Tl=/^__.*__$/,Al=function(){function t(t,e,n){this.data=t,this.en=e,this.fieldTransforms=n}return t.prototype.tf=function(t,e){var n=[];return n.push(null!==this.en?new gs(t,this.data,this.en,e):new ys(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new ms(t,this.fieldTransforms)),n},t}(),jl=function(){function t(t,e,n){this.data=t,this.en=e,this.fieldTransforms=n}return t.prototype.tf=function(t,e){var n=[new gs(t,this.data,this.en,e)];return this.fieldTransforms.length>0&&n.push(new ms(t,this.fieldTransforms)),n},t}();function Nl(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Rr()}}var Dl=function(){function t(t,e,n,r,i,o){this.settings=t,this.t=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ff(),this.fieldTransforms=i||[],this.en=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"u_",{get:function(){return this.settings.u_},enumerable:!1,configurable:!0}),t.prototype.df=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.t,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.en)},t.prototype.wf=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.df({path:n,l_:!1});return r.Ef(t),r},t.prototype.Tf=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.df({path:n,l_:!1});return r.ff(),r},t.prototype.If=function(t){return this.df({path:void 0,l_:!0})},t.prototype.a_=function(t){return Bl(t,this.settings.methodName,this.settings.mf||!1,this.path,this.settings.h_)},t.prototype.contains=function(t){return void 0!==this.en.find((function(e){return t.j(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.j(e.field)}))},t.prototype.ff=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Ef(this.path.get(t))},t.prototype.Ef=function(t){if(0===t.length)throw this.a_("Document fields must not be empty");if(Nl(this.u_)&&Tl.test(t))throw this.a_('Document fields cannot begin and end with "__"')},t}(),Sl=function(){function t(t,e,n){this.t=t,this.ignoreUndefinedProperties=e,this.serializer=n||vu(t)}return t.prototype.Af=function(t,e,n,r){return void 0===r&&(r=!1),new Dl({u_:t,methodName:e,h_:n,path:ei.X(),l_:!1,mf:r},this.t,this.serializer,this.ignoreUndefinedProperties)},t}();function xl(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Af(o.merge||o.mergeFields?2:0,e,n,i);Ml("Data must be an object, but it was:",s,r);var u,a,c=Ll(r,s);if(o.merge)u=new os(s.en),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=Vl(e,l[f],n);if(!s.contains(p))throw new Vr(Mr.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");zl(h,p)||h.push(p)}u=new os(h),a=s.fieldTransforms.filter((function(t){return u.un(t.field)}))}else u=null,a=s.fieldTransforms;return new Al(new Os(c),u,a)}function Pl(t,e,n,r){var i=t.Af(1,e,n);Ml("Data must be an object, but it was:",i,r);var o=[],s=new Ts;Wi(r,(function(t,r){var u=Fl(e,t,n);r instanceof Pf&&(r=r.o_);var a=i.Tf(u);if(r instanceof Of)o.push(u);else{var c=Rl(r,a);null!=c&&(o.push(u),s.set(u,c))}}));var u=new os(o);return new jl(s.hn(),u,i.fieldTransforms)}function kl(t,e,n,r,i,o){var s=t.Af(1,e,n),u=[Vl(e,r,n)],a=[i];if(o.length%2!=0)throw new Vr(Mr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(Vl(e,o[c])),a.push(o[c+1]);for(var h=[],f=new Ts,l=u.length-1;l>=0;--l)if(!zl(h,u[l])){var p=u[l],d=a[l];d instanceof Pf&&(d=d.o_);var v=s.Tf(p);if(d instanceof Of)h.push(p);else{var y=Rl(d,v);null!=y&&(h.push(p),f.set(p,y))}}var g=new os(h);return new jl(f.hn(),g,s.fieldTransforms)}function Cl(t,e,n,r){return void 0===r&&(r=!1),Rl(n,t.Af(r?4:3,e))}function Rl(t,e){if(t instanceof Pf&&(t=t.o_),Ul(t))return Ml("Unsupported field value:",e,t),Ll(t,e);if(t instanceof Ef)return function(t,e){if(!Nl(e.u_))throw e.a_(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.a_(t._methodName+"() is not currently supported inside arrays");var n=t.c_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.en.push(e.path),t instanceof Array){if(e.settings.l_&&4!==e.u_)throw e.a_("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Rl(o[i],e.If(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof Pf&&(t=t.o_),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return bo(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=$r.fromDate(t);return{timestampValue:mo(e.serializer,n)}}if(t instanceof $r){var r=new $r(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:mo(e.serializer,r)}}if(t instanceof Sf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof xf)return{bytesValue:wo(e.serializer,t.E_)};if(t instanceof il){var i=e.t,o=t.firestore.A_;if(!o.isEqual(i))throw e.a_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:Eo(t.firestore.A_||e.t,t.Q_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.a_("Unsupported field value: "+wf(t))}(t,e)}function Ll(t,e){var n={};return Qi(t)?e.path&&e.path.length>0&&e.en.push(e.path):Wi(t,(function(t,r){var i=Rl(r,e.wf(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Ul(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof $r||t instanceof Sf||t instanceof xf||t instanceof il||t instanceof Ef)}function Ml(t,e,n){if(!Ul(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=wf(n);throw e.a_("an object"===r?t+" a custom object":t+" "+r)}}function Vl(t,e,n){if(e instanceof Pf&&(e=e.o_),e instanceof Gf)return e.j_;if("string"==typeof e)return Fl(t,e);throw Bl("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var ql=new RegExp("[~\\*/\\[\\]]");function Fl(t,e,n){if(e.search(ql)>=0)throw Bl("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Gf.bind.apply(Gf,Object(_.h)([void 0],e.split("."))))).j_}catch(r){throw Bl("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Bl(t,e,n,r,i){var o=r&&!r.W(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new Vr(Mr.INVALID_ARGUMENT,(u+=". ")+t+a)}function zl(t,e){return t.some((function(t){return t.isEqual(e)}))}var Gl=function(){function t(t){this.Mu=t,this.Rf=new Map,this.mutations=[],this.Pf=!1,this.gf=null,this.yf=new Set}return t.prototype.Vf=function(t){return Object(_.b)(this,void 0,void 0,(function(){var e,n=this;return Object(_.e)(this,(function(r){switch(r.label){case 0:if(this.pf(),this.mutations.length>0)throw new Vr(Mr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i,o,s,u;return Object(_.e)(this,(function(a){switch(a.label){case 0:return n=Ur(t),r=Do(n.serializer)+"/documents",i={documents:e.map((function(t){return To(n.serializer,t)}))},[4,n.Vu("BatchGetDocuments",r,i)];case 1:return o=a.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){Lr(!!e.found);var n=Ao(t,e.found.name),r=Io(e.found.updateTime),i=new Os({mapValue:{fields:e.found.fields}});return new Ns(n,r,i,{})}(t,e):"missing"in e?function(t,e){Lr(!!e.missing),Lr(!!e.readTime);var n=Ao(t,e.missing),r=Io(e.readTime);return new Ds(n,r)}(t,e):Rr()}(n.serializer,t);s.set(e.key.toString(),e)})),u=[],[2,(e.forEach((function(t){var e=s.get(t.toString());Lr(!!e),u.push(e)})),u)]}}))}))}(this.Mu,t)];case 1:return[2,((e=r.sent()).forEach((function(t){t instanceof Ds||t instanceof Ns?n.vf(t):Rr()})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.tf(t,this.rn(t))),this.yf.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.tf(t,this.bf(t)))}catch(t){this.gf=t}this.yf.add(t.toString())},t.prototype.delete=function(t){this.write([new Is(t,this.rn(t))]),this.yf.add(t.toString())},t.prototype.commit=function(){return Object(_.b)(this,void 0,void 0,(function(){var t,e=this;return Object(_.e)(this,(function(n){switch(n.label){case 0:if(this.pf(),this.gf)throw this.gf;return t=this.Rf,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=ni.st(n);e.mutations.push(new Es(r,e.rn(r)))})),[4,function(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r,i;return Object(_.e)(this,(function(o){switch(o.label){case 0:return n=Ur(t),r=Do(n.serializer)+"/documents",i={writes:e.map((function(t){return Po(n.serializer,t)}))},[4,n.yu("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.Mu,this.mutations)];case 1:return n.sent(),this.Pf=!0,[2]}}))}))},t.prototype.vf=function(t){var e;if(t instanceof Ns)e=t.version;else{if(!(t instanceof Ds))throw Rr();e=Yr.min()}var n=this.Rf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Vr(Mr.ABORTED,"Document version changed between two reads.")}else this.Rf.set(t.key.toString(),e)},t.prototype.rn=function(t){var e=this.Rf.get(t.toString());return!this.yf.has(t.toString())&&e?as.updateTime(e):as.on()},t.prototype.bf=function(t){var e=this.Rf.get(t.toString());if(!this.yf.has(t.toString())&&e){if(e.isEqual(Yr.min()))throw new Vr(Mr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return as.updateTime(e)}return as.exists(!0)},t.prototype.write=function(t){this.pf(),this.mutations=this.mutations.concat(t)},t.prototype.pf=function(){},t}(),Kl=function(){function t(t,e,n,r){this.di=t,this.Mu=e,this.updateFunction=n,this.Ti=r,this.Sf=5,this.Si=new Iu(this.di,"transaction_retry")}return t.prototype.run=function(){this.Df()},t.prototype.Df=function(){var t=this;this.Si.Bs((function(){return Object(_.b)(t,void 0,void 0,(function(){var t,e,n=this;return Object(_.e)(this,(function(r){return t=new Gl(this.Mu),(e=this.Cf(t))&&e.then((function(e){n.di.Ri((function(){return t.commit().then((function(){n.Ti.resolve(e)})).catch((function(t){n.Nf(t)}))}))})).catch((function(t){n.Nf(t)})),[2]}))}))}))},t.prototype.Cf=function(t){try{var e=this.updateFunction(t);return!ri(e)&&e.catch&&e.then?e:(this.Ti.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Ti.reject(t),null}},t.prototype.Nf=function(t){var e=this;this.Sf>0&&this.xf(t)?(this.Sf-=1,this.di.Ri((function(){return e.Df(),Promise.resolve()}))):this.Ti.reject(t)},t.prototype.xf=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!yi(e)}return!1},t}(),Wl=function(){function t(t,e,n){var r=this;this.credentials=t,this.di=e,this.Fl=n,this.user=Nr.UNAUTHENTICATED,this.clientId=Wr.D(),this.Ff=function(){},this.g=new du,this.credentials.A((function(t){xr("FirestoreClient","Received user=",t.uid),r.user.isEqual(t)||(r.user=t,r.Ff(t)),r.g.resolve()}))}return t.prototype.getConfiguration=function(){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(t){switch(t.label){case 0:return[4,this.g.promise];case 1:return[2,(t.sent(),{di:this.di,Fl:this.Fl,clientId:this.clientId,credentials:this.credentials,Yl:this.user,qh:100})]}}))}))},t.prototype.Of=function(t){var e=this;this.Ff=t,this.g.promise.then((function(){return e.Ff(e.user)}))},t.prototype.Mf=function(){if(this.di.Ci)throw new Vr(Mr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.di.Oi();var e=new du;return this.di.Ni((function(){return Object(_.b)(t,void 0,void 0,(function(){var t,n;return Object(_.e)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.kf?[4,this.kf.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.$f?[4,this.$f.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.R(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Lu(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function Ql(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r=this;return Object(_.e)(this,(function(i){switch(i.label){case 0:return t.di.Li(),xr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=i.sent(),[4,e.initialize(n)];case 2:return i.sent(),t.Of((function(n){return t.di.Mi((function(){return Object(_.b)(r,void 0,void 0,(function(){return Object(_.e)(this,(function(t){switch(t.label){case 0:return[4,ic(e.Ou,n)];case 1:return t.sent(),[2]}}))}))}))})),e.persistence.rc((function(){return t.terminate()})),t.$f=e,[2]}}))}))}function Jl(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r;return Object(_.e)(this,(function(i){switch(i.label){case 0:return t.di.Li(),[4,Xl(t)];case 1:return n=i.sent(),xr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.Of((function(n){return t.di.Mi((function(){return function(t,e){return Object(_.b)(this,void 0,void 0,(function(){var n,r;return Object(_.e)(this,(function(i){switch(i.label){case 0:return(n=Ur(t)).di.Li(),xr("RemoteStore","RemoteStore received new credentials"),r=Sc(n),n.Bu.add(3),[4,Ec(n)];case 1:return i.sent(),r&&n.Ku.set("Unknown"),[4,n.ku.s_(e)];case 2:return i.sent(),n.Bu.delete(3),[4,Ic(n)];case 3:return i.sent(),[2]}}))}))}(e.$h,n)}))})),t.kf=e,[2]}}))}))}function Xl(t){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(e){switch(e.label){case 0:return t.$f?[3,2]:(xr("FirestoreClient","Using default OfflineComponentProvider"),[4,Ql(t,new hf)]);case 1:e.sent(),e.label=2;case 2:return[2,t.$f]}}))}))}function $l(t){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(e){switch(e.label){case 0:return t.kf?[3,2]:(xr("FirestoreClient","Using default OnlineComponentProvider"),[4,Jl(t,new pf)]);case 1:e.sent(),e.label=2;case 2:return[2,t.kf]}}))}))}function Yl(t){return Xl(t).then((function(t){return t.persistence}))}function Hl(t){return Xl(t).then((function(t){return t.Ou}))}function Zl(t){return $l(t).then((function(t){return t.$h}))}function tp(t){return $l(t).then((function(t){return t.va}))}function ep(t){return Object(_.b)(this,void 0,void 0,(function(){var e,n;return Object(_.e)(this,(function(r){switch(r.label){case 0:return[4,$l(t)];case 1:return e=r.sent(),[2,((n=e.Lh).ta=mh.bind(null,e.va),n.sa=_h.bind(null,e.va),n)]}}))}))}function np(t,e,n){var r=this;void 0===n&&(n={});var i=new du;return t.di.Ri((function(){return Object(_.b)(r,void 0,void 0,(function(){var r;return Object(_.e)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new df({next:function(o){e.Ri((function(){return $c(t,s)}));var u=o.docs.has(n);!u&&o.fromCache?i.reject(new Vr(Mr.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&o.fromCache&&r&&"server"===r.source?i.reject(new Vr(Mr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new th(ks(n.path),o,{includeMetadataChanges:!0,ha:!0});return Xc(t,s)},[4,ep(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.di,e,n,i])]}}))}))})),i.promise}function rp(t,e,n){var r=this;void 0===n&&(n={});var i=new du;return t.di.Ri((function(){return Object(_.b)(r,void 0,void 0,(function(){var r;return Object(_.e)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new df({next:function(n){e.Ri((function(){return $c(t,s)})),n.fromCache&&"server"===r.source?i.reject(new Vr(Mr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new th(n,o,{includeMetadataChanges:!0,ha:!0});return Xc(t,s)},[4,ep(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.di,e,n,i])]}}))}))})),i.promise}var ip=function(){function t(t,e){this.q_=t,this.Lf=e,this.Bf=[],this.qf=!1,this.Uf=Ol(t)}return t.prototype.set=function(t,e,n){this.Qf();var r=op(t,this.q_),i=Tp(r.W_,e,n),o=xl(this.Uf,"WriteBatch.set",r.Q_,i,null!==r.W_,n);return this.Bf=this.Bf.concat(o.tf(r.Q_,as.on())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this.Qf();var o,s=op(t,this.q_);return e instanceof Pf&&(e=e.o_),o="string"==typeof e||e instanceof Gf?kl(this.Uf,"WriteBatch.update",s.Q_,e,n,r):Pl(this.Uf,"WriteBatch.update",s.Q_,e),this.Bf=this.Bf.concat(o.tf(s.Q_,as.exists(!0))),this},t.prototype.delete=function(t){this.Qf();var e=op(t,this.q_);return this.Bf=this.Bf.concat(new Is(e.Q_,as.on())),this},t.prototype.commit=function(){return this.Qf(),this.qf=!0,this.Bf.length>0?this.Lf(this.Bf):Promise.resolve()},t.prototype.Qf=function(){if(this.qf)throw new Vr(Mr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function op(t,e){if(t instanceof Pf&&(t=t.o_),t.firestore!==e)throw new Vr(Mr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var sp=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).q_=e,r}return Object(_.d)(e,t),e.prototype.get=function(e){var n=this,r=op(e,this.q_),i=new Zf(this.q_);return t.prototype.get.call(this,e).then((function(t){return new Jf(n.q_,i,r.Q_,t.K_,new gp(!1,!1),r.W_)}))},e}(function(){function t(t,e){this.q_=t,this.Kf=e,this.Uf=Ol(t)}return t.prototype.get=function(t){var e=this,n=op(t,this.q_),r=new _l(this.q_);return this.Kf.Vf([n.Q_]).then((function(t){if(!t||1!==t.length)return Rr();var i=t[0];if(i instanceof Ds)return new Ff(e.q_,r,n.Q_,null,n.W_);if(i instanceof Ns)return new Ff(e.q_,r,i.key,i,n.W_);throw Rr()}))},t.prototype.set=function(t,e,n){var r=op(t,this.q_),i=Tp(r.W_,e,n),o=xl(this.Uf,"Transaction.set",r.Q_,i,null!==r.W_,n);return this.Kf.set(r.Q_,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=op(t,this.q_);return e instanceof Pf&&(e=e.o_),o="string"==typeof e||e instanceof Gf?kl(this.Uf,"Transaction.update",s.Q_,e,n,r):Pl(this.Uf,"Transaction.update",s.Q_,e),this.Kf.update(s.Q_,o),this},t.prototype.delete=function(t){var e=op(t,this.q_);return this.Kf.delete(e.Q_),this},t}()),up=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Qf(t=_f(t,Kf));var n=cp(t),r=t.b_(),i=new pf;return Wf(n,i,new ff(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t.o_,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Qf(t=_f(t,Kf));var e=cp(t),n=t.b_(),r=new pf;return Wf(e,r,new lf(r,n.cacheSizeBytes))}(t.o_)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t.g_&&!t.y_)throw new Vr(Mr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new du;return t.G_.Ni((function(){return Object(_.b)(e,void 0,void 0,(function(){var e;return Object(_.e)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(_.b)(this,void 0,void 0,(function(){return Object(_.e)(this,(function(e){switch(e.label){case 0:return Eu.Gs()?[4,Eu.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}}))}))}(ec(t.A_,t.T_))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t.o_)},t}(),ap=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n)||this).Wf=r,i.INTERNAL={delete:function(){return i.terminate()}},e instanceof jr||(i.jf=e),i}return Object(_.d)(e,t),Object.defineProperty(e.prototype,"A_",{get:function(){return this.o_.A_},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this.o_.v_()),t)).merge,this.o_.p_(t)},e.prototype.useEmulator=function(t,e){"firestore.googleapis.com"!==this.o_.v_().host&&kr("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:t+":"+e,ssl:!1,merge:!0})},e.prototype.enableNetwork=function(){return function(t){var e=this;return t.di.enqueue((function(){return Object(_.b)(e,void 0,void 0,(function(){var e,n;return Object(_.e)(this,(function(r){switch(r.label){case 0:return[4,Yl(t)];case 1:return e=r.sent(),[4,Zl(t)];case 2:return n=r.sent(),[2,(e.oc(!0),function(t){var e=Ur(t);return e.Bu.delete(0),Ic(e)}(n))]}}))}))}))}(cp(_f(this.o_,Kf)))},e.prototype.disableNetwork=function(){return function(t){var e=this;return t.di.enqueue((function(){return Object(_.b)(e,void 0,void 0,(function(){var e,n;return Object(_.e)(this,(function(r){switch(r.label){case 0:return[4,Yl(t)];case 1:return e=r.sent(),[4,Zl(t)];case 2:return n=r.sent(),[2,(e.oc(!1),function(t){return Object(_.b)(this,void 0,void 0,(function(){var e;return Object(_.e)(this,(function(n){switch(n.label){case 0:return(e=Ur(t)).Bu.add(0),[4,Ec(e)];case 1:return n.sent(),e.Ku.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(cp(_f(this.o_,Kf)))},e.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&gf("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Wf.enableMultiTabIndexedDbPersistence(this):this.Wf.enableIndexedDbPersistence(this,n)},e.prototype.clearPersistence=function(){return this.Wf.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.app._removeServiceInstance("firestore-exp"),this.o_._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new du;return t.di.Ri((function(){return Object(_.b)(e,void 0,void 0,(function(){var e;return Object(_.e)(this,(function(r){switch(r.label){case 0:return e=Nh,[4,tp(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(cp(_f(this.o_,Kf)))},e.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new df(e);return t.di.Ri((function(){return Object(_.b)(n,void 0,void 0,(function(){var e;return Object(_.e)(this,(function(n){switch(n.label){case 0:return e=function(t,e){Ur(t).Zu.add(e),e.next()},[4,ep(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.r_(),t.di.Ri((function(){return Object(_.b)(n,void 0,void 0,(function(){var e;return Object(_.e)(this,(function(n){switch(n.label){case 0:return e=function(t,e){Ur(t).Zu.delete(e)},[4,ep(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(cp(t=_f(t,Kf)),yu(e)?e:{next:e})}(this.o_,t)},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.jf)throw new Vr(Mr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.jf},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new Ep(this,ml(this.o_,t))}catch(t){throw dp(t,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new pp(this,wl(this.o_,t))}catch(t){throw dp(t,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new wp(this,function(t,e){if(t=_f(t,Rf),vf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ol(t,null,function(t){return new xs(Zr.X(),t)}(e))}(this.o_,t))}catch(t){throw dp(t,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new du;return t.di.Ri((function(){return Object(_.b)(n,void 0,void 0,(function(){var n;return Object(_.e)(this,(function(i){switch(i.label){case 0:return[4,function(t){return $l(t).then((function(t){return t.Mu}))}(t)];case 1:return n=i.sent(),new Kl(t.di,n,e,r).run(),[2]}}))}))})),r.promise}(cp(t),(function(n){return e(new sp(t,n))}))}(this.o_,(function(n){return t(new fp(e,n))}))},e.prototype.batch=function(){var t=this;return cp(this.o_),new lp(new ip(this.o_,(function(e){return nl(t.o_,e)})))},e}(Pf);function cp(t){return t.z_||hp(t),t.z_.Mf(),t.z_}function hp(t){var e=t.b_(),n=function(t,e,n){return new Ar(t,e,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling)}(t.A_,t.T_,e);t.z_=new Wl(t.R_,t.G_,n)}var fp=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).q_=e,r}return Object(_.d)(e,t),e.prototype.get=function(t){var e=this,n=Op(t);return this.o_.get(n).then((function(t){return new bp(e.q_,t)}))},e.prototype.set=function(t,e,n){var r=Op(t);return n?(yf("Transaction.set",n),this.o_.set(r,e,n)):this.o_.set(r,e),this},e.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Op(t);return 2===arguments.length?this.o_.update(s,e):(r=this.o_).update.apply(r,Object(_.h)([s,e,n],i)),this},e.prototype.delete=function(t){var e=Op(t);return this.o_.delete(e),this},e}(Pf),lp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.d)(e,t),e.prototype.set=function(t,e,n){var r=Op(t);return n?(yf("WriteBatch.set",n),this.o_.set(r,e,n)):this.o_.set(r,e),this},e.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Op(t);return 2===arguments.length?this.o_.update(s,e):(r=this.o_).update.apply(r,Object(_.h)([s,e,n],i)),this},e.prototype.delete=function(t){var e=Op(t);return this.o_.delete(e),this},e.prototype.commit=function(){return this.o_.commit()},e}(Pf),pp=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r.U_=new qf(e),r}return Object(_.d)(e,t),e.Gf=function(t,n,r){if(t.length%2!=0)throw new Vr(Mr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.J()+" has "+t.length);return new e(n,new il(n.o_,r,new ni(t)))},e.B_=function(t,n,r){return new e(n,new il(n.o_,r,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this.o_.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new Ep(this.firestore,this.o_.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.o_.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new Ep(this.firestore,ml(this.o_,t))}catch(t){throw dp(t,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return t instanceof Pf&&(t=t.o_),t instanceof il&&Il(this.o_,t)},e.prototype.set=function(t,e){e=yf("DocumentReference.set",e);try{return function(t,e,n){t=_f(t,il);var r=_f(t.firestore,Kf),i=Tp(t.W_,e,n);return nl(r,xl(Ol(r),"setDoc",t.Q_,i,null!==t.W_,n).tf(t.Q_,as.on()))}(this.o_,t,e)}catch(t){throw dp(t,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?tl(this.o_,t):tl.apply(void 0,Object(_.h)([this.o_,t,e],n))}catch(t){throw dp(t,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return nl(_f((t=this.o_).firestore,Kf),[new Is(t.Q_,as.on())]);var t},e.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=vp(e),i=yp(e,(function(e){return new bp(t.firestore,new Jf(t.firestore.o_,t.U_,e.Q_,e.K_,e.metadata,t.o_.W_))}));return el(this.o_,r,i)},e.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=_f(t,il);var e=_f(t.firestore,Kf),n=cp(e),r=new Zf(e);return function(t,e){var n=this,r=new du;return t.di.Ri((function(){return Object(_.b)(n,void 0,void 0,(function(){var n;return Object(_.e)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(_.b)(this,void 0,void 0,(function(){var r,i,o;return Object(_.e)(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,function(t,e){var n=Ur(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Bc.cs(t,e)}))}(t,e)];case 1:return(r=s.sent())instanceof Ns?n.resolve(r):r instanceof Ds?n.resolve(null):n.reject(new Vr(Mr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return i=s.sent(),o=Lu(i,"Failed to get document '"+e+" from cache"),n.reject(o),[3,3];case 3:return[2]}}))}))},[4,Hl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t.Q_).then((function(n){return new Jf(e,r,t.Q_,n,new gp(n instanceof Ns&&n.an,!0),t.W_)}))}(this.o_):"server"===(null==t?void 0:t.source)?function(t){t=_f(t,il);var e=_f(t.firestore,Kf);return np(cp(e),t.Q_,{source:"server"}).then((function(n){return rl(e,t,n)}))}(this.o_):function(t){t=_f(t,il);var e=_f(t.firestore,Kf);return np(cp(e),t.Q_).then((function(n){return rl(e,t,n)}))}(this.o_)).then((function(t){return new bp(e.firestore,new Jf(e.firestore.o_,e.U_,t.Q_,t.K_,t.metadata,e.o_.W_))}))},e.prototype.withConverter=function(t){return new e(this.firestore,this.o_.withConverter(t))},e}(Pf);function dp(t,e,n){return t.message=t.message.replace(e,n),t}function vp(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!yu(r))return r}return{}}function yp(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=yu(t[0])?t[0]:yu(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var gp=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),bp=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).q_=e,r}return Object(_.d)(e,t),Object.defineProperty(e.prototype,"ref",{get:function(){return new pp(this.q_,this.o_.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.o_.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.o_.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this.o_.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this.o_.data(t)},e.prototype.get=function(t,e){return this.o_.get(t,e)},e.prototype.isEqual=function(t){return Hf(this.o_,t.o_)},e}(Pf),mp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.d)(e,t),e.prototype.data=function(t){return this.o_.data(t)},e}(bp),wp=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r.U_=new qf(e),r}return Object(_.d)(e,t),e.prototype.where=function(t,n,r){try{return new e(this.firestore,ul(this.o_,function(t,e,n){var r=e,i=zf("where",t);return new al(i,r,n)}(t,n,r)))}catch(t){throw dp(t,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.orderBy=function(t,n){try{return new e(this.firestore,ul(this.o_,function(t,e){void 0===e&&(e="asc");var n=e,r=zf("orderBy",t);return new cl(r,n)}(t,n)))}catch(t){throw dp(t,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,ul(this.o_,function(t){return If("limit",t),new hl("limit",t,"F")}(t)))}catch(t){throw dp(t,"limit()","Query.limit()")}},e.prototype.limitToLast=function(t){try{return new e(this.firestore,ul(this.o_,function(t){return If("limitToLast",t),new hl("limitToLast",t,"L")}(t)))}catch(t){throw dp(t,"limitToLast()","Query.limitToLast()")}},e.prototype.startAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ul(this.o_,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new fl("startAt",t,!0)}).apply(void 0,t)))}catch(t){throw dp(t,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ul(this.o_,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new fl("startAfter",t,!1)}).apply(void 0,t)))}catch(t){throw dp(t,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ul(this.o_,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ll("endBefore",t,!0)}).apply(void 0,t)))}catch(t){throw dp(t,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ul(this.o_,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ll("endAt",t,!1)}).apply(void 0,t)))}catch(t){throw dp(t,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return El(this.o_,t.o_)},e.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=_f(t,ol);var e=_f(t.firestore,Kf),n=cp(e),r=new Zf(e);return function(t,e){var n=this,r=new du;return t.di.Ri((function(){return Object(_.b)(n,void 0,void 0,(function(){var n;return Object(_.e)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(_.b)(this,void 0,void 0,(function(){var r,i,o,s,u,a;return Object(_.e)(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,fc(t,e,!0)];case 1:return r=c.sent(),i=new vh(e,r.Kc),o=i.bh(r.documents),s=i.Zn(o,!1),n.resolve(s.snapshot),[3,3];case 2:return u=c.sent(),a=Lu(u,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}}))}))},[4,Hl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t.Z_).then((function(n){return new $f(e,r,t,n)}))}(this.o_):"server"===(null==t?void 0:t.source)?function(t){t=_f(t,ol);var e=_f(t.firestore,Kf),n=cp(e),r=new Zf(e);return rp(n,t.Z_,{source:"server"}).then((function(n){return new $f(e,r,t,n)}))}(this.o_):function(t){t=_f(t,ol);var e=_f(t.firestore,Kf),n=cp(e),r=new Zf(e);return gl(t.Z_),rp(n,t.Z_).then((function(n){return new $f(e,r,t,n)}))}(this.o_)).then((function(t){return new Ip(e.firestore,new $f(e.firestore.o_,e.U_,e.o_,t.J_))}))},e.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=vp(e),i=yp(e,(function(e){return new Ip(t.firestore,new $f(t.firestore.o_,t.U_,t.o_,e.J_))}));return el(this.o_,r,i)},e.prototype.withConverter=function(t){return new e(this.firestore,this.o_.withConverter(t))},e}(Pf),_p=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).q_=e,r}return Object(_.d)(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this.o_.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new mp(this.q_,this.o_.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this.o_.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this.o_.newIndex},enumerable:!1,configurable:!0}),e}(Pf),Ip=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).q_=e,r}return Object(_.d)(e,t),Object.defineProperty(e.prototype,"query",{get:function(){return new wp(this.q_,this.o_.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.o_.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.o_.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this.o_.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this.o_.docs.map((function(e){return new mp(t.q_,e)}))},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var e=this;return this.o_.docChanges(t).map((function(t){return new _p(e.q_,t)}))},e.prototype.forEach=function(t,e){var n=this;this.o_.forEach((function(r){t.call(e,new mp(n.q_,r))}))},e.prototype.isEqual=function(t){return Hf(this.o_,t.o_)},e}(Pf),Ep=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r.o_=n,r}return Object(_.d)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.o_.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.o_.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.o_.parent;return t?new pp(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new pp(this.firestore,void 0===t?wl(this.o_):wl(this.o_,t))}catch(t){throw dp(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=_f(t.firestore,Kf),r=wl(t),i=Tp(t.W_,e);return nl(n,xl(Ol(t.firestore),"addDoc",r.Q_,i,null!==t.W_,{}).tf(r.Q_,as.exists(!1))).then((function(){return r}))}(this.o_,t).then((function(t){return new pp(e.firestore,t)}))},e.prototype.isEqual=function(t){return Il(this.o_,t.o_)},e.prototype.withConverter=function(t){return new e(this.firestore,this.o_.withConverter(t))},e}(wp);function Op(t){return t instanceof Pf&&(t=t.o_),_f(t,il)}function Tp(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Ap,jp=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,new(Gf.bind.apply(Gf,Object(_.h)([void 0],e))))||this}return Object(_.d)(e,t),e.documentId=function(){return new e(ei.et().J())},e.prototype.isEqual=function(t){return t instanceof Pf&&(t=t.o_),t instanceof Gf&&this.o_.j_.isEqual(t.j_)},e}(Pf),Np=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(_.d)(e,t),e.serverTimestamp=function(){var t=new Af("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new Of("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jf("arrayUnion",t)}).apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Nf("arrayRemove",t)}).apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new e(r)},e.increment=function(t){var n=function(t){return new Df("increment",t)}(t);return n._methodName="FieldValue.increment",new e(n)},e.prototype.isEqual=function(t){return this.o_.isEqual(t.o_)},e}(Pf),Dp={Firestore:ap,GeoPoint:Sf,Timestamp:$r,Blob:Mf,Transaction:fp,WriteBatch:lp,DocumentReference:pp,DocumentSnapshot:bp,Query:wp,QueryDocumentSnapshot:mp,QuerySnapshot:Ip,CollectionReference:Ep,FieldPath:jp,FieldValue:Np,setLogLevel:function(t){Dr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new Tr.a("firestore",(function(t){return function(t,e){return new ap(t,new Kf(t,e),new up)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Dp)))})(Ap=I.a),Ap.registerVersion("@firebase/firestore","2.0.5");var Sp=n("UbJi");function xp(t,e){return function(t,e=i.a){return new o.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function Pp(t,e){return xp(t,e).pipe(Object(p.a)(t=>({payload:t,type:"query"})))}function kp(t,e){return Pp(t,e).pipe(Object(a.a)(void 0),h(),Object(p.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function Cp(t,e,n){return kp(t,n).pipe(Object(d.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return Rp(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return Rp(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Rp(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),Object(v.a)(),Object(p.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function Rp(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function Lp(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class Up{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=kp(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(p.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(a.a)(void 0),h(),Object(y.a)(([t,e])=>e.length>0||!t),Object(p.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(d.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Lp(t);return Cp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Pp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(p.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(s.a)(this.query.get(t)).pipe(Object(g.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new Mp(this.ref.doc(t),this.afs)}}class Mp{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=Gp(n,e);return new Up(r,i,this.afs)}snapshotChanges(){return xp(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(a.a)(void 0),h(),Object(p.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(p.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(s.a)(this.ref.get(t)).pipe(Object(g.b)(this.afs.schedulers.insideAngular))}}class Vp{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?kp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(p.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(y.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):kp(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(d.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Lp(t);return Cp(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Pp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(p.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(s.a)(this.query.get(t)).pipe(Object(g.b)(this.afs.schedulers.insideAngular))}}const qp=new r.q("angularfire2.enableFirestorePersistence"),Fp=new r.q("angularfire2.firestore.persistenceSettings"),Bp=new r.q("angularfire2.firestore.settings"),zp=new r.q("angularfire2.firestore.use-emulator");function Gp(t,e=(t=>t)){return{query:e(t),ref:t}}let Kp=(()=>{class t{constructor(t,e,n,r,i,o,a,c,h){this.schedulers=new b.d(o),this.keepUnstableUntilFirst=Object(b.h)(this.schedulers);const f=Object(b.g)(t,o,e);!w.a.auth&&h&&Object(b.j)();const l=c;[this.firestore,this.persistenceEnabled$]=Object(b.f)(f.name+".firestore","AngularFirestore",f,()=>{const t=o.runOutsideAngular(()=>f.firestore());if(r&&t.settings(r),l&&t.useEmulator(...l),n&&!Object(m.n)(i)){const e=()=>{try{return Object(s.a)(t.enablePersistence(a||void 0).then(()=>!0,()=>!1))}catch(e){return"undefined"!=typeof console&&console.warn(e),Object(u.a)(!1)}};return[t,o.runOutsideAngular(e)]}return[t,Object(u.a)(!1)]},[r,l,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=Gp(n,e),o=this.schedulers.ngZone.run(()=>r);return new Up(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new Vp(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new Mp(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(r.Pb(b.c),r.Pb(b.b,8),r.Pb(qp,8),r.Pb(Bp,8),r.Pb(r.B),r.Pb(r.z),r.Pb(Fp,8),r.Pb(zp,8),r.Pb(Sp.c,8))},t.\u0275prov=Object(r.Eb)({factory:function(){return new t(Object(r.Pb)(b.c),Object(r.Pb)(b.b,8),Object(r.Pb)(qp,8),Object(r.Pb)(Bp,8),Object(r.Pb)(r.B),Object(r.Pb)(r.z),Object(r.Pb)(Fp,8),Object(r.Pb)(zp,8),Object(r.Pb)(Sp.c,8))},token:t,providedIn:"any"}),t})()},tB1I:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n("Jgta"),i=n("fXoL"),o=n("I/3d"),s=n("UbJi"),u=n("tyNb"),a=n("Vaw3");let c=(()=>{class t{constructor(t,e,n,r){this.firestore=t,this.firebaseAuth=e,this.router=n,this.firestorage=r,this.userAuthInfo=[],this.user=[],this.username="",this.accountsArray=[],this.profileFile={},this.storageRef={},this.sendFileTaskObject={},this.newProfileFile={},this.newDisplayName="",this.creepDetailsArray=[],this.editDisplayName="",this.indivFireData=[],this.editDescription="",this.editLooking=""}login(t){console.log(t),r.a.auth().signOut(),this.userAuthInfo=t,r.a.auth().signInWithEmailAndPassword(this.userAuthInfo[0],this.userAuthInfo[1]).catch(t=>{var e=t.message;"auth/weak-password"==t.code?alert("the Password is too weak"):alert(e),console.log(t)}),this.firebaseAuth.onAuthStateChanged(t=>{t&&(console.log(t),this.user=t,this.router.navigate(["/browse"]))})}logout(){r.a.auth().signOut(),this.router.navigate(["/home"])}registerUser(t){r.a.auth().signOut(),this.userAuthInfo=t,console.log(this.userAuthInfo[0],this.userAuthInfo[1]),this.username=this.userAuthInfo[0].slice(0,this.userAuthInfo[0].lastIndexOf("@")),r.a.auth().createUserWithEmailAndPassword(this.userAuthInfo[0],this.userAuthInfo[1]).catch(t=>{var e=t.message;"auth/weak-password"==t.code?alert("the Password is too weak"):alert(e),console.log(t)}),this.firebaseAuth.onAuthStateChanged(t=>{t&&(console.log("REGISTERED SUCCESSFUL:",t),this.router.navigate(["/next"]),this.firestore.collection("ionTennisUsers").doc(t.uid).set({uid:t.uid,email:this.userAuthInfo[0],userName:this.username}).then(()=>{console.log("uid: "+t.uid+"was saved in the firestore, thanks"),alert("uid: "+t.uid+", And UserName: "+this.username+" was saved in the firestore, thanks \u{1f60e}")}),t.providerData.forEach((function(t){console.log("Sign-in provider: "+t.providerId),console.log("  Provider-specific UID: "+t.uid),console.log("  Name: "+t.displayName),console.log("  Email: "+t.email),console.log(t.email),console.log("  Photo URL: "+t.photoURL)})))})}sendPhotoToStorage(t){return e=this,void 0,i=function*(){this.user=r.a.auth().currentUser,this.profileFile=t,console.log(this.profileFile),this.storageRef=r.a.storage().ref(this.user.uid+"/profilePicture/"+this.profileFile.name),this.sendFileTaskObject=this.storageRef.put(this.profileFile),yield new Promise((t,e)=>setTimeout(t,1e3))},new((n=void 0)||(n=Promise))((function(t,r){function o(t){try{u(i.next(t))}catch(e){r(e)}}function s(t){try{u(i.throw(t))}catch(e){r(e)}}function u(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(t){t(r)}))).then(o,s)}u((i=i.apply(e,[])).next())}));var e,n,i}updateProfilePhotoAfterAuth(t){this.user=r.a.auth().currentUser,this.newProfileFile=t,console.log(this.newProfileFile),console.log(this.profileFile.name),this.user&&r.a.storage().ref(this.user.uid+"/profilePicture/"+this.newProfileFile.name).getDownloadURL().then(t=>{console.log(t),this.user.updateProfile({photoURL:t}),alert("Lookin Good ;)"),this.firestore.collection("ionTennisUsers").doc(this.user.uid).update({profilePic:t})})}updateProfileDisplayName(t){this.user=r.a.auth().currentUser,this.newDisplayName=t,console.log(this.newDisplayName),this.user&&this.user.updateProfile({displayName:this.newDisplayName})}getFireStoreData(){this.firestore.collection("ionTennisUsers").get().subscribe(t=>{t.forEach(t=>{this.accountsArray.push(t.data())})})}getCreepDetails(t){this.creepDetailsArray=[],this.creepDetailsArray.push(t),console.log(this.creepDetailsArray),this.router.navigate(["/creep"])}letsUpdateProfile(t){this.user=r.a.auth().currentUser,this.editDisplayName=t,this.user&&this.user.updateProfile({displayName:this.editDisplayName})}deleteProfile(){this.user=r.a.auth().currentUser,this.user&&(this.firestore.collection("ionTennisUsers").doc(this.user.uid).delete().then(()=>{console.log("Users Informations was deleted from the firestore.")}).catch(t=>{console.log(t)}),this.user.delete().then(()=>{alert("You account has been deleted.")}).catch(t=>{console.log(t),alert("there was a error deleting your acount, Sorry!")}))}getShotsDetails(t){this.user=r.a.auth().currentUser,console.log(t),this.firestore.collection("ionTennisUsers").doc(this.user.uid).update({lookingToPlay:t[0],profileDescription:t[3]}).then(()=>{alert("Cool, Weve got you saved.. Start Finding a partner Today!"),this.router.navigate(["/browse"])})}getUserFirestoreData(){this.user=r.a.auth().currentUser,this.user&&this.firestore.collection("ionTennisUsers").doc(this.user.uid).get().subscribe(t=>{this.indivFireData=t.data(),console.log(this.indivFireData)})}updataUserFirestoreInfo(t,e){this.user=r.a.auth().currentUser,this.user&&this.firestore.collection("ionTennisUsers").doc(this.user.uid).update({profileDescription:t,lookingToPlay:e})}updateBrowseOnViewEnter(){this.accountsArray=[],this.getFireStoreData()}}return t.\u0275fac=function(e){return new(e||t)(i.Pb(o.a),i.Pb(s.a),i.Pb(u.g),i.Pb(a.a))},t.\u0275prov=i.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);